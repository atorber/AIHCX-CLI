{% extends "base.html" %}
{% from "components/navigation.html" import navigation %}

{% block title %}AIHCX æ•°æ®é›†è¯¦æƒ…{% endblock %}

{% block header_title %}ğŸ“Š æ•°æ®é›†è¯¦æƒ…{% endblock %}
{% block header_subtitle %}æŸ¥çœ‹æ•°æ®é›†è¯¦ç»†ä¿¡æ¯{% endblock %}

{% block extra_css %}
<style>
    .action-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .btn-back {
        background: #6c757d;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
    }
    
    .btn-back:hover {
        background: #5a6268;
    }
    
    .dataset-card {
        background: var(--panel-bg);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        margin-bottom: 24px;
        overflow: hidden;
    }
    
    .dataset-card-header {
        background: #f8f9fa;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border);
    }
    
    .dataset-card-header h5 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
    }
    
    .dataset-card-body {
        padding: 24px;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .info-item {
        margin-bottom: 16px;
    }
    
    .info-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 4px;
        font-size: 14px;
    }
    
    .info-value {
        font-size: 15px;
        color: var(--text);
        word-break: break-all;
    }
    
    .nav-tabs {
        display: flex;
        border-bottom: 1px solid var(--border);
        margin-bottom: 24px;
    }
    
    .nav-tab {
        padding: 12px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        color: var(--muted);
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .nav-tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }
    
    .nav-tab:hover:not(.active) {
        color: var(--text);
        background: #f8f9fa;
    }
    
    .tab-content {
        min-height: 300px;
    }
    
  .loading,
  .error {
        text-align: center;
        padding: 40px 20px;
        color: var(--muted);
    }
    
    .error {
        color: #dc3545;
    }

  .resource-pool-loading-info {
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 8px;
    padding: 16px;
    margin: 16px 0;
    color: #1976d2;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .resource-pool-loading-info i {
    font-size: 16px;
    color: #1976d2;
  }
    
    .table-container {
        overflow-x: auto;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
    }
    
    .versions-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--panel-bg);
    }
    
    .versions-table th {
        background: #f8f9fa;
        padding: 14px 16px;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }
    
    .versions-table td {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }
    
    .versions-table tr:hover {
        background: #f8f9fa;
    }
    
    .btn-primary {
        background: var(--primary);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
        background: var(--primary-600);
    }

  .btn-primary:disabled {
    background: #6c757d;
    border-color: #6c757d;
    cursor: not-allowed;
    opacity: 0.6;
  }

  .btn-primary:disabled:hover {
    background: #6c757d;
    border-color: #6c757d;
    transform: none;
  }
    
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 24px;
        gap: 8px;
    }
    
    .pagination button {
        padding: 8px 14px;
        border: 1px solid var(--border);
        background: var(--panel-bg);
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
    }
    
    .pagination button:hover:not(:disabled) {
        background: #f8f9fa;
    }
    
    .pagination button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .pagination-info {
        margin: 0 16px;
        color: var(--muted);
        font-size: 14px;
    }
    
    .drawer {
        position: fixed;
        top: 0;
        right: 0;
    width: 50vw;
    max-width: 800px;
    min-width: 400px;
    height: 100vh;
        background-color: white;
    box-shadow: -2px 0 20px rgba(0, 0, 0, 0.15);
    z-index: 10000;
    display: none;
        flex-direction: column;
    overflow: hidden;
    animation: slideIn 0.3s ease-out;
    }
    
    .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
        display: none;
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
    }

    to {
      transform: translateX(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
    }
    
    .drawer-header {
    padding: 24px 24px 16px 24px;
        border-bottom: 1px solid var(--border);
    position: relative;
    }
    
    .drawer-header h4 {
    margin: 0 0 8px 0;
        font-size: 20px;
        font-weight: 600;
        color: var(--text);
    }

  .drawer-description {
    margin: 0;
    font-size: 14px;
    color: var(--muted);
    line-height: 1.5;
  }
    
    .drawer-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--muted);
    width: 40px;
    height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
    }
    
    .drawer-close:hover {
        background: #f1f3f4;
        color: var(--text);
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #495057;
        font-size: 14px;
    }

  .count-badge {
    display: inline-block;
    background: #e3f2fd;
    color: #1976d2;
    font-size: 12px;
    font-weight: 500;
    padding: 2px 8px;
    border-radius: 12px;
    margin-left: 8px;
    border: 1px solid #bbdefb;
  }

  .count-badge.zero-count {
    background: #ffebee;
    color: #d32f2f;
    border-color: #ffcdd2;
  }
    
    .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.2s ease;
    box-sizing: border-box;
    max-width: 100%;
    min-width: 0;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(43, 109, 239, 0.12);
  }

  /* æºæ•°æ®é›†ä¸‹æ‹‰æ¡†æ ·å¼ä¼˜åŒ– */
  .form-control option {
    padding: 8px 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* ç¡®ä¿ä¸‹æ‹‰æ¡†æœ‰è¶³å¤Ÿçš„å®½åº¦æ˜¾ç¤ºé•¿æ–‡æœ¬ */
  select.form-control {
    min-width: 100%;
    max-width: 100%;
    }
    
    .radio-group {
        display: flex;
        gap: 20px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }
    
    .radio-item {
        display: flex;
        align-items: center;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .radio-item:hover {
    background: #f8f9fa;
  }

  .radio-item input[type="radio"] {
        margin-right: 8px;
    width: 16px;
    height: 16px;
    accent-color: var(--primary);
  }

  .radio-label {
    font-size: 14px;
    color: var(--text);
    cursor: pointer;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
    }
    
    .checkbox-item input {
        margin-right: 8px;
    }
    
  .transfer-summary {
    flex: 1;
    font-size: 13px;
    color: #6c757d;
    line-height: 1.4;
    word-break: break-all;
    margin-right: 16px;
  }

  .transfer-summary .source-path {
    background: #e3f2fd;
    color: #1976d2;
    padding: 1px 4px;
    border-radius: 3px;
    font-family: monospace;
    font-weight: 500;
    font-size: 12px;
  }

  .transfer-summary .target-path {
    background: #f3e5f5;
    color: #7b1fa2;
    padding: 1px 4px;
    border-radius: 3px;
    font-family: monospace;
    font-weight: 500;
    font-size: 12px;
  }

  .transfer-summary .empty-hint {
    color: #dc3545;
    font-style: italic;
  }

  .transfer-summary .warning-message {
    color: #dc3545;
    font-weight: 500;
    background: #f8d7da;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #f5c6cb;
  }

  /* è¿‡æ»¤æç¤ºæ ·å¼ */
  .filter-hint {
    margin-top: 8px;
    animation: fadeIn 0.3s ease-in;
  }

  .filter-hint-content {
    background: #e7f3ff;
    border: 1px solid #b3d9ff;
    border-radius: 6px;
    padding: 12px 16px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .filter-hint-icon {
    font-size: 16px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .filter-hint-text {
    flex: 1;
  }

  .filter-hint-title {
    font-weight: 600;
    color: #0066cc;
    margin-bottom: 4px;
    font-size: 13px;
  }

  .filter-hint-message {
    color: #4d4d4d;
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-line;
  }

  .filter-hint-actions {
    margin-top: 8px;
  }

  .btn-details {
    background: #0066cc;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    font-size: 11px;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .btn-details:hover {
    background: #0052a3;
  }

  /* èµ„æºæ± è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
  .resource-pool-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow: hidden;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #e0e0e0;
    background: #f8f9fa;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 16px;
    color: #333;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #666;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-close:hover {
    color: #333;
  }

  .modal-body {
    padding: 20px;
    max-height: 60vh;
    overflow-y: auto;
  }

  .resource-pool-details {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-line;
    margin: 0;
  }

  .modal-footer {
    padding: 16px 20px;
    border-top: 1px solid #e0e0e0;
    background: #f8f9fa;
    text-align: right;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* å†²çªæç¤ºæ¶ˆæ¯æ ·å¼ */
  .conflict-message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    animation: slideDown 0.3s ease-out;
  }

  .conflict-content {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 300px;
    max-width: 500px;
  }

  .conflict-icon {
    font-size: 18px;
    flex-shrink: 0;
  }

  .conflict-text {
    color: #856404;
    font-weight: 500;
    flex: 1;
  }

  .conflict-close {
    background: none;
    border: none;
    color: #856404;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s;
  }

  .conflict-close:hover {
    background-color: rgba(133, 100, 4, 0.1);
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  .action-buttons {
        display: flex;
        gap: 12px;
    flex-shrink: 0;
  }

  .form-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
        margin-top: 32px;
    padding: 20px 20px;
        border-top: 1px solid var(--border);
    position: sticky;
    bottom: 0;
    background: white;
    z-index: 10;
    }
    
    .btn {
    padding: 12px 24px;
        border: none;
    border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
    min-width: 100px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    }
    
  .btn-primary {
    background: var(--primary);
        color: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px);
  }

  .btn-secondary {
    background: white;
    color: var(--text);
    border: 1px solid var(--border);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }
    
    .btn-secondary:hover {
    background: var(--hover);
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-1px);
    }
    
    .copy-btn {
        margin-left: 10px;
        padding: 4px 8px;
        font-size: 12px;
    }

  .drawer-content {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
    max-width: 100%;
    box-sizing: border-box;
    width: 100%;
  }

  .drawer-content .form-group {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }

  .readonly-input {
    background-color: #f8f9fa !important;
    color: #6c757d !important;
    cursor: not-allowed !important;
    border: 1px solid #e9ecef !important;
    font-family: monospace;
    font-size: 13px;
  }

  .readonly-input:focus {
    outline: none !important;
    border-color: #e9ecef !important;
    box-shadow: none !important;
  }

  .target-dataset-summary {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
    padding: 12px 16px;
    background: #f8f9fa;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    font-size: 14px;
    flex-wrap: wrap;
  }

  .summary-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .summary-label {
    font-weight: 500;
    color: #6c757d;
    white-space: nowrap;
  }

  .summary-value {
    color: #495057;
    font-family: monospace;
    font-size: 13px;
  }

  .disabled-group {
    opacity: 0.6;
    pointer-events: none;
  }

  .disabled-group .form-label.required::after {
    display: none;
  }

  .radio-group.disabled {
    opacity: 0.5;
  }

  .radio-group.disabled input[type="radio"] {
    cursor: not-allowed;
  }

  .disabled-hint {
    font-size: 12px;
    color: #6c757d;
    font-style: italic;
    margin-top: 8px;
    margin-bottom: 0;
  }

  .import-method-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }

  .tab-item {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    position: relative;
    background: white;
  }

  .tab-item:hover {
    border-color: var(--primary);
    background: #f8f9fa;
  }

  .tab-item.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .tab-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #ffc107;
    color: #000;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }

  .form-label.required::after {
    content: " *";
    color: #dc3545;
  }

  .toggle-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toggle-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 500;
  }

  .toggle-input {
    display: none;
  }

  .toggle-slider {
    width: 44px;
    height: 24px;
    background: #ccc;
    border-radius: 12px;
    position: relative;
    margin-right: 12px;
    transition: background 0.3s ease;
  }

  .toggle-slider::before {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: transform 0.3s ease;
  }

  .toggle-input:checked+.toggle-slider {
    background: var(--primary);
  }

  .toggle-input:checked+.toggle-slider::before {
    transform: translateX(20px);
  }

  .toggle-description {
    margin: 0;
    font-size: 13px;
    color: var(--muted);
    line-height: 1.4;
  }

  .resource-pool-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .resource-pool-group .form-control {
    flex: 1;
    min-width: 0;
    /* é˜²æ­¢å†…å®¹æº¢å‡º */
    max-width: calc(100% - 48px);
    /* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
  }

  .dataset-filter-group {
    margin-bottom: 12px;
  }

  .filter-select {
    width: 120px;
    font-size: 13px;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #f8f9fa;
    color: #495057;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(43, 109, 239, 0.12);
    background: white;
  }

  .dataset-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .dataset-group .form-control {
    flex: 1;
    min-width: 0;
    /* é˜²æ­¢å†…å®¹æº¢å‡º */
    max-width: calc(100% - 48px);
    /* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
  }

  .version-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .version-group .form-control {
    flex: 1;
    min-width: 0;
    /* é˜²æ­¢å†…å®¹æº¢å‡º */
    max-width: calc(100% - 48px);
    /* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
  }

  .queue-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .queue-group .form-control {
    flex: 1;
    min-width: 0;
    /* é˜²æ­¢å†…å®¹æº¢å‡º */
    max-width: calc(100% - 48px);
    /* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
  }

  .btn-refresh {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 38px;
    transition: all 0.2s ease;
    flex-shrink: 0;
    /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
  }

  .btn-refresh:hover {
    background: #e9ecef;
    border-color: #adb5bd;
  }

  .btn-refresh:active {
    background: #dee2e6;
    transform: scale(0.95);
  }

  .btn-refresh span {
    font-size: 14px;
    line-height: 1;
  }

  /* èµ„æºæ± ç›¸å…³æ ·å¼ */
  .resource-pool-section {
    margin-bottom: 32px;
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 8px;
  }

  .section-title i {
    color: #007bff;
  }

  .count-badge {
    background: #007bff;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 8px;
  }

  .resource-pool-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 16px;
  }

  .resource-pool-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
  }

  .resource-pool-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }

  .resource-pool-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
  }

  .resource-pool-name {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
    flex: 1;
    word-break: break-word;
  }

  .resource-pool-type {
    background: #e3f2fd;
    color: #1976d2;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid #bbdefb;
  }

  .resource-pool-type.dedicated {
    background: #f3e5f5;
    color: #7b1fa2;
    border-color: #ce93d8;
  }

  .resource-pool-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .info-item {
    display: flex;
    align-items: flex-start;
    gap: 8px;
  }

  .info-item .label {
    font-weight: 600;
    color: #666;
    min-width: 80px;
    font-size: 14px;
  }

  .info-item .value {
    color: #333;
    font-size: 14px;
    word-break: break-word;
    flex: 1;
  }

  .storage-tag {
    display: inline-block;
    background: #f8f9fa;
    color: #495057;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    border: 1px solid #e9ecef;
    margin-right: 4px;
    margin-bottom: 4px;
  }

  .empty-state {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 40px 20px;
    color: #666;
    font-size: 14px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #dee2e6;
  }

  .empty-state i {
    font-size: 16px;
    color: #adb5bd;
  }
  
  /* çŠ¶æ€æ ·å¼ */
  .status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
  }
  
  .status-pending {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
  }
  
  .status-running {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }
  
  .status-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  
  .status-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
  
  .status-cancelled {
    background-color: #e2e3e5;
    color: #383d41;
    border: 1px solid #d6d8db;
  }
  
  .status-unknown {
    background-color: #f8f9fa;
    color: #6c757d;
    border: 1px solid #dee2e6;
  }
</style>
{% endblock %}

{% block content %}
<div id="app">
    <div class="page-container">
        <!-- æ“ä½œæ  -->
        <div class="action-bar">
            <a href="/datasets" class="btn-back">
                <i class="fas fa-arrow-left"></i> è¿”å›æ•°æ®é›†åˆ—è¡¨
            </a>

        </div>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div v-if="loading" class="loading">
            <i class="fas fa-spinner fa-spin"></i> æ•°æ®åŠ è½½ä¸­...
        </div>
        
        <!-- é”™è¯¯ä¿¡æ¯ -->
        <div v-if="error" class="error">
            <i class="fas fa-exclamation-circle"></i> [[ error ]]
        </div>
        
        <!-- æ•°æ®é›†åŸºæœ¬ä¿¡æ¯ -->
        <div v-if="dataset && !loading">
            <div class="dataset-card">
                <div class="dataset-card-header">
                    <h5>[[ dataset.name ]]</h5>
                </div>
                <div class="dataset-card-body">
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <div class="info-label">æ•°æ®é›†ID</div>
                                <div class="info-value">
                                    [[ dataset.id ]]
                                    <button @click="copyDatasetId(dataset.id)" class="btn btn-sm btn-outline-primary copy-btn">å¤åˆ¶</button>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">åˆ›å»ºæ—¶é—´</div>
                                <div class="info-value">[[ formatDate(dataset.createdAt) ]]</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æ›´æ–°æ—¶é—´</div>
                                <div class="info-value">[[ formatDate(dataset.updatedAt) ]]</div>
                            </div>
                        </div>
                        <div>
                            <div class="info-item">
                                <div class="info-label">å­˜å‚¨ç±»å‹</div>
                                <div class="info-value">[[ dataset.storageType ]]</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">å¯è§èŒƒå›´</div>
                                <div class="info-value">[[ formatVisibility(dataset.visibilityScope) ]]</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æœ€æ–°ç‰ˆæœ¬</div>
                                <div class="info-value">[[ dataset.latestVersion ]]</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabå¯¼èˆª -->
        <div class="nav-tabs" v-if="dataset && !loading">
            <div class="nav-tab" :class="{active: activeTab === 'basic'}" @click="switchTab('basic')">
                åŸºæœ¬ä¿¡æ¯
            </div>
            <div class="nav-tab" :class="{active: activeTab === 'versions'}" @click="switchTab('versions')">
                ç‰ˆæœ¬åˆ—è¡¨
            </div>
            <div class="nav-tab" :class="{active: activeTab === 'imports'}" @click="switchTab('imports')">
                å¯¼å…¥è®°å½•
            </div>
      <div class="nav-tab" :class="{active: activeTab === 'resourcePools'}" @click="switchTab('resourcePools')" v-if="isPfsDataset">
        å¯ç”¨èµ„æºæ± 
      </div>
        </div>
        
        <!-- Tabå†…å®¹ -->
        <div class="tab-content">
            <!-- åŸºæœ¬ä¿¡æ¯Tab -->
            <div v-show="activeTab === 'basic'" v-if="dataset && !loading">
        <!-- èµ„æºæ± è½½å…¥çŠ¶æ€æç¤º -->
        <div v-if="!resourcePoolCacheLoaded" class="resource-pool-loading-info">
          <i class="fas fa-spinner fa-spin"></i>
          <span>[[ resourcePoolLoadingStatus ]]</span>
        </div>

                <div class="dataset-card">
                    <div class="dataset-card-body">
                        <h6>è¯¦ç»†ä¿¡æ¯</h6>
                        <div class="info-grid">
                            <div>
                                <div class="info-item">
                                    <div class="info-label">æ‰€æœ‰è€…</div>
                                    <div class="info-value">[[ dataset.ownerName ]] ([[ dataset.owner ]])</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">å¯¼å…¥æ ¼å¼</div>
                                    <div class="info-value">[[ dataset.importFormat ]]</div>
                                </div>
                            </div>
                            <div>
                                <div class="info-item">
                                    <div class="info-label">å­˜å‚¨å®ä¾‹</div>
                                    <div class="info-value">[[ dataset.storageInstance ]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç‰ˆæœ¬åˆ—è¡¨Tab -->
            <div v-show="activeTab === 'versions'">
                <div class="mt-3">
          <!-- èµ„æºæ± è½½å…¥çŠ¶æ€æç¤º -->
          <div v-if="!resourcePoolCacheLoaded" class="resource-pool-loading-info">
            <i class="fas fa-spinner fa-spin"></i>
            <span>[[ resourcePoolLoadingStatus ]]</span>
          </div>

                    <!-- ç‰ˆæœ¬åˆ—è¡¨åŠ è½½çŠ¶æ€ -->
                    <div v-if="versionsLoading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> ç‰ˆæœ¬åˆ—è¡¨åŠ è½½ä¸­...
                    </div>
                    
                    <!-- ç‰ˆæœ¬åˆ—è¡¨é”™è¯¯ä¿¡æ¯ -->
                    <div v-if="versionsError" class="error">
                        <i class="fas fa-exclamation-circle"></i> [[ versionsError ]]
                    </div>
                    
                    <!-- ç‰ˆæœ¬åˆ—è¡¨ -->
                    <div v-if="!versionsLoading && !versionsError && versions.length > 0">
                        <div class="table-container">
                            <table class="versions-table">
                                <thead>
                                    <tr>
                                        <th>ç‰ˆæœ¬</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>åˆ›å»ºè€…</th>
                                        <th>å­˜å‚¨è·¯å¾„</th>
                                        <th>æŒ‚è½½è·¯å¾„</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="version in versions" :key="version.id">
                                        <td>[[ version.version ]]</td>
                                        <td>[[ formatDate(version.createdAt) ]]</td>
                                        <td>[[ version.createUserName ]]</td>
                                        <td>[[ version.storagePath ]]</td>
                                        <td>[[ version.mountPath ]]</td>
                                        <td>
                      <button @click="showImportDrawer(version)" class="btn-primary"
                        :disabled="!resourcePoolCacheLoaded"
                        :title="resourcePoolCacheLoaded ? 'å¯¼å…¥æ•°æ®' : 'èµ„æºæ± ç¼“å­˜åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...'">
                        å¯¼å…¥æ•°æ®
                      </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- åˆ†é¡µ -->
                        <div class="pagination">
                            <button @click="prevPage" :disabled="currentPage === 1">
                                <i class="fas fa-chevron-left"></i> ä¸Šä¸€é¡µ
                            </button>
                            <span class="pagination-info">
                                ç¬¬ [[ currentPage ]] é¡µï¼Œå…± [[ totalPages ]] é¡µ
                            </span>
                            <button @click="nextPage" :disabled="currentPage === totalPages">
                                ä¸‹ä¸€é¡µ <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æ— ç‰ˆæœ¬æ•°æ® -->
                    <div v-if="!versionsLoading && !versionsError && versions.length === 0" class="loading">
                        æš‚æ— ç‰ˆæœ¬æ•°æ®
                    </div>
                </div>
            </div>

            <!-- å¯¼å…¥è®°å½•Tab -->
            <div v-show="activeTab === 'imports'">
                <div class="mt-3">
                    <!-- èµ„æºæ± è½½å…¥çŠ¶æ€æç¤º -->
                    <div v-if="!resourcePoolCacheLoaded" class="resource-pool-loading-info">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>[[ resourcePoolLoadingStatus ]]</span>
                    </div>
                    
                    <!-- å¯¼å…¥è®°å½•åŠ è½½çŠ¶æ€ -->
                    <div v-if="importsLoading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> å¯¼å…¥è®°å½•åŠ è½½ä¸­...
                    </div>
                    
                    <!-- å¯¼å…¥è®°å½•é”™è¯¯ä¿¡æ¯ -->
                    <div v-if="importsError" class="error">
                        <i class="fas fa-exclamation-circle"></i> [[ importsError ]]
                    </div>
                    
                    <!-- å¯¼å…¥è®°å½•åˆ—è¡¨ -->
                    <div v-if="resourcePoolCacheLoaded && !importsLoading && !importsError && imports.length > 0">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ä»»åŠ¡åç§°</th>
                                        <th>çŠ¶æ€</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>å®Œæˆæ—¶é—´</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="importJob in imports" :key="importJob.jobId">
                                        <td>
                                            <span class="job-name">[[ importJob.name ]]</span>
                                            <br>
                                            <span class="job-id">[[ importJob.jobId ]]</span>
                                        </td>
                                        <td>
                                            <span class="status" :class="statusClass(importJob.status)">
                                                [[ statusText(importJob.status) ]]
                                            </span>
                                        </td>
                                        <td>[[ formatDate(importJob.createdAt) ]]</td>
                                        <td>[[ formatDate(importJob.finishedAt) ]]</td>
                                        <td>
                                            <button class="btn-primary" @click="viewImportJob(importJob)">
                                                æŸ¥çœ‹è¯¦æƒ…
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- ç©ºçŠ¶æ€ -->
                    <div v-if="resourcePoolCacheLoaded && !importsLoading && !importsError && imports.length === 0" class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>æš‚æ— å¯¼å…¥è®°å½•</p>
                    </div>
                </div>
            </div>

      <!-- å¯ç”¨èµ„æºæ± Tab -->
      <div v-show="activeTab === 'resourcePools'" v-if="isPfsDataset">
        <div class="mt-3">
          <!-- èµ„æºæ± é”™è¯¯ä¿¡æ¯ -->
          <div v-if="resourcePoolError" class="error">
            <i class="fas fa-exclamation-circle"></i> [[ resourcePoolError ]]
        </div>

          <!-- å¯ç”¨èµ„æºæ± åˆ—è¡¨ -->
          <div v-if="!resourcePoolError">
            <div class="resource-pool-section">
              <h4 class="section-title">
                <i class="fas fa-server"></i> å¯ç”¨èµ„æºæ± 
                <span class="count-badge">[[ availableResourcePools.length ]]</span>
              </h4>
              <div v-if="availableResourcePools.length > 0" class="resource-pool-grid">
                <div v-for="pool in availableResourcePools" :key="pool.resourcePoolId" class="resource-pool-card">
                  <div class="resource-pool-header">
                    <h5 class="resource-pool-name">[[ pool.name || pool.metadata?.name || pool.resourcePoolId ]]</h5>
                    <span class="resource-pool-type" :class="pool.resourcePoolType === 'dedicatedV2' ? 'dedicated' : ''">
                      [[ pool.resourcePoolType === 'dedicatedV2' ? 'å…¨æ‰˜ç®¡' : 'è‡ªè¿ç»´' ]]
                    </span>
                  </div>
                  <div class="resource-pool-info">
                    <div class="info-item">
                      <span class="label">èµ„æºæ± ID:</span>
                      <span class="value">[[ pool.resourcePoolId ]]</span>
                    </div>
                    <div class="info-item" v-if="pool.description">
                      <span class="label">æè¿°:</span>
                      <span class="value">[[ pool.description ]]</span>
                    </div>
                    <div class="info-item" v-if="pool.bindingStorages && pool.bindingStorages.length > 0">
                      <span class="label">ç»‘å®šå­˜å‚¨:</span>
                      <span class="value">
                        <span v-for="storage in pool.bindingStorages" :key="storage.id" class="storage-tag">
                          [[ storage.id ]]
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div v-else class="empty-state">
                <i class="fas fa-info-circle"></i>
                <span>æš‚æ— å¯ç”¨èµ„æºæ± </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

<!-- å¯¼å…¥æ•°æ®æŠ½å±‰é®ç½© -->
  <div id="drawer-overlay" class="drawer-overlay" onclick="closeDrawer()"></div>

<!-- å¯¼å…¥æ•°æ®æŠ½å±‰ -->
  <div id="drawer" class="drawer">
    <div class="drawer-header">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
        <h4>å¯¼å…¥æ•°æ®</h4>
          <p class="drawer-description">å°†æ•°æ®å¯¼å…¥åˆ°å½“å‰æ•°æ®é›†,åç»­å¯ä»¥åœ¨ç™¾èˆ¸è´Ÿè½½ä¸­æŒ‚è½½ä½¿ç”¨</p>
        </div>
        <button class="drawer-close" onclick="closeDrawer()" style="margin-left: 20px; flex-shrink: 0;">&times;</button>
      </div>
    </div>
    
    <div class="drawer-content">
      <!-- ç›®æ ‡æ•°æ®é›†ä¿¡æ¯ -->
      <div class="target-dataset-summary">
        <div class="summary-item">
          <span class="summary-label">ç›®æ ‡æ•°æ®é›†:</span>
          <span class="summary-value">[[ dataset ? dataset.name : 'åŠ è½½ä¸­...' ]]</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">ç‰ˆæœ¬:</span>
          <span class="summary-value">[[ getTargetDatasetVersion() ]]</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">å­˜å‚¨:</span>
          <span class="summary-value">[[ getTargetStorageInfo() ]]</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">å­˜å‚¨è·¯å¾„:</span>
          <span class="summary-value">[[ getTargetStoragePath() ]]</span>
        </div>
      </div>

      <!-- å¯¼å…¥æ–¹å¼é€‰æ‹© -->
            <div class="form-group">
                <label class="form-label">å¯¼å…¥æ–¹å¼</label>
                <div class="radio-group">
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="existing" name="importMethod">
            <span class="radio-label">å·²æœ‰æ•°æ®é›†</span>
          </label>
          <!-- <label class="radio-item">
                    <input type="radio" v-model="importMethod" value="public" name="importMethod">
                    <span class="radio-label">å…¬å…±æ•°æ®é›†</span>
                </label> -->
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="object" name="importMethod">
            <span class="radio-label">å¯¹è±¡å­˜å‚¨</span>
          </label>
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="huggingface" name="importMethod">
            <span class="radio-label">HuggingFace</span>
          </label>
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="custom" name="importMethod">
            <span class="radio-label">è‡ªå®šä¹‰ä¸‹è½½</span>
          </label>
          <!-- <label class="radio-item">
                    <input type="radio" v-model="importMethod" value="upload" name="importMethod">
                    <span class="radio-label">ä¸Šä¼ æ–‡ä»¶</span>
                </label> -->
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="tool" name="importMethod">
            <span class="radio-label">å·¥å…·ä¸Šä¼ </span>
          </label>
                    </div>
                    </div>

      <!-- æºæ•°æ®é›†é…ç½® -->
      <div v-if="importMethod === 'existing'" class="form-group">
        <label class="form-label required">
          æºæ•°æ®é›†
          <span class="count-badge" :class="{ 'zero-count': filteredDatasets.length === 0 }">([[ filteredDatasets.length
            ]])</span>
        </label>
        <div class="dataset-filter-group">
          <select v-model="datasetTypeFilter" @change="onDatasetTypeFilterChange" class="form-control filter-select">
            <option value="all">å…¨éƒ¨</option>
            <option value="BOS">BOSç±»å‹</option>
            <option value="PFS">PFSç±»å‹</option>
          </select>
        </div>
        <div class="dataset-group">
          <select v-model="formData.sourceDataset" @change="onSourceDatasetChange" class="form-control">
            <option value="">è¯·é€‰æ‹©æºæ•°æ®é›†</option>
            <option v-for="dataset in filteredDatasets" :key="dataset.id" :value="dataset.id">
              [[ getDatasetDisplayText(dataset) ]]
            </option>
          </select>
          <button type="button" @click="refreshDatasets" class="btn-refresh" title="åˆ·æ–°æ•°æ®é›†åˆ—è¡¨" :disabled="loading">
            <span>ğŸ”„</span>
          </button>
                </div>
            </div>
            
      <div v-if="importMethod === 'existing'" class="form-group">
        <label class="form-label required">
          æ•°æ®ç‰ˆæœ¬
          <span class="count-badge" :class="{ 'zero-count': datasetVersions.length === 0 }">([[ datasetVersions.length
            ]])</span>
        </label>
        <div class="version-group">
          <select v-model="formData.datasetVersion" @change="onDatasetVersionChange" class="form-control">
            <option value="">è¯·é€‰æ‹©æ•°æ®ç‰ˆæœ¬</option>
            <option v-for="version in filteredVersions" :key="version.id" :value="version.id"
              v-text="getVersionDisplayText(version)">
            </option>
          </select>
          <button type="button" @click="refreshDatasetVersions" class="btn-refresh" title="åˆ·æ–°æ•°æ®ç‰ˆæœ¬åˆ—è¡¨"
            :disabled="!formData.sourceDataset">
            <span>ğŸ”„</span>
          </button>
        </div>
                </div>
                
      <!-- æ¸…ç©ºæ•°æ®é€‰é¡¹ -->
                <div class="form-group">
        <div class="toggle-group">
          <label class="toggle-label">
            <input type="checkbox" v-model="formData.cleanData" @change="onCleanDataChange" class="toggle-input">
            <span class="toggle-slider"></span>
            æ¸…ç©ºæ•°æ®
          </label>
          <p class="toggle-description">å¼€å¯æ¸…ç©ºæ•°æ®ä¼šåœ¨å¯¼å…¥å¼€å§‹æ—¶å…ˆåˆ é™¤å½“å‰æ•°æ®é›†ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶</p>
                </div>
            </div>
            
      <!-- åŒåä¿ç•™ç­–ç•¥ -->
      <div class="form-group" :class="{ 'disabled-group': formData.cleanData }">
        <label class="form-label" :class="{ 'required': !formData.cleanData }">åŒåä¿ç•™ç­–ç•¥</label>
        <div class="radio-group" :class="{ 'disabled': formData.cleanData }">
          <label class="radio-item">
            <input type="radio" value="target" v-model="formData.nameStrategy" name="nameStrategy"
              :disabled="formData.cleanData">
            <span class="radio-label">ä¿ç•™ç›®çš„æ–‡ä»¶</span>
          </label>
          <label class="radio-item">
            <input type="radio" value="source" v-model="formData.nameStrategy" name="nameStrategy"
              :disabled="formData.cleanData">
            <span class="radio-label">ä¿ç•™æºæ–‡ä»¶</span>
          </label>
        </div>
        <p v-if="formData.cleanData" class="disabled-hint">æ¸…ç©ºæ•°æ®æ—¶æ— éœ€é€‰æ‹©åŒåä¿ç•™ç­–ç•¥</p>
            </div>
            
      <!-- èµ„æºæ± ç±»å‹ -->
            <div class="form-group">
        <label class="form-label required">èµ„æºæ± ç±»å‹</label>
        <select v-model="formData.resourcePoolType" @change="onResourcePoolTypeChange" class="form-control">
          <option value="">è¯·é€‰æ‹©èµ„æºæ± ç±»å‹</option>
          <option value="common">è‡ªè¿ç»´èµ„æºæ± </option>
          <option value="dedicatedV2">å…¨æ‰˜ç®¡èµ„æºæ± </option>
        </select>
                    </div>

      <!-- èµ„æºæ±  -->
      <div class="form-group">
        <label class="form-label required">
          èµ„æºæ± 
          <span class="count-badge" :class="{ 'zero-count': filteredResourcePools.length === 0 }">([[ filteredResourcePools.length
            ]])</span>
        </label>
        <div class="resource-pool-group">
          <select v-model="formData.resourcePool" @change="onResourcePoolChange" class="form-control"
            :disabled="!formData.resourcePoolType">
            <option value="">è¯·é€‰æ‹©èµ„æºæ± </option>
            <option v-for="pool in filteredResourcePools" :key="pool.resourcePoolId || pool.metadata?.id"
              :value="pool.resourcePoolId || pool.metadata?.id" v-text="pool.name || pool.metadata?.name">
            </option>
          </select>
          <button type="button" @click="refreshResourcePools" class="btn-refresh" title="åˆ·æ–°èµ„æºæ± åˆ—è¡¨"
            :disabled="!formData.resourcePoolType">
            <span>ğŸ”„</span>
          </button>
                    </div>
        <!-- èµ„æºæ± è¿‡æ»¤æç¤º -->
        <div v-if="getResourcePoolFilterHint" class="filter-hint">
          <div class="filter-hint-content">
            <span class="filter-hint-icon">â„¹ï¸</span>
            <div class="filter-hint-text">
              <div class="filter-hint-title">èµ„æºæ± è¿‡æ»¤æç¤º</div>
              <div class="filter-hint-message" v-text="getResourcePoolFilterHint"></div>
              <div class="filter-hint-actions">
                <button type="button" @click="showResourcePoolDetails" class="btn-details">
                  æŸ¥çœ‹å„æ•°æ®é›†å¯é€‰æ‹©çš„èµ„æºæ± 
                </button>
                </div>
            </div>
          </div>
        </div>
            </div>
            
      <!-- é˜Ÿåˆ— -->
            <div class="form-group">
        <label class="form-label required">
          é˜Ÿåˆ—
          <span class="count-badge" :class="{ 'zero-count': filteredQueues.length === 0 }">([[ filteredQueues.length ]])</span>
        </label>
        <div class="queue-group">
          <select v-model="formData.queue" class="form-control" :disabled="!formData.resourcePool">
            <option value="">è¯·é€‰æ‹©é˜Ÿåˆ—</option>
            <option v-for="queue in filteredQueues" :key="queue.queueId || queue.name"
              :value="queue.queueName || queue.name" v-text="getQueueDisplayText(queue)">
            </option>
          </select>
          <button type="button" @click="refreshQueues" class="btn-refresh" title="åˆ·æ–°é˜Ÿåˆ—åˆ—è¡¨"
            :disabled="!formData.resourcePool">
            <span>ğŸ”„</span>
          </button>
        </div>
            </div>
        </div>
        
        <div class="form-actions">
      <div class="transfer-summary">
        <span v-if="checkSourceTargetSame()" class="warning-message">
          âš ï¸ æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„ä¸èƒ½å®Œå…¨ç›¸åŒ
        </span>
        <span v-else-if="getSourcePath()">
          ä» <span class="source-path">[[ getSourcePath() ]]</span> è½¬å‚¨åˆ° <span class="target-path">[[ getTargetPath()
            ]]</span>
        </span>
        <span v-else class="empty-hint">
          è¯·é€‰æ‹©æºæ•°æ®é›†å’Œç‰ˆæœ¬
        </span>
        </div>
      <div class="action-buttons">
        <button type="button" class="btn btn-secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
        <button type="button" class="btn btn-primary" 
                @click="submitImportForm" 
                :disabled="!canSubmitImport"
                :title="getImportButtonDisabledReason || 'ç¡®å®šå¯¼å…¥æ•°æ®'">
          ç¡®å®š
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ç®€å•çš„æŠ½å±‰æ§åˆ¶å‡½æ•°

  function closeDrawer() {
    document.getElementById('drawer').style.display = 'none';
    document.getElementById('drawer-overlay').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // ä»Jinja2æ¨¡æ¿è·å–æ•°æ®é›†ID
  const DATASET_ID = '{{ dataset_id }}';

const { createApp } = Vue;

createApp({
  delimiters: ['[[', ']]'],
  data() {
    return {
      dataset: null,
      loading: false,
      error: null,
        datasetId: DATASET_ID,
      activeTab: 'basic', // é»˜è®¤æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯tab
      
      // ç‰ˆæœ¬åˆ—è¡¨ç›¸å…³æ•°æ®
      versions: [],
      versionsLoading: false,
      versionsError: null,
      currentPage: 1,
      pageSize: 100,
      totalVersions: 0,
      
      // å¯¼å…¥è®°å½•ç›¸å…³æ•°æ®
      imports: [],
      importsLoading: false,
      importsError: null,
      
        // å¯¼å…¥æ•°æ®ç›¸å…³æ•°æ®
        importMethod: 'existing', // é»˜è®¤é€‰ä¸­å·²æœ‰æ•°æ®é›†
        availableDatasets: [], // å¯é€‰æ•°æ®é›†åˆ—è¡¨
        datasetVersions: [], // æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨
        targetDatasetVersion: null, // ç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬ï¼ˆç‚¹å‡»å¯¼å…¥æ•°æ®æŒ‰é’®æ—¶ä¼ å…¥ï¼‰
        resourcePools: [], // èµ„æºæ± åˆ—è¡¨
        queues: [], // é˜Ÿåˆ—åˆ—è¡¨
        datasetTypeFilter: 'all', // æ•°æ®é›†ç±»å‹ç­›é€‰ï¼šall, BOS, PFS
        resourcePoolCacheLoaded: false, // èµ„æºæ± ç¼“å­˜æ˜¯å¦å·²åŠ è½½å®Œæˆ
        resourcePoolLoadingStatus: 'å‡†å¤‡ä¸­...', // èµ„æºæ± åŠ è½½çŠ¶æ€æè¿°
        // ç¼“å­˜ç›¸å…³
        resourcePoolCache: {}, // èµ„æºæ± ç¼“å­˜ï¼ŒæŒ‰ç±»å‹åˆ†åˆ«ç¼“å­˜
        resourcePoolCacheTime: {}, // ç¼“å­˜æ—¶é—´ï¼ŒæŒ‰ç±»å‹åˆ†åˆ«è®°å½•
        cacheExpiry: 5 * 60 * 1000, // ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š5åˆ†é’Ÿ
        
        // å¯ç”¨èµ„æºæ± ç›¸å…³æ•°æ®
        resourcePoolError: null, // èµ„æºæ± é”™è¯¯ä¿¡æ¯
      formData: {
          sourceDataset: '',
          datasetVersion: '',
        cleanData: false,
          nameStrategy: 'target', // é»˜è®¤é€‰ä¸­ä¿ç•™ç›®çš„æ–‡ä»¶
          resourcePoolType: 'common', // èµ„æºæ± ç±»å‹ï¼Œé»˜è®¤é€‰ä¸­è‡ªè¿ç»´èµ„æºæ± 
          resourcePool: '',
          queue: ''
        }

    }
  },
  computed: {
    totalPages() {
      return Math.ceil(this.totalVersions / this.pageSize);
      },
      filteredDatasets() {
        if (!this.availableDatasets || this.availableDatasets.length === 0) {
          return [];
        }

        // æ ¹æ®ç±»å‹ç­›é€‰æ•°æ®é›†
        if (this.datasetTypeFilter === 'all') {
          return this.availableDatasets;
        }

        return this.availableDatasets.filter(dataset => {
          const storageType = dataset.storageType || dataset.storage_type;
          return storageType === this.datasetTypeFilter;
        });
      },
      filteredVersions() {
        return this.datasetVersions && this.datasetVersions.length > 0 ? this.datasetVersions : [];
      },
      filteredResourcePools() {
        if (!this.resourcePools || this.resourcePools.length === 0) {
          return [];
        }
        
        // è·å–éœ€è¦è¿‡æ»¤çš„å­˜å‚¨å®ä¾‹IDåˆ—è¡¨
        const requiredStorageIds = this.getRequiredStorageIds();
        
        // å¦‚æœæ²¡æœ‰éœ€è¦è¿‡æ»¤çš„å­˜å‚¨å®ä¾‹ï¼Œè¿”å›æ‰€æœ‰èµ„æºæ± 
        if (requiredStorageIds.length === 0) {
          return this.resourcePools;
        }
        
        // è¿‡æ»¤èµ„æºæ± ï¼šåªè¿”å›ç»‘å®šäº†æ‰€æœ‰å¿…éœ€å­˜å‚¨å®ä¾‹çš„èµ„æºæ± 
        return this.resourcePools.filter(pool => {
          if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
            return false;
          }
          
          // æ£€æŸ¥èµ„æºæ± æ˜¯å¦ç»‘å®šäº†æ‰€æœ‰å¿…éœ€çš„å­˜å‚¨å®ä¾‹
          const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
          return requiredStorageIds.every(requiredId => boundStorageIds.includes(requiredId));
        });
      },
      filteredQueues() {
        return this.queues && this.queues.length > 0 ? this.queues : [];
      },
      // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„èµ„æºæ± 
      hasAvailableResourcePools() {
        return this.filteredResourcePools.length > 0;
      },
      // è·å–èµ„æºæ± è¿‡æ»¤æç¤ºä¿¡æ¯
      getResourcePoolFilterHint() {
        const requiredStorageIds = this.getRequiredStorageIds();
        
        if (requiredStorageIds.length === 0) {
          return null; // ä¸éœ€è¦è¿‡æ»¤ï¼Œä¸æ˜¾ç¤ºæç¤º
        }
        
        if (this.hasAvailableResourcePools) {
          return null; // æœ‰å¯ç”¨èµ„æºæ± ï¼Œä¸æ˜¾ç¤ºæç¤º
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰PFSç±»å‹çš„æ•°æ®é›†
        const hasPfsDataset = this.hasPfsDataset();
        if (!hasPfsDataset) {
          return null; // æ²¡æœ‰PFSç±»å‹æ•°æ®é›†ï¼Œä¸æ˜¾ç¤ºè¿‡æ»¤æç¤º
        }
        
        // æ²¡æœ‰å¯ç”¨çš„èµ„æºæ± ï¼Œç”Ÿæˆæç¤ºä¿¡æ¯
        const targetStorageId = this.dataset?.storageInstance || this.dataset?.storageInstanceId;
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        const sourceStorageId = sourceDataset?.storageInstance || sourceDataset?.storageInstanceId;
        
        let hint = 'å½“å‰æ²¡æœ‰åŒæ—¶ç»‘å®šä»¥ä¸‹PFSå­˜å‚¨å®ä¾‹çš„èµ„æºæ± ï¼š\n';
        if (targetStorageId) {
          hint += `â€¢ ç›®æ ‡æ•°æ®é›†PFSå­˜å‚¨å®ä¾‹: ${targetStorageId}\n`;
        }
        if (sourceStorageId) {
          hint += `â€¢ æºæ•°æ®é›†PFSå­˜å‚¨å®ä¾‹: ${sourceStorageId}\n`;
        }
        hint += '\nè¯´æ˜ï¼š\n';
        hint += 'â€¢ BOSç±»å‹æ•°æ®é›†å¯ä»¥ä½¿ç”¨æ‰€æœ‰èµ„æºæ± \n';
        hint += 'â€¢ åªæœ‰PFSç±»å‹æ•°æ®é›†éœ€è¦ç‰¹å®šçš„èµ„æºæ± ç»‘å®š\n';
        hint += '\nè§£å†³æ–¹æ¡ˆï¼š\n';
        hint += '1. æ£€æŸ¥èµ„æºæ± çš„PFSå­˜å‚¨å®ä¾‹ç»‘å®šé…ç½®\n';
        hint += '2. é€‰æ‹©BOSç±»å‹çš„æ•°æ®é›†ï¼ˆæ— éœ€èµ„æºæ± ç»‘å®šï¼‰\n';
        hint += '3. è”ç³»ç®¡ç†å‘˜é…ç½®èµ„æºæ± PFSç»‘å®š';
        
        return hint;
      },
      // æ£€æŸ¥æ˜¯å¦å¯ä»¥æäº¤å¯¼å…¥è¡¨å•
      canSubmitImport() {
        // åŸºæœ¬è¡¨å•éªŒè¯
        if (!this.formData.resourcePool || !this.formData.queue || !this.formData.sourceDataset || !this.formData.datasetVersion) {
          return false;
        }
        
        // æ£€æŸ¥æºæ•°æ®é›†å’Œç›®æ ‡æ•°æ®é›†æ˜¯å¦ç›¸åŒ
        if (this.checkSourceTargetSame()) {
          return false;
        }
        
        return true;
      },
      // è·å–å¯¼å…¥æŒ‰é’®çš„ç¦ç”¨åŸå› 
      getImportButtonDisabledReason() {
        if (!this.formData.resourcePool || !this.formData.queue) {
          return 'è¯·é€‰æ‹©èµ„æºæ± å’Œé˜Ÿåˆ—';
        }
        if (!this.formData.sourceDataset) {
          return 'è¯·é€‰æ‹©æºæ•°æ®é›†';
        }
        if (!this.formData.datasetVersion) {
          return 'è¯·é€‰æ‹©æ•°æ®ç‰ˆæœ¬';
        }
        if (this.checkSourceTargetSame()) {
          return 'æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„ä¸èƒ½å®Œå…¨ç›¸åŒ';
        }
        return '';
      },
      
      // æ£€æŸ¥æ˜¯å¦ä¸ºPFSæ•°æ®é›†
      isPfsDataset() {
        return this.dataset && this.dataset.storageType && this.dataset.storageType.toLowerCase() === 'pfs';
      },
      
      // è‡ªè¿ç»´èµ„æºæ± ï¼ˆcommonç±»å‹ï¼‰
      commonResourcePools() {
        if (!this.resourcePools || this.resourcePools.length === 0) {
          return [];
        }
        
        const targetStorageId = this.dataset?.storageInstance || this.dataset?.storageInstanceId;
        if (!targetStorageId) {
          return [];
        }
        
        return this.resourcePools.filter(pool => {
          // åªæ˜¾ç¤ºcommonç±»å‹çš„èµ„æºæ± 
          if (pool.resourcePoolType !== 'common') {
            return false;
          }
          
          // æ£€æŸ¥æ˜¯å¦ç»‘å®šäº†å½“å‰æ•°æ®é›†çš„å­˜å‚¨å®ä¾‹
          if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
            return false;
          }
          
          const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
          return boundStorageIds.includes(targetStorageId);
        });
      },
      
      // å…¨æ‰˜ç®¡èµ„æºæ± ï¼ˆdedicatedV2ç±»å‹ï¼‰
      dedicatedV2ResourcePools() {
        if (!this.resourcePools || this.resourcePools.length === 0) {
          return [];
        }
        
        const targetStorageId = this.dataset?.storageInstance || this.dataset?.storageInstanceId;
        if (!targetStorageId) {
          return [];
        }
        
        return this.resourcePools.filter(pool => {
          // åªæ˜¾ç¤ºdedicatedV2ç±»å‹çš„èµ„æºæ± 
          if (pool.resourcePoolType !== 'dedicatedV2') {
            return false;
          }
          
          // æ£€æŸ¥æ˜¯å¦ç»‘å®šäº†å½“å‰æ•°æ®é›†çš„å­˜å‚¨å®ä¾‹
          if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
            return false;
          }
          
          const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
          return boundStorageIds.includes(targetStorageId);
        });
      },
      
      // æ‰€æœ‰å¯ç”¨èµ„æºæ± ï¼ˆåˆå¹¶è‡ªè¿ç»´å’Œå…¨æ‰˜ç®¡ï¼Œè‡ªè¿ç»´æ’åœ¨å‰é¢ï¼‰
      availableResourcePools() {
        const allPools = [...this.commonResourcePools, ...this.dedicatedV2ResourcePools];
        // æŒ‰ç±»å‹æ’åºï¼šè‡ªè¿ç»´(common)åœ¨å‰ï¼Œå…¨æ‰˜ç®¡(dedicatedV2)åœ¨å
        return allPools.sort((a, b) => {
          if (a.resourcePoolType === 'common' && b.resourcePoolType === 'dedicatedV2') {
            return -1;
          }
          if (a.resourcePoolType === 'dedicatedV2' && b.resourcePoolType === 'common') {
            return 1;
          }
          return 0;
        });
    }
  },
  methods: {
      // æ£€æŸ¥æ˜¯å¦æœ‰PFSç±»å‹çš„æ•°æ®é›†
      hasPfsDataset() {
        // æ£€æŸ¥ç›®æ ‡æ•°æ®é›†æ˜¯å¦ä¸ºPFSç±»å‹
        const targetIsPfs = this.dataset && this.dataset.storageType && this.dataset.storageType.toLowerCase() === 'pfs';
        
        // æ£€æŸ¥æºæ•°æ®é›†æ˜¯å¦ä¸ºPFSç±»å‹
        let sourceIsPfs = false;
        if (this.formData.sourceDataset && this.importMethod === 'existing') {
          const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
          sourceIsPfs = sourceDataset && sourceDataset.storageType && sourceDataset.storageType.toLowerCase() === 'pfs';
        }
        
        return targetIsPfs || sourceIsPfs;
      },
      
      // è·å–æ¯ä¸ªæ•°æ®é›†å¯é€‰æ‹©çš„èµ„æºæ± ä¿¡æ¯
      getDatasetResourcePoolInfo() {
        if (!this.dataset || !this.formData.sourceDataset) {
          return null;
        }
        
        const targetStorageType = this.dataset.storageType?.toLowerCase();
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        const sourceStorageType = sourceDataset?.storageType?.toLowerCase();
        
        let info = 'å„æ•°æ®é›†å¯é€‰æ‹©çš„èµ„æºæ± ï¼š\n\n';
        
        // ç›®æ ‡æ•°æ®é›†ä¿¡æ¯
        if (targetStorageType === 'pfs') {
          const targetStorageId = this.dataset.storageInstance || this.dataset.storageInstanceId;
          const targetPools = this.resourcePools.filter(pool => {
            if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
              return false;
            }
            const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
            return targetStorageId && boundStorageIds.includes(targetStorageId);
          });
          
          info += `ç›®æ ‡æ•°æ®é›† (PFS - ${targetStorageId})ï¼š\n`;
          if (targetPools.length > 0) {
            targetPools.forEach(pool => {
              info += `â€¢ ${pool.name || pool.metadata?.name || pool.resourcePoolId}\n`;
            });
          } else {
            info += 'â€¢ æ— å¯ç”¨èµ„æºæ± \n';
          }
          info += '\n';
        } else if (targetStorageType === 'bos') {
          info += `ç›®æ ‡æ•°æ®é›† (BOS)ï¼š\n`;
          info += `â€¢ å¯ä»¥ä½¿ç”¨æ‰€æœ‰èµ„æºæ±  (${this.resourcePools.length}ä¸ª)\n`;
          info += '\n';
        }
        
        // æºæ•°æ®é›†ä¿¡æ¯
        if (sourceStorageType === 'pfs') {
          const sourceStorageId = sourceDataset.storageInstance || sourceDataset.storageInstanceId;
          const sourcePools = this.resourcePools.filter(pool => {
            if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
              return false;
            }
            const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
            return sourceStorageId && boundStorageIds.includes(sourceStorageId);
          });
          
          info += `æºæ•°æ®é›† (PFS - ${sourceStorageId})ï¼š\n`;
          if (sourcePools.length > 0) {
            sourcePools.forEach(pool => {
              info += `â€¢ ${pool.name || pool.metadata?.name || pool.resourcePoolId}\n`;
            });
          } else {
            info += 'â€¢ æ— å¯ç”¨èµ„æºæ± \n';
          }
        } else if (sourceStorageType === 'bos') {
          info += `æºæ•°æ®é›† (BOS)ï¼š\n`;
          info += `â€¢ å¯ä»¥ä½¿ç”¨æ‰€æœ‰èµ„æºæ±  (${this.resourcePools.length}ä¸ª)\n`;
        }
        
        // æ·»åŠ è¯´æ˜
        info += '\nè¯´æ˜ï¼š\n';
        info += 'â€¢ BOSç±»å‹æ•°æ®é›†å¯ä»¥ä½¿ç”¨æ‰€æœ‰èµ„æºæ± \n';
        info += 'â€¢ PFSç±»å‹æ•°æ®é›†éœ€è¦ç‰¹å®šçš„èµ„æºæ± ç»‘å®š\n';
        
        return info;
      },
      
      // æ˜¾ç¤ºèµ„æºæ± è¯¦ç»†ä¿¡æ¯
      showResourcePoolDetails() {
        const details = this.getDatasetResourcePoolInfo();
        if (details) {
          // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
          const modal = document.createElement('div');
          modal.className = 'resource-pool-modal';
          modal.innerHTML = `
            <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
            <div class="modal-content">
              <div class="modal-header">
                <h3>èµ„æºæ± ç»‘å®šè¯¦æƒ…</h3>
                <button class="modal-close" onclick="this.closest('.resource-pool-modal').remove()">Ã—</button>
              </div>
              <div class="modal-body">
                <pre class="resource-pool-details">${details}</pre>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" onclick="this.closest('.resource-pool-modal').remove()">å…³é—­</button>
              </div>
            </div>
          `;
          document.body.appendChild(modal);
        }
      },
      
      // è·å–éœ€è¦è¿‡æ»¤çš„å­˜å‚¨å®ä¾‹IDåˆ—è¡¨
      getRequiredStorageIds() {
        const storageIds = [];
        
        // è·å–ç›®æ ‡æ•°æ®é›†çš„å­˜å‚¨å®ä¾‹ID
        if (this.dataset && this.dataset.storageType && this.dataset.storageType.toLowerCase() === 'pfs') {
          const targetStorageId = this.dataset.storageInstance || this.dataset.storageInstanceId;
          if (targetStorageId) {
            storageIds.push(targetStorageId);
          }
        }
        
        // è·å–æºæ•°æ®é›†çš„å­˜å‚¨å®ä¾‹ID
        if (this.formData.sourceDataset && this.importMethod === 'existing') {
          const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
          if (sourceDataset && sourceDataset.storageType && sourceDataset.storageType.toLowerCase() === 'pfs') {
            const sourceStorageId = sourceDataset.storageInstance || sourceDataset.storageInstanceId;
            if (sourceStorageId) {
              storageIds.push(sourceStorageId);
            }
          }
        }
        
        // å»é‡å¹¶è¿”å›
        return [...new Set(storageIds)];
      },
      
      // è·å–æ•°æ®é›†æ˜¾ç¤ºæ–‡æœ¬
      getDatasetDisplayText(dataset) {
        if (!dataset) return '';

        let displayText = `${dataset.name}`;

        // æ·»åŠ å­˜å‚¨ç±»å‹ä¿¡æ¯
        const storageTypeText = dataset.storageType;
        displayText += ` [ ${dataset.id} / ${storageTypeText}:`;

        // æ·»åŠ å­˜å‚¨å®ä¾‹IDä¿¡æ¯
        const storageInstanceId = dataset.storageInstanceId || dataset.storage_instance_id || dataset.storageInstance;
        if (storageInstanceId) {
          displayText += `${storageInstanceId}]`;
        }

        return displayText;
      },

      // è·å–ç‰ˆæœ¬æ˜¾ç¤ºæ–‡æœ¬
      getVersionDisplayText(version) {
        if (!version) return '';

        let displayText = '';

        // æ·»åŠ ç‰ˆæœ¬å·
        if (version.version) {
          displayText += `v${version.version} [${version.id} | `;
        }

        // æ·»åŠ å­˜å‚¨è·¯å¾„ä¿¡æ¯
        // å¦‚æœè·¯å¾„å¤ªé•¿ï¼Œåªæ˜¾ç¤ºæœ€åä¸€éƒ¨åˆ†
        const path = version.storagePath;
        const shortPath = path.length > 25 ? '...' + path.slice(-22) : path;
        displayText += `${shortPath} -> `;

        const mountPath = version.mountPath;
        const shortMountPath = mountPath.length > 25 ? '...' + mountPath.slice(-22) : mountPath;
        displayText += ` ${shortMountPath}]`;

        // æ·»åŠ æè¿°ä¿¡æ¯
        if (version.description) {
          displayText += ` - ${version.description}`;
        }

        return displayText;
      },

      // è·å–é˜Ÿåˆ—æ˜¾ç¤ºæ–‡æœ¬
      getQueueDisplayText(queue) {
        if (!queue) return '';
        let displayText = queue.queueName || queue.name || 'æœªå‘½åé˜Ÿåˆ—';

        // æ·»åŠ é˜Ÿåˆ—ç±»å‹ä¿¡æ¯
        if (queue.queueType) {
          displayText += ` (${queue.queueType})`;
        }

        // æ·»åŠ èµ„æºä¿¡æ¯
        if (queue.capability) {
          const memoryGi = queue.capability.memoryGi;
          const cpuCores = queue.capability.milliCPUcores;
          if (memoryGi && cpuCores) {
            const memoryGB = Math.round(parseInt(memoryGi) / (1024 * 1024 * 1024));
            const cpuCoresNum = Math.round(parseInt(cpuCores) / 1000);
            displayText += ` - ${cpuCoresNum}æ ¸/${memoryGB}GB`;
          }
        }

        // æ·»åŠ åŠ é€Ÿå¡ä¿¡æ¯
        if (queue.capability?.acceleratorCardList?.length > 0) {
          const accelerator = queue.capability.acceleratorCardList[0];
          if (accelerator.acceleratorType && accelerator.acceleratorCount) {
            displayText += ` - ${accelerator.acceleratorCount}x${accelerator.acceleratorType}`;
          }
        }

        return displayText;
      },

      async showImportDrawer(version) {
        // ä¿å­˜ç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬ä¿¡æ¯
        this.targetDatasetVersion = version;

        // ç¡®ä¿é»˜è®¤é€‰ä¸­å·²æœ‰æ•°æ®é›†
        this.importMethod = 'existing';

        // ç¡®ä¿é»˜è®¤é€‰ä¸­ä¿ç•™ç›®çš„æ–‡ä»¶
        this.formData.nameStrategy = 'target';

        console.log('è®¾ç½®é»˜è®¤å€¼ - importMethod:', this.importMethod, 'nameStrategy:', this.formData.nameStrategy);

        // åŠ è½½å¯é€‰æ•°æ®é›†åˆ—è¡¨
        await this.loadAvailableDatasets();

        // åŠ è½½èµ„æºæ± å’Œé˜Ÿåˆ—åˆ—è¡¨ï¼ˆä¼˜å…ˆä½¿ç”¨é¢„åŠ è½½çš„ç¼“å­˜ï¼‰
        await this.loadResourcePools();

        console.log('æ•°æ®é›†åˆ—è¡¨åŠ è½½å®Œæˆï¼Œæ•°é‡:', this.availableDatasets.length);
        console.log('æ•°æ®é›†åˆ—è¡¨å†…å®¹:', this.availableDatasets);

        // å¼ºåˆ¶Vue.jsæ›´æ–°
        this.$forceUpdate();

        // ä½¿ç”¨$nextTickç¡®ä¿Vue.jså“åº”å¼æ›´æ–°å®Œæˆåå†æ˜¾ç¤ºæŠ½å±‰
        this.$nextTick(() => {
          // æ•°æ®é›†ä¿¡æ¯ç°åœ¨é€šè¿‡Vue.jsæ•°æ®ç»‘å®šè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®DOM

          // æ˜¾ç¤ºæŠ½å±‰
          document.getElementById('drawer').style.display = 'flex';
          document.getElementById('drawer-overlay').style.display = 'block';
          document.body.style.overflow = 'hidden';

          // å†æ¬¡ç¡®è®¤é»˜è®¤å€¼è®¾ç½®
          console.log('æŠ½å±‰æ˜¾ç¤ºå - importMethod:', this.importMethod, 'nameStrategy:', this.formData.nameStrategy);
          console.log('æŠ½å±‰æ˜¾ç¤ºå - availableDatasets:', this.availableDatasets);
          console.log('æŠ½å±‰æ˜¾ç¤ºå - filteredDatasets:', this.filteredDatasets);
          console.log('æŠ½å±‰æ˜¾ç¤ºå - filteredDatasets.length:', this.filteredDatasets.length);
          if (this.filteredDatasets.length > 0) {
            console.log('ç¬¬ä¸€ä¸ªæ•°æ®é›†å¯¹è±¡:', this.filteredDatasets[0]);
            console.log('ç¬¬ä¸€ä¸ªæ•°æ®é›†åç§°:', this.filteredDatasets[0].name);
          }

          // æ£€æŸ¥DOMä¸­çš„å•é€‰æŒ‰é’®çŠ¶æ€
          const existingRadio = document.querySelector('input[value="existing"]');
          const targetRadio = document.querySelector('input[value="target"]');
          console.log('DOMæ£€æŸ¥ - existing radio checked:', existingRadio ? existingRadio.checked : 'not found');
          console.log('DOMæ£€æŸ¥ - target radio checked:', targetRadio ? targetRadio.checked : 'not found');

          // å¼ºåˆ¶è®¾ç½®å•é€‰æŒ‰é’®çš„é€‰ä¸­çŠ¶æ€
          if (existingRadio) {
            existingRadio.checked = true;
            console.log('å¼ºåˆ¶è®¾ç½®å·²æœ‰æ•°æ®é›†ä¸ºé€‰ä¸­çŠ¶æ€');
          }
          if (targetRadio) {
            targetRadio.checked = true;
            console.log('å¼ºåˆ¶è®¾ç½®ä¿ç•™ç›®çš„æ–‡ä»¶ä¸ºé€‰ä¸­çŠ¶æ€');
          }

          // æ£€æŸ¥æºæ•°æ®é›†ä¸‹æ‹‰æ¡†
          const sourceDatasetSelect = document.querySelector('select[v-model="formData.sourceDataset"]');
          console.log('æºæ•°æ®é›†ä¸‹æ‹‰æ¡†:', sourceDatasetSelect);
          if (sourceDatasetSelect) {
            console.log('ä¸‹æ‹‰æ¡†é€‰é¡¹æ•°é‡:', sourceDatasetSelect.options.length);
            for (let i = 0; i < sourceDatasetSelect.options.length; i++) {
              console.log(`é€‰é¡¹ ${i}:`, sourceDatasetSelect.options[i].text, sourceDatasetSelect.options[i].value);
            }
          }

          // å¼ºåˆ¶é‡æ–°æ¸²æŸ“ä¸‹æ‹‰æ¡†
          this.$forceUpdate();
          console.log('å¼ºåˆ¶é‡æ–°æ¸²æŸ“Vue.jsç»„ä»¶');

          // å»¶è¿Ÿå†æ¬¡æ£€æŸ¥ä¸‹æ‹‰æ¡†çŠ¶æ€
          setTimeout(() => {
            const sourceDatasetSelect = document.querySelector('select[v-model="formData.sourceDataset"]');
            if (sourceDatasetSelect) {
              console.log('å»¶è¿Ÿæ£€æŸ¥ - ä¸‹æ‹‰æ¡†é€‰é¡¹æ•°é‡:', sourceDatasetSelect.options.length);
              for (let i = 0; i < sourceDatasetSelect.options.length; i++) {
                console.log(`å»¶è¿Ÿæ£€æŸ¥ - é€‰é¡¹ ${i}:`, sourceDatasetSelect.options[i].text, sourceDatasetSelect.options[i].value);
              }
            }
          }, 100);
        });
      },
      onDatasetTypeFilterChange() {
        // å½“ç­›é€‰ç±»å‹æ”¹å˜æ—¶ï¼Œæ¸…ç©ºå·²é€‰æ‹©çš„æ•°æ®é›†å’Œç‰ˆæœ¬
        this.formData.sourceDataset = '';
        this.formData.datasetVersion = '';
        this.datasetVersions = [];
        console.log('æ•°æ®é›†ç±»å‹ç­›é€‰å·²æ›´æ”¹ä¸º:', this.datasetTypeFilter);
      },
      onCleanDataChange() {
        // å½“æ¸…ç©ºæ•°æ®çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ¸…ç©ºåŒåä¿ç•™ç­–ç•¥é€‰æ‹©
        if (this.formData.cleanData) {
          this.formData.nameStrategy = '';
          console.log('æ¸…ç©ºæ•°æ®å·²å¼€å¯ï¼Œæ¸…ç©ºåŒåä¿ç•™ç­–ç•¥é€‰æ‹©');
        }
      },
      onSourceDatasetChange() {
        // å½“é€‰æ‹©æºæ•°æ®é›†æ—¶ï¼ŒåŠ è½½å¯¹åº”çš„ç‰ˆæœ¬åˆ—è¡¨
        if (this.formData.sourceDataset) {
          this.loadDatasetVersions(this.formData.sourceDataset);
          // æ¸…ç©ºä¹‹å‰é€‰æ‹©çš„ç‰ˆæœ¬
          this.formData.datasetVersion = '';
        } else {
          this.datasetVersions = [];
          this.formData.datasetVersion = '';
        }
        
        // é‡æ–°è¿‡æ»¤èµ„æºæ± ï¼ˆå› ä¸ºæºæ•°æ®é›†å˜åŒ–å¯èƒ½å½±å“å¯ç”¨çš„èµ„æºæ± ï¼‰
        this.refilterResourcePools();
      },
      
      onDatasetVersionChange() {
        // å½“é€‰æ‹©æ•°æ®ç‰ˆæœ¬æ—¶ï¼Œæ£€æŸ¥å­˜å‚¨å®ä¾‹å’Œè·¯å¾„æ˜¯å¦ç›¸åŒ
        if (this.checkSourceTargetSame()) {
          // å¦‚æœå­˜å‚¨å®ä¾‹å’Œè·¯å¾„ç›¸åŒï¼Œæ¸…ç©ºé€‰æ‹©å¹¶æ˜¾ç¤ºæç¤º
          this.formData.datasetVersion = '';
          
          // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æç¤º
          this.showConflictMessage('æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„ä¸èƒ½å®Œå…¨ç›¸åŒï¼Œè¯·é€‰æ‹©å…¶ä»–ç‰ˆæœ¬');
          
          console.log('æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„ä¸èƒ½å®Œå…¨ç›¸åŒï¼Œå·²æ¸…ç©ºç‰ˆæœ¬é€‰æ‹©');
        }
      },
      
      
      // æ˜¾ç¤ºå†²çªæç¤ºæ¶ˆæ¯
      showConflictMessage(message = 'æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„ä¸èƒ½å®Œå…¨ç›¸åŒï¼Œè¯·é€‰æ‹©å…¶ä»–ç‰ˆæœ¬') {
        // ç§»é™¤å·²å­˜åœ¨çš„å†²çªæ¶ˆæ¯
        const existingMessage = document.querySelector('.conflict-message');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        // åˆ›å»ºæç¤ºæ¶ˆæ¯å…ƒç´ 
        const messageDiv = document.createElement('div');
        messageDiv.className = 'conflict-message';
        messageDiv.innerHTML = `
          <div class="conflict-content">
            <span class="conflict-icon">âš ï¸</span>
            <span class="conflict-text">${message}</span>
            <button class="conflict-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
          </div>
        `;
        
        // æ·»åŠ åˆ°é¡µé¢é¡¶éƒ¨
        const container = document.querySelector('.drawer-content') || document.body;
        container.insertBefore(messageDiv, container.firstChild);
        
        // 3ç§’åè‡ªåŠ¨ç§»é™¤
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        }, 3000);
      },
      
      // é‡æ–°è¿‡æ»¤èµ„æºæ± 
      refilterResourcePools() {
        const requiredStorageIds = this.getRequiredStorageIds();
        console.log('éœ€è¦è¿‡æ»¤çš„å­˜å‚¨å®ä¾‹ID:', requiredStorageIds);
        
        // æ£€æŸ¥å½“å‰é€‰æ‹©çš„èµ„æºæ± æ˜¯å¦ä»ç„¶å¯ç”¨
        const filteredPools = this.filteredResourcePools;
        const currentPoolId = this.formData.resourcePool;
        
        console.log(`èµ„æºæ± è¿‡æ»¤ç»“æœ: åŸå§‹${this.resourcePools.length}ä¸ªï¼Œè¿‡æ»¤å${filteredPools.length}ä¸ª`);
        
        if (currentPoolId && !filteredPools.find(pool => (pool.resourcePoolId || pool.metadata?.id) === currentPoolId)) {
          // å½“å‰é€‰æ‹©çš„èµ„æºæ± ä¸å¯ç”¨ï¼Œæ¸…ç©ºé€‰æ‹©
          this.formData.resourcePool = '';
          this.formData.queue = '';
          this.queues = [];
          console.log('å½“å‰é€‰æ‹©çš„èµ„æºæ± ä¸å¯ç”¨ï¼Œå·²æ¸…ç©ºé€‰æ‹©');
        }
      },
      
      // æ£€æŸ¥æºæ•°æ®é›†å’Œç›®æ ‡æ•°æ®é›†æ˜¯å¦ç›¸åŒ
      checkSourceTargetSame() {
        if (!this.formData.sourceDataset || !this.formData.datasetVersion) {
          return false;
        }
        
        // è·å–æºæ•°æ®é›†ä¿¡æ¯
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        const sourceVersion = this.datasetVersions.find(v => v.id === this.formData.datasetVersion);
        
        if (!sourceDataset || !sourceVersion) {
          return false;
        }
        
        // è·å–ç›®æ ‡æ•°æ®é›†ä¿¡æ¯
        const targetVersion = this.targetDatasetVersion;
        
        if (!targetVersion) {
          return false;
        }
        
        // æ¯”è¾ƒå­˜å‚¨å®ä¾‹å’Œè·¯å¾„
        const sourceStorageInstance = sourceDataset.storageInstance || sourceDataset.storageInstanceId;
        const targetStorageInstance = this.dataset.storageInstance || this.dataset.storageInstanceId;
        const sourceStoragePath = sourceVersion.storagePath;
        const targetStoragePath = targetVersion.storagePath;
        
        const isSame = sourceStorageInstance === targetStorageInstance && 
                      sourceStoragePath === targetStoragePath;
        
        if (isSame) {
          console.log('æºæ•°æ®é›†å’Œç›®æ ‡æ•°æ®é›†ç›¸åŒ:', {
            source: `${sourceStorageInstance}:${sourceStoragePath}`,
            target: `${targetStorageInstance}:${targetStoragePath}`
          });
        }
        
        return isSame;
      },
      async loadAvailableDatasets() {
        try {
          console.log('è·å–æ•°æ®é›†åˆ—è¡¨...');
          const response = await axios.get('/api?action=DescribeDatasets');
          console.log('æ•°æ®é›†åˆ—è¡¨APIå“åº”:', response.data);

          if (response.data && response.data.Datasets) {
            this.availableDatasets = response.data.Datasets;
            console.log('æ•°æ®é›†åˆ—è¡¨åŠ è½½æˆåŠŸ:', this.availableDatasets);
          } else if (response.data && response.data.datasets) {
            this.availableDatasets = response.data.datasets;
            console.log('æ•°æ®é›†åˆ—è¡¨åŠ è½½æˆåŠŸ:', this.availableDatasets);
          } else {
            console.log('æ•°æ®é›†åˆ—è¡¨ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
            this.availableDatasets = [];
          }
        } catch (error) {
          console.error('è·å–æ•°æ®é›†åˆ—è¡¨å¤±è´¥:', error);
          this.availableDatasets = [];
        }
      },
      async loadDatasetVersions(datasetId) {
        if (!datasetId) {
          this.datasetVersions = [];
          return;
        }

        try {
          console.log('è·å–æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨:', datasetId);
          const response = await axios.get('/api?action=DescribeDatasetVersions&datasetId=' + encodeURIComponent(datasetId) + '&pageNumber=1&pageSize=100');
          console.log('æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨APIå“åº”:', response.data);

          if (response.data && response.data.Versions) {
            this.datasetVersions = response.data.Versions;
            console.log('æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨åŠ è½½æˆåŠŸ:', this.datasetVersions);
          } else if (response.data && response.data.versions) {
            this.datasetVersions = response.data.versions;
            console.log('æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨åŠ è½½æˆåŠŸ:', this.datasetVersions);
          } else {
            console.log('æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
            this.datasetVersions = [];
          }
        } catch (error) {
          console.error('è·å–æ•°æ®é›†ç‰ˆæœ¬åˆ—è¡¨å¤±è´¥:', error);
          this.datasetVersions = [];
        }
      },
    async loadDataset() {
      console.log('loadDataset called for ID:', this.datasetId);
      this.loading = true;
      this.error = null;
      
      try {
        console.log('Making API request...');
        const response = await axios.get('/api?action=DescribeDataset&datasetId=' + encodeURIComponent(this.datasetId));
        console.log('API response received:', response.data);
        const data = response.data;
        
        if (data.error) {
          this.error = data.error;
          return;
        }
        
        // æ•°æ®é›†è¯¦æƒ…ç›´æ¥åœ¨dataä¸­ï¼Œè€Œä¸æ˜¯åœ¨data.datasetæˆ–data.Datasetä¸­
        this.dataset = data;
        console.log('Dataset loaded:', this.dataset);
          console.log('Dataset name:', this.dataset ? this.dataset.name : 'undefined');
          console.log('Dataset ID:', this.dataset ? this.dataset.id : 'undefined');

          // é¢„åŠ è½½èµ„æºæ± æ•°æ®ï¼ˆå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼‰
          this.preloadResourcePools();

      } catch (err) {
        console.error('Error loading dataset:', err);
        this.error = 'åŠ è½½æ•°æ®é›†è¯¦æƒ…å¤±è´¥: ' + err.message;
      } finally {
        this.loading = false;
      }
    },
    async loadVersions() {
      console.log('loadVersions called for ID:', this.datasetId);
      this.versionsLoading = true;
      this.versionsError = null;
      
      try {
        console.log('Making versions API request...');
        const response = await axios.get('/api?action=DescribeDatasetVersions&datasetId=' + encodeURIComponent(this.datasetId) + '&pageNumber=' + this.currentPage + '&pageSize=' + this.pageSize);
        console.log('Versions API response received:', response.data);
        const data = response.data;
        
        if (data.error) {
          this.versionsError = data.error;
          return;
        }
        
        // ç‰ˆæœ¬åˆ—è¡¨åœ¨data.versionsä¸­ï¼Œæ€»æ•°åœ¨data.totalCountä¸­
        this.versions = data.versions || data.Versions || [];
        this.totalVersions = data.totalCount || data.TotalCount || 0;
        console.log('Versions loaded:', this.versions);
      } catch (err) {
        console.error('Error loading versions:', err);
        this.versionsError = 'åŠ è½½ç‰ˆæœ¬åˆ—è¡¨å¤±è´¥: ' + err.message;
      } finally {
        this.versionsLoading = false;
      }
    },
    async loadImports() {
      console.log('loadImports called for dataset:', this.datasetId);
      this.importsLoading = true;
      this.importsError = null;
      
      try {
        // ç”Ÿæˆæ•°æ®é›†IDçš„å‰ç¼€ç”¨äºæœç´¢ä»»åŠ¡åç§°
        const sanitizedDatasetId = this.datasetId.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
        const searchPrefix = `${sanitizedDatasetId}-`;
        
        // ç­‰å¾…é¡µé¢èµ„æºæ± åˆ—è¡¨åŠ è½½å®Œæˆ
        console.log('ç­‰å¾…é¡µé¢èµ„æºæ± åˆ—è¡¨åŠ è½½å®Œæˆ...');
        const allResourcePools = await this.waitForResourcePools();
        
        if (allResourcePools.length === 0) {
          throw new Error('æ— æ³•è·å–èµ„æºæ± åˆ—è¡¨ï¼Œè¯·ç¨åé‡è¯•');
        }
        
        console.log('ä½¿ç”¨é¡µé¢å·²åŠ è½½çš„èµ„æºæ± åˆ—è¡¨:', allResourcePools.length, 'ä¸ªèµ„æºæ± ');
        console.log('æœç´¢å…³é”®å­—:', searchPrefix);
        
        // å¾ªç¯æŸ¥è¯¢æ‰€æœ‰èµ„æºæ± çš„ä»»åŠ¡
        const allImports = [];
        const promises = allResourcePools.map(async (pool) => {
          try {
            const poolId = pool.resourcePoolId || pool.id;
            const poolType = pool.resourcePoolType || pool.type;
            
            // æ‰˜ç®¡èµ„æºæ± ç±»å‹ç»Ÿä¸€ä½¿ç”¨ aihc-serverless
            const actualPoolId = poolType === 'dedicatedV2' ? 'aihc-serverless' : poolId;
            const requestBody = {
              keywordType: 'name',
              keyword: searchPrefix
            };
            console.log(`Querying jobs in resource pool: ${poolId} (type: ${poolType}, actual: ${actualPoolId})`);
            
            const response = await axios.post(`/api?action=DescribeJobs&resourcePoolId=${actualPoolId}`, requestBody);
            
            if (response.data.error) {
              console.warn(`Failed to query jobs in pool ${poolId}:`, response.data.error);
              return [];
            }
            
            const jobs = response.data.jobs || response.data.result?.jobs || [];
            console.log(`Found ${jobs.length} jobs in pool ${poolId} (${poolType})`);
            console.log(`Jobs in pool ${poolId}:`, jobs.map(job => ({ name: job.name, jobId: job.jobId })));
            return jobs;
          } catch (err) {
            console.warn(`Error querying pool ${pool.resourcePoolId || pool.id}:`, err);
            return [];
          }
        });
        
        // ç­‰å¾…æ‰€æœ‰æŸ¥è¯¢å®Œæˆ
        const results = await Promise.all(promises);
        
        // åˆå¹¶æ‰€æœ‰ç»“æœ
        results.forEach(jobs => {
          allImports.push(...jobs);
        });
        
        console.log('åˆå¹¶å‰æ‰€æœ‰ä»»åŠ¡æ•°é‡:', allImports.length);
        console.log('åˆå¹¶å‰æ‰€æœ‰ä»»åŠ¡åç§°:', allImports.map(job => job.name || job.jobName));
        
        // ç›´æ¥ä½¿ç”¨APIè¿”å›çš„ä»»åŠ¡åˆ—è¡¨ï¼Œå› ä¸ºå…³é”®å­—æœç´¢å·²ç»æ˜¯åŒ…å«åŒ¹é…
        this.imports = allImports;
        
        console.log('æœ€ç»ˆå¯¼å…¥ä»»åŠ¡æ•°é‡:', this.imports.length);
        console.log('Loaded imports from all pools:', this.imports);
        
      } catch (err) {
        console.error('Failed to load imports:', err);
        this.importsError = 'åŠ è½½å¯¼å…¥è®°å½•å¤±è´¥: ' + err.message;
      } finally {
        this.importsLoading = false;
      }
    },
    async waitForResourcePools() {
      // å¦‚æœèµ„æºæ± å·²ç»åŠ è½½å®Œæˆï¼Œç›´æ¥è¿”å›
      if (this.resourcePoolCacheLoaded && this.resourcePools && this.resourcePools.length > 0) {
        console.log('èµ„æºæ± å·²åŠ è½½å®Œæˆï¼Œç›´æ¥ä½¿ç”¨ç°æœ‰æ•°æ®');
        return this.resourcePools;
      }
      
      // å¦‚æœæ­£åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…åŠ è½½å®Œæˆ
      if (this.resourcePoolLoadingStatus && this.resourcePoolLoadingStatus.includes('æ­£åœ¨')) {
        console.log('èµ„æºæ± æ­£åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…åŠ è½½å®Œæˆ...');
        return new Promise((resolve) => {
          const checkInterval = setInterval(() => {
            if (this.resourcePoolCacheLoaded && this.resourcePools && this.resourcePools.length > 0) {
              clearInterval(checkInterval);
              console.log('èµ„æºæ± åŠ è½½å®Œæˆï¼Œç»§ç»­æ‰§è¡Œå¯¼å…¥è®°å½•æŸ¥è¯¢');
              resolve(this.resourcePools);
            }
          }, 500);
          
          // è®¾ç½®è¶…æ—¶ï¼Œé¿å…æ— é™ç­‰å¾…
          setTimeout(() => {
            clearInterval(checkInterval);
            console.warn('ç­‰å¾…èµ„æºæ± åŠ è½½è¶…æ—¶ï¼Œä½¿ç”¨ç©ºåˆ—è¡¨');
            resolve([]);
          }, 30000); // 30ç§’è¶…æ—¶
        });
      }
      
      // å¦‚æœæ—¢æ²¡æœ‰åŠ è½½å®Œæˆä¹Ÿæ²¡æœ‰åœ¨åŠ è½½ï¼Œè¿”å›ç©ºåˆ—è¡¨
      console.warn('èµ„æºæ± æœªåŠ è½½ä¸”æœªåœ¨åŠ è½½ä¸­ï¼Œè¿”å›ç©ºåˆ—è¡¨');
      return [];
    },
    switchTab(tabName) {
      this.activeTab = tabName;
      // å¦‚æœåˆ‡æ¢åˆ°ç‰ˆæœ¬åˆ—è¡¨tabä¸”ç‰ˆæœ¬åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™åŠ è½½ç‰ˆæœ¬åˆ—è¡¨
      if (tabName === 'versions' && this.versions.length === 0 && !this.versionsError) {
        this.loadVersions();
      }
      // å¦‚æœåˆ‡æ¢åˆ°å¯¼å…¥è®°å½•tabä¸”å¯¼å…¥è®°å½•ä¸ºç©ºï¼Œåˆ™åŠ è½½å¯¼å…¥è®°å½•
      if (tabName === 'imports' && this.imports.length === 0 && !this.importsError) {
        this.loadImports();
      }
        // å¦‚æœåˆ‡æ¢åˆ°èµ„æºæ± tabï¼Œæ£€æŸ¥å¹¶å‡†å¤‡å¯ç”¨èµ„æºæ± æ•°æ®
        if (tabName === 'resourcePools' && this.isPfsDataset) {
          // å¦‚æœèµ„æºæ± æ•°æ®å·²ç»åŠ è½½ï¼Œç›´æ¥æ˜¾ç¤ºï¼›å¦åˆ™å‡†å¤‡æ•°æ®
          if (this.resourcePools.length > 0) {
            console.log('èµ„æºæ± æ•°æ®å·²å­˜åœ¨ï¼Œç›´æ¥æ˜¾ç¤º');
          } else {
            this.prepareAvailableResourcePools();
          }
        }
    },
    prevPage() {
      if (this.currentPage > 1) {
        this.currentPage--;
        this.loadVersions();
      }
    },
    nextPage() {
      if (this.currentPage < this.totalPages) {
        this.currentPage++;
        this.loadVersions();
      }
    },
      async loadResourcePools(forceRefresh = false) {
        if (!this.formData.resourcePoolType) {
          this.resourcePools = [];
          return;
        }

        console.log('å¼€å§‹åŠ è½½èµ„æºæ± åˆ—è¡¨ï¼Œç±»å‹:', this.formData.resourcePoolType);
        const cacheKey = this.formData.resourcePoolType;

        try {
          // æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ•°æ®ä¸”æœªè¿‡æœŸ
          if (!forceRefresh && this.resourcePoolCache[cacheKey] && this.resourcePoolCacheTime[cacheKey]) {
            const now = Date.now();
            const cacheAge = now - this.resourcePoolCacheTime[cacheKey];
            
            if (cacheAge < this.cacheExpiry) {
              console.log(`ä½¿ç”¨${cacheKey}ç±»å‹èµ„æºæ± ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å¹´é¾„:`, Math.round(cacheAge / 1000), 'ç§’');
              this.resourcePools = [...this.resourcePoolCache[cacheKey]];
              // é‡æ–°è¿‡æ»¤èµ„æºæ± 
              this.refilterResourcePools();
              return;
            }
          }

          // æ„å»ºå®Œæ•´çš„URLå‚æ•°
          const urlParams = new URLSearchParams({
            action: 'DescribeResourcePools',
            resourcePoolType: cacheKey
          });
          const fullUrl = `/api?${urlParams.toString()}`;
          
          // ä½¿ç”¨axioså‘é€è¯·æ±‚ï¼Œè®©HTTPæ‹¦æˆªå™¨å¤„ç†ç¼“å­˜
          const response = await axios.get(fullUrl);
          console.log('èµ„æºæ± APIå“åº”:', response.data);

          if (response.data.error) {
            console.error('åŠ è½½èµ„æºæ± å¤±è´¥:', response.data.error);
            return;
          }

          // å¤„ç†æ–°çš„APIå“åº”æ ¼å¼
          // console.log('èµ„æºæ± APIå®Œæ•´å“åº”:', JSON.stringify(response.data, null, 2));

          let resourcePools = [];
          // æ–°æ¥å£ç›´æ¥åœ¨æ ¹çº§åˆ«è¿”å›resourcePoolsæ•°ç»„
          if (response.data.resourcePools && Array.isArray(response.data.resourcePools)) {
            resourcePools = response.data.resourcePools;
          } else if (response.data.result?.resourcePools) {
            resourcePools = response.data.result.resourcePools;
          } else if (response.data.ResourcePools) {
            resourcePools = response.data.ResourcePools;
          } else if (response.data.result?.ResourcePools) {
            resourcePools = response.data.result.ResourcePools;
          } else if (Array.isArray(response.data)) {
            resourcePools = response.data;
          } else {
            console.warn('æœªè¯†åˆ«çš„èµ„æºæ± APIå“åº”æ ¼å¼:', response.data);
            resourcePools = [];
          }

          this.resourcePools = resourcePools;
          console.log('èµ„æºæ± åˆ—è¡¨åŠ è½½å®Œæˆ:', this.resourcePools.length, 'ä¸ªèµ„æºæ± ');

          // æ›´æ–°ç¼“å­˜ï¼ˆæŒ‰èµ„æºæ± ç±»å‹åˆ†åˆ«ç¼“å­˜ï¼‰
          this.resourcePoolCache[cacheKey] = [...this.resourcePools];
          this.resourcePoolCacheTime[cacheKey] = Date.now();
          console.log(`${cacheKey}ç±»å‹èµ„æºæ± æ•°æ®å·²ç¼“å­˜`);

          // é‡æ–°è¿‡æ»¤èµ„æºæ± 
          this.refilterResourcePools();
          
          // åŒæ­¥æ›´æ–°å¯ç”¨èµ„æºæ± æ•°æ®ï¼ˆç”¨äºå¯ç”¨èµ„æºæ± tabæ˜¾ç¤ºï¼‰
          this.updateAvailableResourcePools();
          
          // å¦‚æœæœ‰å¯ç”¨çš„èµ„æºæ± ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
          const filteredPools = this.filteredResourcePools;
          if (filteredPools.length > 0) {
            this.formData.resourcePool = filteredPools[0].resourcePoolId || filteredPools[0].metadata?.id;
            // åŠ è½½è¯¥èµ„æºæ± çš„é˜Ÿåˆ—
            await this.loadQueues(this.formData.resourcePool);
          }
        } catch (error) {
          console.error('åŠ è½½èµ„æºæ± APIè°ƒç”¨å¤±è´¥:', error);
        }
      },
      
      // æ›´æ–°å¯ç”¨èµ„æºæ± æ•°æ®ï¼ˆä»ç¼“å­˜ä¸­åˆå¹¶æ‰€æœ‰ç±»å‹çš„èµ„æºæ± ï¼‰
      updateAvailableResourcePools() {
        if (!this.isPfsDataset) {
          return;
        }
        
        console.log('æ›´æ–°å¯ç”¨èµ„æºæ± æ•°æ®...');
        
        // åˆå¹¶æ‰€æœ‰ç±»å‹çš„èµ„æºæ± æ•°æ®
        const allResourcePools = [];
        
        // æ·»åŠ è‡ªè¿ç»´èµ„æºæ± 
        if (this.resourcePoolCache.common && this.resourcePoolCache.common.length > 0) {
          allResourcePools.push(...this.resourcePoolCache.common.map(pool => ({
            ...pool,
            resourcePoolType: 'common'
          })));
        }
        
        // æ·»åŠ å…¨æ‰˜ç®¡èµ„æºæ± 
        if (this.resourcePoolCache.dedicatedV2 && this.resourcePoolCache.dedicatedV2.length > 0) {
          allResourcePools.push(...this.resourcePoolCache.dedicatedV2.map(pool => ({
            ...pool,
            resourcePoolType: 'dedicatedV2'
          })));
        }
        
        // æ›´æ–°èµ„æºæ± åˆ—è¡¨ï¼ˆç”¨äºå¯ç”¨èµ„æºæ± tabæ˜¾ç¤ºï¼‰
        this.resourcePools = allResourcePools;
        console.log('å¯ç”¨èµ„æºæ± æ•°æ®æ›´æ–°å®Œæˆ:', this.resourcePools.length, 'ä¸ªèµ„æºæ± ');
      },
      
      // å‡†å¤‡å¯ç”¨èµ„æºæ± æ•°æ®ï¼ˆå½“åˆ‡æ¢åˆ°èµ„æºæ± tabæ—¶è°ƒç”¨ï¼‰
      prepareAvailableResourcePools() {
        if (!this.isPfsDataset) {
          console.log('éPFSæ•°æ®é›†ï¼Œè·³è¿‡å‡†å¤‡å¯ç”¨èµ„æºæ± ');
          return;
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„èµ„æºæ± æ•°æ®
        const hasCommonPools = this.resourcePoolCache.common && this.resourcePoolCache.common.length > 0;
        const hasDedicatedPools = this.resourcePoolCache.dedicatedV2 && this.resourcePoolCache.dedicatedV2.length > 0;
        
        if (!hasCommonPools && !hasDedicatedPools) {
          console.log('æ²¡æœ‰å¯ç”¨çš„èµ„æºæ± ç¼“å­˜æ•°æ®');
          this.resourcePoolError = 'æš‚æ— èµ„æºæ± æ•°æ®ï¼Œè¯·å…ˆåœ¨å¯¼å…¥æ•°æ®åŠŸèƒ½ä¸­åŠ è½½èµ„æºæ± ';
          return;
        }
        
        // æ¸…é™¤é”™è¯¯çŠ¶æ€
        this.resourcePoolError = null;
        
        // æ›´æ–°å¯ç”¨èµ„æºæ± æ•°æ®
        this.updateAvailableResourcePools();
      },
      async loadQueues(resourcePoolId) {
        if (!resourcePoolId) {
          this.queues = [];
          this.formData.queue = '';
          return;
        }

        console.log('å¼€å§‹åŠ è½½é˜Ÿåˆ—åˆ—è¡¨ï¼Œèµ„æºæ± ID:', resourcePoolId);
        try {
          // æ„å»ºå®Œæ•´çš„URLå‚æ•°
          const urlParams = new URLSearchParams({
            action: 'DescribeQueues',
            resourcePoolId: resourcePoolId
          });
          const fullUrl = `/api?${urlParams.toString()}`;
          
          // ä½¿ç”¨axioså‘é€è¯·æ±‚ï¼Œè®©HTTPæ‹¦æˆªå™¨å¤„ç†ç¼“å­˜
          const response = await axios.get(fullUrl);
          console.log('é˜Ÿåˆ—APIå“åº”:', response.data);

          if (response.data.error) {
            console.error('åŠ è½½é˜Ÿåˆ—å¤±è´¥:', response.data.error);
            return;
          }

          // å¤„ç†æ–°çš„APIå“åº”æ ¼å¼
          // console.log('é˜Ÿåˆ—APIå®Œæ•´å“åº”:', JSON.stringify(response.data, null, 2));

          this.queues = response.data.queues;
          console.log('é˜Ÿåˆ—åˆ—è¡¨åŠ è½½å®Œæˆ:', this.queues.length, 'ä¸ªé˜Ÿåˆ—');

          // å¦‚æœæœ‰é˜Ÿåˆ—ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
          if (this.queues.length > 0) {
            this.formData.queue = this.queues[0].queueName || this.queues[0].name;
          } else {
            this.formData.queue = '';
          }
        } catch (error) {
          console.error('åŠ è½½é˜Ÿåˆ—APIè°ƒç”¨å¤±è´¥:', error);
          this.queues = [];
          this.formData.queue = '';
        }
      },
      async onResourcePoolTypeChange() {
        console.log('èµ„æºæ± ç±»å‹é€‰æ‹©å˜åŒ–:', this.formData.resourcePoolType);
        // é‡ç½®èµ„æºæ± å’Œé˜Ÿåˆ—é€‰æ‹©
        this.formData.resourcePool = '';
        this.formData.queue = '';
        this.resourcePools = [];
        this.queues = [];

        // å¦‚æœé€‰æ‹©äº†èµ„æºæ± ç±»å‹ï¼ŒåŠ è½½å¯¹åº”ç±»å‹çš„èµ„æºæ± 
        if (this.formData.resourcePoolType) {
          await this.loadResourcePools();
          // åŠ è½½å®Œæˆåé‡æ–°è¿‡æ»¤èµ„æºæ± 
          this.refilterResourcePools();
        }
      },

      async onResourcePoolChange() {
        console.log('èµ„æºæ± é€‰æ‹©å˜åŒ–:', this.formData.resourcePool);
        // é‡ç½®é˜Ÿåˆ—é€‰æ‹©
        this.formData.queue = '';
        // åŠ è½½æ–°çš„é˜Ÿåˆ—åˆ—è¡¨
        await this.loadQueues(this.formData.resourcePool);
      },

      // åˆ·æ–°èµ„æºæ± åˆ—è¡¨
      async refreshResourcePools() {
        console.log('ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°èµ„æºæ± åˆ—è¡¨');
        await this.loadResourcePools(true); // å¼ºåˆ¶åˆ·æ–°
      },

      // åˆ·æ–°æ•°æ®ç‰ˆæœ¬åˆ—è¡¨
      async refreshDatasetVersions() {
        console.log('ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°æ•°æ®ç‰ˆæœ¬åˆ—è¡¨');
        if (this.formData.sourceDataset) {
          await this.loadDatasetVersions(this.formData.sourceDataset);
        }
      },

      // åˆ·æ–°é˜Ÿåˆ—åˆ—è¡¨
      async refreshQueues() {
        console.log('ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°é˜Ÿåˆ—åˆ—è¡¨');
        if (this.formData.resourcePool) {
          await this.loadQueues(this.formData.resourcePool);
        }
      },

      // åˆ·æ–°æ•°æ®é›†åˆ—è¡¨
      async refreshDatasets() {
        console.log('ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°æ•°æ®é›†åˆ—è¡¨');
        await this.loadAvailableDatasets();
      },

      // è·å–æºè·¯å¾„
      getSourcePath() {
        if (!this.formData.sourceDataset || !this.formData.datasetVersion) return '';

        // è·å–æºæ•°æ®é›†ä¿¡æ¯
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        if (!sourceDataset) return '';

        // è·å–ç‰ˆæœ¬ä¿¡æ¯
        const version = this.datasetVersions.find(v => v.id === this.formData.datasetVersion);
        if (!version || !version.storagePath) return '';

        // æ„å»ºæºè·¯å¾„ï¼šå­˜å‚¨å®ä¾‹:å­˜å‚¨è·¯å¾„
        const storageInstance = sourceDataset.storageInstanceId || sourceDataset.storage_instance_id || sourceDataset.storageInstance;
        if (storageInstance) {
          return `${storageInstance}:${version.storagePath}`;
        } else {
          return version.storagePath;
        }
      },

      // è·å–ç›®æ ‡å­˜å‚¨ä¿¡æ¯
      getTargetStorageInfo() {
        if (!this.dataset) return 'åŠ è½½ä¸­...';

        const storageType = this.dataset.storageType || this.dataset.storage_type || 'æœªçŸ¥';
        const storageInstance = this.dataset.storageInstance || this.dataset.storageInstanceId || 'æœªçŸ¥';

        return `${storageType} (${storageInstance})`;
      },

      // è·å–ç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬
      getTargetDatasetVersion() {
        if (!this.dataset) return 'åŠ è½½ä¸­...';
        if (!this.targetDatasetVersion) return 'åŠ è½½ä¸­...';

        const targetVersion = this.targetDatasetVersion.version;
        return targetVersion;
      },

      // è·å–ç›®æ ‡æ•°æ®é›†ä¿¡æ¯ï¼ˆå½“å‰ç‰ˆæœ¬ï¼‰
      getTargetDatasetInfo() {
        // ä½¿ç”¨ç‚¹å‡»å¯¼å…¥æ•°æ®æŒ‰é’®æ—¶ä¼ å…¥çš„ç‰ˆæœ¬ä¿¡æ¯
        const currentVersion = this.targetDatasetVersion;
        
        if (!currentVersion) {
          return {
            name: this.dataset?.name || 'æœªçŸ¥',
            storageType: this.dataset?.storageType || 'æœªçŸ¥',
            storagePath: 'åŠ è½½ä¸­...',
            mountPath: 'åŠ è½½ä¸­...',
            storageInstance: this.dataset?.storageInstance || 'æœªçŸ¥'
          };
        }

        return {
          name: this.dataset.name,
          storageType: this.dataset.storageType,
          storagePath: currentVersion.storagePath,
          mountPath: currentVersion.mountPath,
          storageInstance: this.dataset.storageInstance
        };
      },

      // è·å–æºæ•°æ®é›†ä¿¡æ¯ï¼ˆé€‰ä¸­ç‰ˆæœ¬ï¼‰
      getSourceDatasetInfo() {
        // ä»å¯é€‰æ•°æ®é›†ä¸­æŸ¥æ‰¾æºæ•°æ®é›†
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);

        // è·å–ç‰ˆæœ¬ä¿¡æ¯
        const version = this.datasetVersions.find(v => v.id === this.formData.datasetVersion);

        return {
          name: sourceDataset.name,
          storageType: sourceDataset.storageType,
          storagePath: version.storagePath,
          mountPath: version.mountPath,
          storageInstance: sourceDataset.storageInstance
        };
      },

      // è·å–ç›®æ ‡å­˜å‚¨è·¯å¾„
      getTargetStoragePath() {
        if (!this.dataset) return 'åŠ è½½ä¸­...';
        if (!this.targetDatasetVersion) return 'åŠ è½½ä¸­...';

        const storagePath = this.targetDatasetVersion.storagePath;
        return storagePath;
      },

      // è·å–ç›®æ ‡è·¯å¾„
      getTargetPath() {
        if (!this.dataset || !this.targetDatasetVersion) return 'æœªçŸ¥ç›®æ ‡æ•°æ®é›†';

        // è·å–ç›®æ ‡æ•°æ®é›†çš„å­˜å‚¨å®ä¾‹å’Œå­˜å‚¨è·¯å¾„ï¼ˆä½¿ç”¨ç›®æ ‡ç‰ˆæœ¬ä¿¡æ¯ï¼‰
        const storageInstance = this.dataset.storageInstance;
        const storagePath = this.targetDatasetVersion.storagePath;

        if (storageInstance) {
          return `${storageInstance}:${storagePath}`;
        } else {
          return storagePath;
        }
      },

      // é¢„åŠ è½½èµ„æºæ± æ•°æ®ï¼ˆåœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ï¼‰
      async preloadResourcePools() {
        console.log('é¢„åŠ è½½èµ„æºæ± æ•°æ®...');
        this.resourcePoolLoadingStatus = 'æ­£åœ¨å¹¶è¡ŒåŠ è½½èµ„æºæ± æ•°æ®...';

        // é¢„åŠ è½½ä¸¤ç§ç±»å‹çš„èµ„æºæ± 
        const resourcePoolTypes = ['common', 'dedicatedV2'];

        // åˆ›å»ºå¹¶è¡ŒåŠ è½½ä»»åŠ¡
        const loadTasks = resourcePoolTypes.map(async (poolType) => {
          // æ£€æŸ¥è¯¥ç±»å‹æ˜¯å¦å·²æœ‰ç¼“å­˜æ•°æ®
          if (this.resourcePoolCache[poolType] && this.resourcePoolCacheTime[poolType]) {
            const now = Date.now();
            const cacheAge = now - this.resourcePoolCacheTime[poolType];

            if (cacheAge < this.cacheExpiry) {
              console.log(`${poolType}ç±»å‹èµ„æºæ± æ•°æ®å·²ç¼“å­˜ï¼Œæ— éœ€é¢„åŠ è½½ï¼Œç¼“å­˜å¹´é¾„:`, Math.round(cacheAge / 1000), 'ç§’');
              return { poolType, success: true, fromCache: true };
            }
          }

          // å¦‚æœæ²¡æœ‰ç¼“å­˜æˆ–ç¼“å­˜å·²è¿‡æœŸï¼Œåˆ™é¢„åŠ è½½
          console.log(`å¼€å§‹é¢„åŠ è½½${poolType}ç±»å‹èµ„æºæ± æ•°æ®...`);
          try {
            // ä½¿ç”¨axioså‘é€è¯·æ±‚ï¼Œè®©HTTPæ‹¦æˆªå™¨å¤„ç†ç¼“å­˜
            const response = await axios.get(`/api?action=DescribeResourcePools&resourcePoolType=${poolType}&keywordType=resourcePoolName&keyword=&orderBy=createdAt&order=DESC&pageNumber=1&pageSize=100`);
            console.log(`é¢„åŠ è½½${poolType}ç±»å‹èµ„æºæ± APIå“åº”:`, response.data);

            if (response.data.error) {
              console.error(`é¢„åŠ è½½${poolType}ç±»å‹èµ„æºæ± å¤±è´¥:`, response.data.error);
              return { poolType, success: false, error: response.data.error };
            }

            // å¤„ç†æ–°çš„APIå“åº”æ ¼å¼å¹¶æ›´æ–°ç¼“å­˜
            // console.log(`é¢„åŠ è½½${poolType}ç±»å‹èµ„æºæ± APIå®Œæ•´å“åº”:`, JSON.stringify(response.data, null, 2));

            let resourcePools = [];
            // æ–°æ¥å£ç›´æ¥åœ¨æ ¹çº§åˆ«è¿”å›resourcePoolsæ•°ç»„
            if (response.data.resourcePools && Array.isArray(response.data.resourcePools)) {
              resourcePools = response.data.resourcePools;
            } else if (response.data.result?.resourcePools) {
              resourcePools = response.data.result.resourcePools;
            } else if (response.data.ResourcePools) {
              resourcePools = response.data.ResourcePools;
            } else if (response.data.result?.ResourcePools) {
              resourcePools = response.data.result.ResourcePools;
            } else if (Array.isArray(response.data)) {
              resourcePools = response.data;
            } else {
              console.warn(`é¢„åŠ è½½æœªè¯†åˆ«çš„${poolType}ç±»å‹èµ„æºæ± APIå“åº”æ ¼å¼:`, response.data);
              resourcePools = [];
            }

            // æ›´æ–°ç¼“å­˜ï¼ˆæŒ‰ç±»å‹åˆ†åˆ«ç¼“å­˜ï¼‰
            this.resourcePoolCache[poolType] = [...resourcePools];
            this.resourcePoolCacheTime[poolType] = Date.now();
            console.log(`${poolType}ç±»å‹èµ„æºæ± æ•°æ®é¢„åŠ è½½å®Œæˆï¼Œç¼“å­˜äº†`, resourcePools.length, 'ä¸ªèµ„æºæ± ');

            return { poolType, success: true, count: resourcePools.length };

          } catch (error) {
            console.error(`é¢„åŠ è½½${poolType}ç±»å‹èµ„æºæ± APIè°ƒç”¨å¤±è´¥:`, error);
            return { poolType, success: false, error: error.message };
          }
        });

        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        const results = await Promise.all(loadTasks);

        // ç»Ÿè®¡ç»“æœ
        const successCount = results.filter(r => r.success).length;
        const totalCount = results.length;
        const fromCacheCount = results.filter(r => r.fromCache).length;
        const newLoadCount = successCount - fromCacheCount;

        console.log(`èµ„æºæ± é¢„åŠ è½½å®Œæˆ: æ€»è®¡${totalCount}ä¸ªç±»å‹ï¼ŒæˆåŠŸ${successCount}ä¸ªï¼Œå…¶ä¸­${fromCacheCount}ä¸ªæ¥è‡ªç¼“å­˜ï¼Œ${newLoadCount}ä¸ªæ–°åŠ è½½`);

        // æ ‡è®°èµ„æºæ± ç¼“å­˜åŠ è½½å®Œæˆ
        this.resourcePoolCacheLoaded = true;
        this.resourcePoolLoadingStatus = `èµ„æºæ± æ•°æ®åŠ è½½å®Œæˆ (${successCount}/${totalCount})ï¼Œå¯¼å…¥æ•°æ®åŠŸèƒ½å·²å¯ç”¨`;
        
        // åˆå¹¶æ‰€æœ‰ç±»å‹çš„èµ„æºæ± åˆ° this.resourcePools
        this.resourcePools = [];
        resourcePoolTypes.forEach(poolType => {
          if (this.resourcePoolCache[poolType]) {
            this.resourcePools.push(...this.resourcePoolCache[poolType]);
          }
        });
        console.log('èµ„æºæ± åˆ—è¡¨åˆå¹¶å®Œæˆï¼Œæ€»è®¡:', this.resourcePools.length, 'ä¸ªèµ„æºæ± ');
        console.log('èµ„æºæ± ç¼“å­˜é¢„åŠ è½½å®Œæˆï¼Œå¯¼å…¥æ•°æ®æŒ‰é’®å·²å¯ç”¨');
        
        // è§¦å‘èµ„æºæ± åŠ è½½å®Œæˆäº‹ä»¶
        this.$emit('resourcePoolsLoaded');

        // å»¶è¿Ÿéšè—æç¤ºä¿¡æ¯
        setTimeout(() => {
          this.resourcePoolLoadingStatus = '';
        }, 2000);
      },
      buildImportCommand() {
        // æ„å»ºæ•°æ®å¯¼å…¥çš„å‘½ä»¤è„šæœ¬
        let command = `#!/bin/bash
set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "å¼€å§‹æ•°æ®å¯¼å…¥ä»»åŠ¡..."
echo "æºè·¯å¾„: $SOURCE_PATH"
echo "ç›®æ ‡è·¯å¾„: $TARGET_PATH"
echo "æ¸…ç©ºæ•°æ®: $CLEAN_DATA"
echo "åŒåä¿ç•™ç­–ç•¥: $NAME_STRATEGY"

# æ£€æŸ¥æºè·¯å¾„æ˜¯å¦å­˜åœ¨
if [ ! -d "$SOURCE_PATH" ]; then
    echo "é”™è¯¯: æºè·¯å¾„ä¸å­˜åœ¨: $SOURCE_PATH"
    exit 1
fi

# åˆ›å»ºç›®æ ‡è·¯å¾„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p "$TARGET_PATH"

# å¦‚æœå¯ç”¨æ¸…ç©ºæ•°æ®ï¼Œå…ˆæ¸…ç©ºç›®æ ‡è·¯å¾„
if [ "$CLEAN_DATA" = "true" ]; then
    echo "æ¸…ç©ºç›®æ ‡è·¯å¾„: $TARGET_PATH"
    rm -rf "$TARGET_PATH"/*
    rm -rf "$TARGET_PATH"/.[^.]* 2>/dev/null || true  # åˆ é™¤éšè—æ–‡ä»¶ï¼Œå¿½ç•¥é”™è¯¯
fi

# æ ¹æ®åŒåä¿ç•™ç­–ç•¥å¤„ç†æ–‡ä»¶å¤åˆ¶
if [ "$NAME_STRATEGY" = "target" ]; then
    echo "ä½¿ç”¨ä¿ç•™ç›®çš„æ–‡ä»¶ç­–ç•¥..."
    # ä½¿ç”¨ rsync å¤åˆ¶ï¼Œä¿ç•™ç›®çš„æ–‡ä»¶
    rsync -av --ignore-existing "$SOURCE_PATH"/ "$TARGET_PATH"/
elif [ "$NAME_STRATEGY" = "source" ]; then
    echo "ä½¿ç”¨ä¿ç•™æºæ–‡ä»¶ç­–ç•¥..."
    # ä½¿ç”¨ rsync å¤åˆ¶ï¼Œè¦†ç›–ç›®çš„æ–‡ä»¶
    rsync -av "$SOURCE_PATH"/ "$TARGET_PATH"/
else
    echo "ä½¿ç”¨é»˜è®¤ç­–ç•¥ï¼ˆä¿ç•™æºæ–‡ä»¶ï¼‰..."
    # é»˜è®¤ä½¿ç”¨ä¿ç•™æºæ–‡ä»¶ç­–ç•¥
    rsync -av "$SOURCE_PATH"/ "$TARGET_PATH"/
fi

# éªŒè¯å¤åˆ¶ç»“æœ
echo "éªŒè¯å¤åˆ¶ç»“æœ..."
source_count=$(find "$SOURCE_PATH" -type f | wc -l)
target_count=$(find "$TARGET_PATH" -type f | wc -l)
echo "æºè·¯å¾„æ–‡ä»¶æ•°é‡: $source_count"
echo "ç›®æ ‡è·¯å¾„æ–‡ä»¶æ•°é‡: $target_count"

if [ "$source_count" -eq "$target_count" ]; then
    echo "æ•°æ®å¯¼å…¥æˆåŠŸå®Œæˆï¼"
else
    echo "è­¦å‘Š: æ–‡ä»¶æ•°é‡ä¸åŒ¹é…ï¼Œè¯·æ£€æŸ¥å¤åˆ¶ç»“æœ"
    exit 1
fi

echo "æ•°æ®å¯¼å…¥ä»»åŠ¡å®Œæˆ"`;

        return command;
    },
    // æäº¤å¯¼å…¥è¡¨å•
      async submitImportForm() {
        console.log('submitImportForm called');
        
        // æ£€æŸ¥æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„æ˜¯å¦ç›¸åŒ
        if (this.checkSourceTargetSame()) {
          alert('æºæ•°æ®é›†ç‰ˆæœ¬å’Œç›®æ ‡æ•°æ®é›†ç‰ˆæœ¬çš„å­˜å‚¨å®ä¾‹å’Œè·¯å¾„ä¸èƒ½å®Œå…¨ç›¸åŒï¼Œè¯·é‡æ–°é€‰æ‹©');
          return;
        }
        
      // è¡¨å•éªŒè¯
        if (this.importMethod === 'existing' && (!this.formData.sourceDataset || !this.formData.datasetVersion)) {
        alert('è¯·é€‰æ‹©æºæ•°æ®é›†å’Œæ•°æ®ç‰ˆæœ¬');
        return;
      }
      
        if (!this.formData.cleanData && !this.formData.nameStrategy) {
        alert('è¯·é€‰æ‹©åŒåä¿ç•™ç­–ç•¥');
        return;
      }

        if (!this.formData.resourcePoolType) {
          alert('è¯·é€‰æ‹©èµ„æºæ± ç±»å‹');
          return;
        }
      
      if (!this.formData.resourcePool || !this.formData.queue) {
        alert('è¯·é€‰æ‹©èµ„æºæ± å’Œé˜Ÿåˆ—');
        return;
      }
      
        // æ„å»ºè®­ç»ƒä»»åŠ¡è¯·æ±‚å‚æ•°ï¼ˆå‚è€ƒAIHCæ–‡æ¡£æ ¼å¼ï¼‰
        // ç¡®ä¿ä»»åŠ¡åç§°ç¬¦åˆ DNS-1123 å­åŸŸåè§„èŒƒï¼šåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦å’Œç‚¹å·
        const sanitizedDatasetId = this.datasetId.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
        const sanitizedVersion = this.formData.datasetVersion.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
        const jobName = `${sanitizedDatasetId}-${sanitizedVersion}-${Date.now()}`;
        const datasource = this.getDatasource();
      const requestParams = {
          name: jobName,
          queue: this.formData.resourcePoolType == 'common' ? this.formData.queue : (this.queues.find(q => q.queueName == this.formData.queue)?.queueId),
          jobType: "PyTorchJob",
          command: this.buildImportCommand(),
          jobSpec: {
            replicas: 1,
            image: "registry.baidubce.com/public/pytorch:1.12.0-cuda11.3-cudnn8-devel",
            resources: [],
            envs: [
              {
                name: "SOURCE_PATH",
                value: datasource[1].mountPath
              },
              {
                name: "TARGET_PATH",
                value: datasource[0].mountPath
              },
              {
                name: "CLEAN_DATA",
                value: this.formData.cleanData ? "true" : "false"
              },
              {
                name: "NAME_STRATEGY",
                value: this.formData.nameStrategy
              },
              {
                name: "IMPORT_METHOD",
                value: this.importMethod
              }
            ],
            enableRDMA: false
          },
          labels: [
            {
              "key": "type",
              "value": "data-import"
            },
            {
              "key": "dataset",
              "value": `dataset-${this.datasetId}`
            }
          ],
          "datasource": datasource
        };

        console.log('åˆ›å»ºè®­ç»ƒä»»åŠ¡è¯·æ±‚å‚æ•°:', JSON.stringify(requestParams, null, 2));

        try {
          // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
          const submitBtn = document.querySelector('.form-actions .btn-primary');
          if (submitBtn) {
            submitBtn.textContent = 'åˆ›å»ºä»»åŠ¡ä¸­...';
            submitBtn.disabled = true;
          }

          // è°ƒç”¨åˆ›å»ºè®­ç»ƒä»»åŠ¡API
          const response = await axios.post(`/api?action=CreateJob&resourcePoolId=${this.formData.resourcePoolType == 'common' ? this.formData.resourcePool : 'aihc-serverless'}`, requestParams);
          console.log('åˆ›å»ºè®­ç»ƒä»»åŠ¡APIå“åº”:', response.data);

          if (response.data.error) {
            alert('åˆ›å»ºå¯¼å…¥ä»»åŠ¡å¤±è´¥: ' + response.data.error);
          } else {
            const jobId = response.data.jobId || response.data.result?.jobId;
            const jobName = response.data.jobName || response.data.result?.jobName;
            alert(`å¯¼å…¥ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼\nä»»åŠ¡ID: ${jobId}\nä»»åŠ¡åç§°: ${jobName}`);
      // å…³é—­æŠ½å±‰
            closeDrawer();
          }
        } catch (error) {
          console.error('åˆ›å»ºè®­ç»ƒä»»åŠ¡APIè°ƒç”¨å¤±è´¥:', error);
          alert('åˆ›å»ºå¯¼å…¥ä»»åŠ¡å¤±è´¥: ' + (error.response?.data?.error || error.message || 'æœªçŸ¥é”™è¯¯'));
        } finally {
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          const submitBtn = document.querySelector('.form-actions .btn-primary');
          if (submitBtn) {
            submitBtn.textContent = 'ç¡®å®š';
            submitBtn.disabled = false;
          }
        }
      },
      getDatasource() {
        const targetDatasetInfo = this.getTargetDatasetInfo();
        const sourceDatasetInfo = this.getSourceDatasetInfo();
        console.log('targetDatasetInfo', targetDatasetInfo);
        console.log('sourceDatasetInfo', sourceDatasetInfo);

        const targetDatasetType = targetDatasetInfo.storageType.toLowerCase();
        const sourceDatasetType = sourceDatasetInfo.storageType.toLowerCase();
        const targetDatasetName = targetDatasetType === 'pfs' ? targetDatasetInfo.storageInstance : '';
        const sourceDatasetName = sourceDatasetType === 'pfs' ? sourceDatasetInfo.storageInstance : '';
        const targetDatasetPath = targetDatasetType === 'pfs' ? targetDatasetInfo.storagePath : `${targetDatasetInfo.storageInstance}${targetDatasetInfo.storagePath}`;
        const sourceDatasetPath = sourceDatasetType === 'pfs' ? sourceDatasetInfo.storagePath : `${sourceDatasetInfo.storageInstance}${sourceDatasetInfo.storagePath}`;
        return [
          // ç›®æ ‡æ•°æ®é›† DataSource
          {
            type: targetDatasetType,
            name: targetDatasetName,
            sourcePath: targetDatasetPath,
            mountPath: '/mnt/target'
          },
          // æºæ•°æ®é›† DataSource
          {
            type: sourceDatasetType,
            name: sourceDatasetName,
            sourcePath: sourceDatasetPath,
            mountPath: '/mnt/source'
          }
        ]
    },
    formatDate(dateStr) {
      if (!dateStr) return 'N/A';
      try {
        const date = new Date(dateStr);
        return date.toLocaleString('zh-CN');
      } catch (e) {
        return dateStr;
      }
    },
    statusText(status) {
      const statusMap = {
        'Pending': 'ç­‰å¾…ä¸­',
        'Running': 'è¿è¡Œä¸­',
        'Succeeded': 'æˆåŠŸ',
        'Failed': 'å¤±è´¥',
        'Cancelled': 'å·²å–æ¶ˆ',
        'Unknown': 'æœªçŸ¥'
      };
      return statusMap[status] || status || 'æœªçŸ¥';
    },
    statusClass(status) {
      const classMap = {
        'Pending': 'status-pending',
        'Running': 'status-running',
        'Succeeded': 'status-success',
        'Failed': 'status-error',
        'Cancelled': 'status-cancelled',
        'Unknown': 'status-unknown'
      };
      return classMap[status] || 'status-unknown';
    },
    viewImportJob(importJob) {
      // ä»ä»»åŠ¡æ•°æ®ä¸­è·å–èµ„æºæ± ID
      const resourcePoolId = importJob.resourcePoolId || 'aihc-serverless';
      
      // è·³è½¬åˆ°ä»»åŠ¡è¯¦æƒ…é¡µé¢ï¼Œä¼ é€’èµ„æºæ± IDå’Œæ¥æºé¡µé¢å‚æ•°
      window.location.href = `/jobs/${importJob.jobId}?resourcePoolId=${resourcePoolId}&from=imports&datasetId=${this.datasetId}`;
    },
    formatVisibility(visibilityScope) {
      if (!visibilityScope) return 'N/A';
      const visibilityMap = {
        'ALL_PEOPLE': 'æ‰€æœ‰äººå¯è§',
        'USER_GROUP': 'ç”¨æˆ·ç»„å¯è§',
        'ONLY_OWNER': 'ä»…æ‰€æœ‰è€…å¯è§'
      };
      return visibilityMap[visibilityScope] || visibilityScope;
    },
    copyDatasetId(id) {
      if (!id) return;
      
      // ä½¿ç”¨ç°ä»£æµè§ˆå™¨çš„Clipboard API
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(id).then(() => {
          this.showCopySuccess();
        }).catch(err => {
          console.error('å¤åˆ¶å¤±è´¥:', err);
          this.fallbackCopy(id);
        });
      } else {
        // é™çº§æ–¹æ¡ˆ
        this.fallbackCopy(id);
      }
    },
    fallbackCopy(text) {
      // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        this.showCopySuccess();
      } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
      }
      
      document.body.removeChild(textArea);
    },
    showCopySuccess() {
      // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
      const toast = document.createElement('div');
      toast.textContent = 'æ•°æ®é›†IDå·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #52c41a;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        z-index: 10000;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
      `;
      
      // æ·»åŠ åŠ¨ç”»æ ·å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(toast);
      
      // 3ç§’åè‡ªåŠ¨ç§»é™¤
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 3000);
    }
  },
  mounted() {
      // ç¡®ä¿æŠ½å±‰åˆå§‹çŠ¶æ€æ˜¯éšè—çš„
      this.drawerVisible = false;
    this.loadDataset();
  }
}).mount('#app');
</script>
{% endblock %}