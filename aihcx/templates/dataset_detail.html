{% extends "base.html" %}
{% from "components/navigation.html" import navigation %}

{% block title %}AIHCX Êï∞ÊçÆÈõÜËØ¶ÊÉÖ{% endblock %}

{% block header_title %}üìä Êï∞ÊçÆÈõÜËØ¶ÊÉÖ{% endblock %}
{% block header_subtitle %}Êü•ÁúãÊï∞ÊçÆÈõÜËØ¶ÁªÜ‰ø°ÊÅØ{% endblock %}

{% block extra_css %}
<style>
    .action-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .btn-back {
        background: #6c757d;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
    }
    
    .btn-back:hover {
        background: #5a6268;
    }
    
    .dataset-card {
        background: var(--panel-bg);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        margin-bottom: 24px;
        overflow: hidden;
    }
    
    .dataset-card-header {
        background: #f8f9fa;
        padding: 16px 24px;
        border-bottom: 1px solid var(--border);
    }
    
    .dataset-card-header h5 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
    }
    
    .dataset-card-body {
        padding: 24px;
    }
    
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .info-item {
        margin-bottom: 16px;
    }
    
    .info-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 4px;
        font-size: 14px;
    }
    
    .info-value {
        font-size: 15px;
        color: var(--text);
        word-break: break-all;
    }
    
    .nav-tabs {
        display: flex;
        border-bottom: 1px solid var(--border);
        margin-bottom: 24px;
    }
    
    .nav-tab {
        padding: 12px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        color: var(--muted);
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .nav-tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }
    
    .nav-tab:hover:not(.active) {
        color: var(--text);
        background: #f8f9fa;
    }
    
    .tab-content {
        min-height: 300px;
    }
    
  .loading,
  .error {
        text-align: center;
        padding: 40px 20px;
        color: var(--muted);
    }
    
    .error {
        color: #dc3545;
    }

  .resource-pool-loading-info {
    background: #e3f2fd;
    border: 1px solid #bbdefb;
    border-radius: 8px;
    padding: 16px;
    margin: 16px 0;
    color: #1976d2;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .resource-pool-loading-info i {
    font-size: 16px;
    color: #1976d2;
  }
    
    .table-container {
        overflow-x: auto;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
    }
    
    .versions-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--panel-bg);
    }
    
    .versions-table th {
        background: #f8f9fa;
        padding: 14px 16px;
        text-align: left;
        font-weight: 600;
        color: #495057;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }
    
    .versions-table td {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
    }
    
    .versions-table tr:hover {
        background: #f8f9fa;
    }
    
    .btn-primary {
        background: var(--primary);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
        background: var(--primary-600);
    }

  .btn-primary:disabled {
    background: #6c757d;
    border-color: #6c757d;
    cursor: not-allowed;
    opacity: 0.6;
  }

  .btn-primary:disabled:hover {
    background: #6c757d;
    border-color: #6c757d;
    transform: none;
  }
    
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 24px;
        gap: 8px;
    }
    
    .pagination button {
        padding: 8px 14px;
        border: 1px solid var(--border);
        background: var(--panel-bg);
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
    }
    
    .pagination button:hover:not(:disabled) {
        background: #f8f9fa;
    }
    
    .pagination button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .pagination-info {
        margin: 0 16px;
        color: var(--muted);
        font-size: 14px;
    }
    
    .drawer {
        position: fixed;
        top: 0;
        right: 0;
    width: 50vw;
    max-width: 800px;
    min-width: 400px;
    height: 100vh;
        background-color: white;
    box-shadow: -2px 0 20px rgba(0, 0, 0, 0.15);
    z-index: 10000;
    display: none;
        flex-direction: column;
    overflow: hidden;
    animation: slideIn 0.3s ease-out;
    }
    
    .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999;
        display: none;
    animation: fadeIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
    }

    to {
      transform: translateX(0);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
    }
    
    .drawer-header {
    padding: 24px 24px 16px 24px;
        border-bottom: 1px solid var(--border);
    position: relative;
    }
    
    .drawer-header h4 {
    margin: 0 0 8px 0;
        font-size: 20px;
        font-weight: 600;
        color: var(--text);
    }

  .drawer-description {
    margin: 0;
    font-size: 14px;
    color: var(--muted);
    line-height: 1.5;
  }
    
    .drawer-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--muted);
    width: 40px;
    height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
    }
    
    .drawer-close:hover {
        background: #f1f3f4;
        color: var(--text);
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #495057;
        font-size: 14px;
    }

  .count-badge {
    display: inline-block;
    background: #e3f2fd;
    color: #1976d2;
    font-size: 12px;
    font-weight: 500;
    padding: 2px 8px;
    border-radius: 12px;
    margin-left: 8px;
    border: 1px solid #bbdefb;
  }

  .count-badge.zero-count {
    background: #ffebee;
    color: #d32f2f;
    border-color: #ffcdd2;
  }
    
    .form-control {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.2s ease;
    box-sizing: border-box;
    max-width: 100%;
    min-width: 0;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(43, 109, 239, 0.12);
  }

  /* Ê∫êÊï∞ÊçÆÈõÜ‰∏ãÊãâÊ°ÜÊ†∑Âºè‰ºòÂåñ */
  .form-control option {
    padding: 8px 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* Á°Æ‰øù‰∏ãÊãâÊ°ÜÊúâË∂≥Â§üÁöÑÂÆΩÂ∫¶ÊòæÁ§∫ÈïøÊñáÊú¨ */
  select.form-control {
    min-width: 100%;
    max-width: 100%;
    }
    
    .radio-group {
        display: flex;
        gap: 20px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }
    
    .radio-item {
        display: flex;
        align-items: center;
    cursor: pointer;
    padding: 8px 12px;
    border-radius: 6px;
    transition: all 0.2s ease;
  }

  .radio-item:hover {
    background: #f8f9fa;
  }

  .radio-item input[type="radio"] {
        margin-right: 8px;
    width: 16px;
    height: 16px;
    accent-color: var(--primary);
  }

  .radio-label {
    font-size: 14px;
    color: var(--text);
    cursor: pointer;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        margin-bottom: 16px;
    }
    
    .checkbox-item input {
        margin-right: 8px;
    }
    
  .transfer-summary {
    flex: 1;
    font-size: 13px;
    color: #6c757d;
    line-height: 1.4;
    word-break: break-all;
    margin-right: 16px;
  }

  .transfer-summary .source-path {
    background: #e3f2fd;
    color: #1976d2;
    padding: 1px 4px;
    border-radius: 3px;
    font-family: monospace;
    font-weight: 500;
    font-size: 12px;
  }

  .transfer-summary .target-path {
    background: #f3e5f5;
    color: #7b1fa2;
    padding: 1px 4px;
    border-radius: 3px;
    font-family: monospace;
    font-weight: 500;
    font-size: 12px;
  }

  .transfer-summary .empty-hint {
    color: #dc3545;
    font-style: italic;
  }

  .transfer-summary .warning-message {
    color: #dc3545;
    font-weight: 500;
    background: #f8d7da;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #f5c6cb;
  }

  /* ËøáÊª§ÊèêÁ§∫Ê†∑Âºè */
  .filter-hint {
    margin-top: 8px;
    animation: fadeIn 0.3s ease-in;
  }

  .filter-hint-content {
    background: #e7f3ff;
    border: 1px solid #b3d9ff;
    border-radius: 6px;
    padding: 12px 16px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .filter-hint-icon {
    font-size: 16px;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .filter-hint-text {
    flex: 1;
  }

  .filter-hint-title {
    font-weight: 600;
    color: #0066cc;
    margin-bottom: 4px;
    font-size: 13px;
  }

  .filter-hint-message {
    color: #4d4d4d;
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-line;
  }

  .filter-hint-actions {
    margin-top: 8px;
  }

  .btn-details {
    background: #0066cc;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 6px 12px;
    font-size: 11px;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .btn-details:hover {
    background: #0052a3;
  }

  /* ËµÑÊ∫êÊ±†ËØ¶ÊÉÖÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
  .resource-pool-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    position: relative;
    background: white;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow: hidden;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #e0e0e0;
    background: #f8f9fa;
  }

  .modal-header h3 {
    margin: 0;
    font-size: 16px;
    color: #333;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #666;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-close:hover {
    color: #333;
  }

  .modal-body {
    padding: 20px;
    max-height: 60vh;
    overflow-y: auto;
  }

  .resource-pool-details {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 12px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    line-height: 1.4;
    white-space: pre-line;
    margin: 0;
  }

  .modal-footer {
    padding: 16px 20px;
    border-top: 1px solid #e0e0e0;
    background: #f8f9fa;
    text-align: right;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-5px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ÂÜ≤Á™ÅÊèêÁ§∫Ê∂àÊÅØÊ†∑Âºè */
  .conflict-message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    animation: slideDown 0.3s ease-out;
  }

  .conflict-content {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 300px;
    max-width: 500px;
  }

  .conflict-icon {
    font-size: 18px;
    flex-shrink: 0;
  }

  .conflict-text {
    color: #856404;
    font-weight: 500;
    flex: 1;
  }

  .conflict-close {
    background: none;
    border: none;
    color: #856404;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s;
  }

  .conflict-close:hover {
    background-color: rgba(133, 100, 4, 0.1);
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  .action-buttons {
        display: flex;
        gap: 12px;
    flex-shrink: 0;
  }

  .form-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
        margin-top: 32px;
    padding: 20px 20px;
        border-top: 1px solid var(--border);
    position: sticky;
    bottom: 0;
    background: white;
    z-index: 10;
    }
    
    .btn {
    padding: 12px 24px;
        border: none;
    border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
    min-width: 100px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    }
    
  .btn-primary {
    background: var(--primary);
        color: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px);
  }

  .btn-secondary {
    background: white;
    color: var(--text);
    border: 1px solid var(--border);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }
    
    .btn-secondary:hover {
    background: var(--hover);
    border-color: var(--primary);
    color: var(--primary);
    transform: translateY(-1px);
    }
    
    .copy-btn {
        margin-left: 10px;
        padding: 4px 8px;
        font-size: 12px;
    }

  .drawer-content {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
    max-width: 100%;
    box-sizing: border-box;
    width: 100%;
  }

  .drawer-content .form-group {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }

  .readonly-input {
    background-color: #f8f9fa !important;
    color: #6c757d !important;
    cursor: not-allowed !important;
    border: 1px solid #e9ecef !important;
    font-family: monospace;
    font-size: 13px;
  }

  .readonly-input:focus {
    outline: none !important;
    border-color: #e9ecef !important;
    box-shadow: none !important;
  }

  .target-dataset-summary {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
    padding: 12px 16px;
    background: #f8f9fa;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    font-size: 14px;
    flex-wrap: wrap;
  }

  .summary-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .summary-label {
    font-weight: 500;
    color: #6c757d;
    white-space: nowrap;
  }

  .summary-value {
    color: #495057;
    font-family: monospace;
    font-size: 13px;
  }

  .disabled-group {
    opacity: 0.6;
    pointer-events: none;
  }

  .disabled-group .form-label.required::after {
    display: none;
  }

  .radio-group.disabled {
    opacity: 0.5;
  }

  .radio-group.disabled input[type="radio"] {
    cursor: not-allowed;
  }

  .disabled-hint {
    font-size: 12px;
    color: #6c757d;
    font-style: italic;
    margin-top: 8px;
    margin-bottom: 0;
  }

  .import-method-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }

  .tab-item {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    position: relative;
    background: white;
  }

  .tab-item:hover {
    border-color: var(--primary);
    background: #f8f9fa;
  }

  .tab-item.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .tab-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #ffc107;
    color: #000;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }

  .form-label.required::after {
    content: " *";
    color: #dc3545;
  }

  .toggle-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toggle-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: 500;
  }

  .toggle-input {
    display: none;
  }

  .toggle-slider {
    width: 44px;
    height: 24px;
    background: #ccc;
    border-radius: 12px;
    position: relative;
    margin-right: 12px;
    transition: background 0.3s ease;
  }

  .toggle-slider::before {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: transform 0.3s ease;
  }

  .toggle-input:checked+.toggle-slider {
    background: var(--primary);
  }

  .toggle-input:checked+.toggle-slider::before {
    transform: translateX(20px);
  }

  .toggle-description {
    margin: 0;
    font-size: 13px;
    color: var(--muted);
    line-height: 1.4;
  }

  .resource-pool-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .resource-pool-group .form-control {
    flex: 1;
    min-width: 0;
    /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
    max-width: calc(100% - 48px);
    /* ‰∏∫ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
  }

  .dataset-filter-group {
    margin-bottom: 12px;
  }

  .filter-select {
    width: 120px;
    font-size: 13px;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #f8f9fa;
    color: #495057;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(43, 109, 239, 0.12);
    background: white;
  }

  .dataset-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .dataset-group .form-control {
    flex: 1;
    min-width: 0;
    /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
    max-width: calc(100% - 48px);
    /* ‰∏∫ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
  }

  .version-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .version-group .form-control {
    flex: 1;
    min-width: 0;
    /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
    max-width: calc(100% - 48px);
    /* ‰∏∫ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
  }

  .queue-group {
    display: flex;
    gap: 8px;
    align-items: center;
    width: 100%;
  }

  .queue-group .form-control {
    flex: 1;
    min-width: 0;
    /* Èò≤Ê≠¢ÂÜÖÂÆπÊ∫¢Âá∫ */
    max-width: calc(100% - 48px);
    /* ‰∏∫ÊåâÈíÆÁïôÂá∫Á©∫Èó¥ */
  }

  .btn-refresh {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 40px;
    height: 38px;
    transition: all 0.2s ease;
    flex-shrink: 0;
    /* Èò≤Ê≠¢ÊåâÈíÆË¢´ÂéãÁº© */
  }

  .btn-refresh:hover {
    background: #e9ecef;
    border-color: #adb5bd;
  }

  .btn-refresh:active {
    background: #dee2e6;
    transform: scale(0.95);
  }

  .btn-refresh span {
    font-size: 14px;
    line-height: 1;
  }

  /* ËµÑÊ∫êÊ±†Áõ∏ÂÖ≥Ê†∑Âºè */
  .resource-pool-section {
    margin-bottom: 32px;
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
    font-size: 18px;
    font-weight: 600;
    color: #333;
    border-bottom: 2px solid #e9ecef;
    padding-bottom: 8px;
  }

  .section-title i {
    color: #007bff;
  }

  .count-badge {
    background: #007bff;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 8px;
  }

  .resource-pool-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 16px;
  }

  .resource-pool-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.2s ease;
  }

  .resource-pool-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }

  .resource-pool-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
  }

  .resource-pool-name {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
    flex: 1;
    word-break: break-word;
  }

  .resource-pool-type {
    background: #e3f2fd;
    color: #1976d2;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid #bbdefb;
  }

  .resource-pool-type.dedicated {
    background: #f3e5f5;
    color: #7b1fa2;
    border-color: #ce93d8;
  }

  .resource-pool-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .info-item {
    display: flex;
    align-items: flex-start;
    gap: 8px;
  }

  .info-item .label {
    font-weight: 600;
    color: #666;
    min-width: 80px;
    font-size: 14px;
  }

  .info-item .value {
    color: #333;
    font-size: 14px;
    word-break: break-word;
    flex: 1;
  }

  .storage-tag {
    display: inline-block;
    background: #f8f9fa;
    color: #495057;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 12px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    border: 1px solid #e9ecef;
    margin-right: 4px;
    margin-bottom: 4px;
  }

  .empty-state {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 40px 20px;
    color: #666;
    font-size: 14px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #dee2e6;
  }

  .empty-state i {
    font-size: 16px;
    color: #adb5bd;
  }
  
  /* Áä∂ÊÄÅÊ†∑Âºè */
  .status {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
  }
  
  .status-pending {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
  }
  
  .status-running {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
  }
  
  .status-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }
  
  .status-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
  
  .status-cancelled {
    background-color: #e2e3e5;
    color: #383d41;
    border: 1px solid #d6d8db;
  }
  
  .status-unknown {
    background-color: #f8f9fa;
    color: #6c757d;
    border: 1px solid #dee2e6;
  }
</style>
{% endblock %}

{% block content %}
<div id="app">
    <div class="page-container">
        <!-- Êìç‰ΩúÊ†è -->
        <div class="action-bar">
            <a href="/datasets" class="btn-back">
                <i class="fas fa-arrow-left"></i> ËøîÂõûÊï∞ÊçÆÈõÜÂàóË°®
            </a>

        </div>
        
        <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
        <div v-if="loading" class="loading">
            <i class="fas fa-spinner fa-spin"></i> Êï∞ÊçÆÂä†ËΩΩ‰∏≠...
        </div>
        
        <!-- ÈîôËØØ‰ø°ÊÅØ -->
        <div v-if="error" class="error">
            <i class="fas fa-exclamation-circle"></i> [[ error ]]
        </div>
        
        <!-- Êï∞ÊçÆÈõÜÂü∫Êú¨‰ø°ÊÅØ -->
        <div v-if="dataset && !loading">
            <div class="dataset-card">
                <div class="dataset-card-header">
                    <h5>[[ dataset.name ]]</h5>
                </div>
                <div class="dataset-card-body">
                    <div class="info-grid">
                        <div>
                            <div class="info-item">
                                <div class="info-label">Êï∞ÊçÆÈõÜID</div>
                                <div class="info-value">
                                    [[ dataset.id ]]
                                    <button @click="copyDatasetId(dataset.id)" class="btn btn-sm btn-outline-primary copy-btn">Â§çÂà∂</button>
                                </div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ÂàõÂª∫Êó∂Èó¥</div>
                                <div class="info-value">[[ formatDate(dataset.createdAt) ]]</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Êõ¥Êñ∞Êó∂Èó¥</div>
                                <div class="info-value">[[ formatDate(dataset.updatedAt) ]]</div>
                            </div>
                        </div>
                        <div>
                            <div class="info-item">
                                <div class="info-label">Â≠òÂÇ®Á±ªÂûã</div>
                                <div class="info-value">[[ dataset.storageType ]]</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ÂèØËßÅËåÉÂõ¥</div>
                                <div class="info-value">[[ formatVisibility(dataset.visibilityScope) ]]</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ÊúÄÊñ∞ÁâàÊú¨</div>
                                <div class="info-value">[[ dataset.latestVersion ]]</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TabÂØºËà™ -->
        <div class="nav-tabs" v-if="dataset && !loading">
            <div class="nav-tab" :class="{active: activeTab === 'basic'}" @click="switchTab('basic')">
                Âü∫Êú¨‰ø°ÊÅØ
            </div>
            <div class="nav-tab" :class="{active: activeTab === 'versions'}" @click="switchTab('versions')">
                ÁâàÊú¨ÂàóË°®
            </div>
            <div class="nav-tab" :class="{active: activeTab === 'imports'}" @click="switchTab('imports')">
                ÂØºÂÖ•ËÆ∞ÂΩï
            </div>
      <div class="nav-tab" :class="{active: activeTab === 'resourcePools'}" @click="switchTab('resourcePools')" v-if="isPfsDataset">
        ÂèØÁî®ËµÑÊ∫êÊ±†
      </div>
        </div>
        
        <!-- TabÂÜÖÂÆπ -->
        <div class="tab-content">
            <!-- Âü∫Êú¨‰ø°ÊÅØTab -->
            <div v-show="activeTab === 'basic'" v-if="dataset && !loading">
        <!-- ËµÑÊ∫êÊ±†ËΩΩÂÖ•Áä∂ÊÄÅÊèêÁ§∫ -->
        <div v-if="!resourcePoolCacheLoaded" class="resource-pool-loading-info">
          <i class="fas fa-spinner fa-spin"></i>
          <span>[[ resourcePoolLoadingStatus ]]</span>
        </div>

                <div class="dataset-card">
                    <div class="dataset-card-body">
                        <h6>ËØ¶ÁªÜ‰ø°ÊÅØ</h6>
                        <div class="info-grid">
                            <div>
                                <div class="info-item">
                                    <div class="info-label">ÊâÄÊúâËÄÖ</div>
                                    <div class="info-value">[[ dataset.ownerName ]] ([[ dataset.owner ]])</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">ÂØºÂÖ•Ê†ºÂºè</div>
                                    <div class="info-value">[[ dataset.importFormat ]]</div>
                                </div>
                            </div>
                            <div>
                                <div class="info-item">
                                    <div class="info-label">Â≠òÂÇ®ÂÆû‰æã</div>
                                    <div class="info-value">[[ dataset.storageInstance ]]</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÁâàÊú¨ÂàóË°®Tab -->
            <div v-show="activeTab === 'versions'">
                <div class="mt-3">
          <!-- ËµÑÊ∫êÊ±†ËΩΩÂÖ•Áä∂ÊÄÅÊèêÁ§∫ -->
          <div v-if="!resourcePoolCacheLoaded" class="resource-pool-loading-info">
            <i class="fas fa-spinner fa-spin"></i>
            <span>[[ resourcePoolLoadingStatus ]]</span>
          </div>

                    <!-- ÁâàÊú¨ÂàóË°®Âä†ËΩΩÁä∂ÊÄÅ -->
                    <div v-if="versionsLoading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> ÁâàÊú¨ÂàóË°®Âä†ËΩΩ‰∏≠...
                    </div>
                    
                    <!-- ÁâàÊú¨ÂàóË°®ÈîôËØØ‰ø°ÊÅØ -->
                    <div v-if="versionsError" class="error">
                        <i class="fas fa-exclamation-circle"></i> [[ versionsError ]]
                    </div>
                    
                    <!-- ÁâàÊú¨ÂàóË°® -->
                    <div v-if="!versionsLoading && !versionsError && versions.length > 0">
                        <div class="table-container">
                            <table class="versions-table">
                                <thead>
                                    <tr>
                                        <th>ÁâàÊú¨</th>
                                        <th>ÂàõÂª∫Êó∂Èó¥</th>
                                        <th>ÂàõÂª∫ËÄÖ</th>
                                        <th>Â≠òÂÇ®Ë∑ØÂæÑ</th>
                                        <th>ÊåÇËΩΩË∑ØÂæÑ</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="version in versions" :key="version.id">
                                        <td>[[ version.version ]]</td>
                                        <td>[[ formatDate(version.createdAt) ]]</td>
                                        <td>[[ version.createUserName ]]</td>
                                        <td>[[ version.storagePath ]]</td>
                                        <td>[[ version.mountPath ]]</td>
                                        <td>
                      <button @click="showImportDrawer(version)" class="btn-primary"
                        :disabled="!resourcePoolCacheLoaded"
                        :title="resourcePoolCacheLoaded ? 'ÂØºÂÖ•Êï∞ÊçÆ' : 'ËµÑÊ∫êÊ±†ÁºìÂ≠òÂä†ËΩΩ‰∏≠ÔºåËØ∑Á®çÂÄô...'">
                        ÂØºÂÖ•Êï∞ÊçÆ
                      </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- ÂàÜÈ°µ -->
                        <div class="pagination">
                            <button @click="prevPage" :disabled="currentPage === 1">
                                <i class="fas fa-chevron-left"></i> ‰∏ä‰∏ÄÈ°µ
                            </button>
                            <span class="pagination-info">
                                Á¨¨ [[ currentPage ]] È°µÔºåÂÖ± [[ totalPages ]] È°µ
                            </span>
                            <button @click="nextPage" :disabled="currentPage === totalPages">
                                ‰∏ã‰∏ÄÈ°µ <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Êó†ÁâàÊú¨Êï∞ÊçÆ -->
                    <div v-if="!versionsLoading && !versionsError && versions.length === 0" class="loading">
                        ÊöÇÊó†ÁâàÊú¨Êï∞ÊçÆ
                    </div>
                </div>
            </div>

            <!-- ÂØºÂÖ•ËÆ∞ÂΩïTab -->
            <div v-show="activeTab === 'imports'">
                <div class="mt-3">
                    <!-- ËµÑÊ∫êÊ±†ËΩΩÂÖ•Áä∂ÊÄÅÊèêÁ§∫ -->
                    <div v-if="!resourcePoolCacheLoaded" class="resource-pool-loading-info">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>[[ resourcePoolLoadingStatus ]]</span>
                    </div>
                    
                    <!-- ÂØºÂÖ•ËÆ∞ÂΩïÂä†ËΩΩÁä∂ÊÄÅ -->
                    <div v-if="importsLoading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i> ÂØºÂÖ•ËÆ∞ÂΩïÂä†ËΩΩ‰∏≠...
                    </div>
                    
                    <!-- ÂØºÂÖ•ËÆ∞ÂΩïÈîôËØØ‰ø°ÊÅØ -->
                    <div v-if="importsError" class="error">
                        <i class="fas fa-exclamation-circle"></i> [[ importsError ]]
                    </div>
                    
                    <!-- ÂØºÂÖ•ËÆ∞ÂΩïÂàóË°® -->
                    <div v-if="resourcePoolCacheLoaded && !importsLoading && !importsError && imports.length > 0">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>‰ªªÂä°ÂêçÁß∞</th>
                                        <th>Áä∂ÊÄÅ</th>
                                        <th>ÂàõÂª∫Êó∂Èó¥</th>
                                        <th>ÂÆåÊàêÊó∂Èó¥</th>
                                        <th>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="importJob in imports" :key="importJob.jobId">
                                        <td>
                                            <span class="job-name">[[ importJob.name ]]</span>
                                            <br>
                                            <span class="job-id">[[ importJob.jobId ]]</span>
                                        </td>
                                        <td>
                                            <span class="status" :class="statusClass(importJob.status)">
                                                [[ statusText(importJob.status) ]]
                                            </span>
                                        </td>
                                        <td>[[ formatDate(importJob.createdAt) ]]</td>
                                        <td>[[ formatDate(importJob.finishedAt) ]]</td>
                                        <td>
                                            <button class="btn-primary" @click="viewImportJob(importJob)">
                                                Êü•ÁúãËØ¶ÊÉÖ
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Á©∫Áä∂ÊÄÅ -->
                    <div v-if="resourcePoolCacheLoaded && !importsLoading && !importsError && imports.length === 0" class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>ÊöÇÊó†ÂØºÂÖ•ËÆ∞ÂΩï</p>
                    </div>
                </div>
            </div>

      <!-- ÂèØÁî®ËµÑÊ∫êÊ±†Tab -->
      <div v-show="activeTab === 'resourcePools'" v-if="isPfsDataset">
        <div class="mt-3">
          <!-- ËµÑÊ∫êÊ±†ÈîôËØØ‰ø°ÊÅØ -->
          <div v-if="resourcePoolError" class="error">
            <i class="fas fa-exclamation-circle"></i> [[ resourcePoolError ]]
        </div>

          <!-- ÂèØÁî®ËµÑÊ∫êÊ±†ÂàóË°® -->
          <div v-if="!resourcePoolError">
            <div class="resource-pool-section">
              <h4 class="section-title">
                <i class="fas fa-server"></i> ÂèØÁî®ËµÑÊ∫êÊ±†
                <span class="count-badge">[[ availableResourcePools.length ]]</span>
              </h4>
              <div v-if="availableResourcePools.length > 0" class="resource-pool-grid">
                <div v-for="pool in availableResourcePools" :key="pool.resourcePoolId" class="resource-pool-card">
                  <div class="resource-pool-header">
                    <h5 class="resource-pool-name">[[ pool.name || pool.metadata?.name || pool.resourcePoolId ]]</h5>
                    <span class="resource-pool-type" :class="pool.resourcePoolType === 'dedicatedV2' ? 'dedicated' : ''">
                      [[ pool.resourcePoolType === 'dedicatedV2' ? 'ÂÖ®ÊâòÁÆ°' : 'Ëá™ËøêÁª¥' ]]
                    </span>
                  </div>
                  <div class="resource-pool-info">
                    <div class="info-item">
                      <span class="label">ËµÑÊ∫êÊ±†ID:</span>
                      <span class="value">[[ pool.resourcePoolId ]]</span>
                    </div>
                    <div class="info-item" v-if="pool.description">
                      <span class="label">ÊèèËø∞:</span>
                      <span class="value">[[ pool.description ]]</span>
                    </div>
                    <div class="info-item" v-if="pool.bindingStorages && pool.bindingStorages.length > 0">
                      <span class="label">ÁªëÂÆöÂ≠òÂÇ®:</span>
                      <span class="value">
                        <span v-for="storage in pool.bindingStorages" :key="storage.id" class="storage-tag">
                          [[ storage.id ]]
                        </span>
                      </span>
                    </div>
                  </div>
                </div>
              </div>
              <div v-else class="empty-state">
                <i class="fas fa-info-circle"></i>
                <span>ÊöÇÊó†ÂèØÁî®ËµÑÊ∫êÊ±†</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

<!-- ÂØºÂÖ•Êï∞ÊçÆÊäΩÂ±âÈÅÆÁΩ© -->
  <div id="drawer-overlay" class="drawer-overlay" onclick="closeDrawer()"></div>

<!-- ÂØºÂÖ•Êï∞ÊçÆÊäΩÂ±â -->
  <div id="drawer" class="drawer">
    <div class="drawer-header">
      <div style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
        <h4>ÂØºÂÖ•Êï∞ÊçÆ</h4>
          <p class="drawer-description">Â∞ÜÊï∞ÊçÆÂØºÂÖ•Âà∞ÂΩìÂâçÊï∞ÊçÆÈõÜ,ÂêéÁª≠ÂèØ‰ª•Âú®ÁôæËà∏Ë¥üËΩΩ‰∏≠ÊåÇËΩΩ‰ΩøÁî®</p>
        </div>
        <button class="drawer-close" onclick="closeDrawer()" style="margin-left: 20px; flex-shrink: 0;">&times;</button>
      </div>
    </div>
    
    <div class="drawer-content">
      <!-- ÁõÆÊ†áÊï∞ÊçÆÈõÜ‰ø°ÊÅØ -->
      <div class="target-dataset-summary">
        <div class="summary-item">
          <span class="summary-label">ÁõÆÊ†áÊï∞ÊçÆÈõÜ:</span>
          <span class="summary-value">[[ dataset ? dataset.name : 'Âä†ËΩΩ‰∏≠...' ]]</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">ÁâàÊú¨:</span>
          <span class="summary-value">[[ getTargetDatasetVersion() ]]</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Â≠òÂÇ®:</span>
          <span class="summary-value">[[ getTargetStorageInfo() ]]</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Â≠òÂÇ®Ë∑ØÂæÑ:</span>
          <span class="summary-value">[[ getTargetStoragePath() ]]</span>
        </div>
      </div>

      <!-- ÂØºÂÖ•ÊñπÂºèÈÄâÊã© -->
            <div class="form-group">
                <label class="form-label">ÂØºÂÖ•ÊñπÂºè</label>
                <div class="radio-group">
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="existing" name="importMethod">
            <span class="radio-label">Â∑≤ÊúâÊï∞ÊçÆÈõÜ</span>
          </label>
          <!-- <label class="radio-item">
                    <input type="radio" v-model="importMethod" value="public" name="importMethod">
                    <span class="radio-label">ÂÖ¨ÂÖ±Êï∞ÊçÆÈõÜ</span>
                </label> -->
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="object" name="importMethod">
            <span class="radio-label">ÂØπË±°Â≠òÂÇ®</span>
          </label>
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="huggingface" name="importMethod">
            <span class="radio-label">HuggingFace</span>
          </label>
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="custom" name="importMethod">
            <span class="radio-label">Ëá™ÂÆö‰πâ‰∏ãËΩΩ</span>
          </label>
          <!-- <label class="radio-item">
                    <input type="radio" v-model="importMethod" value="upload" name="importMethod">
                    <span class="radio-label">‰∏ä‰º†Êñá‰ª∂</span>
                </label> -->
          <label class="radio-item">
            <input type="radio" v-model="importMethod" value="tool" name="importMethod">
            <span class="radio-label">Â∑•ÂÖ∑‰∏ä‰º†</span>
          </label>
                    </div>
                    </div>

      <!-- Ê∫êÊï∞ÊçÆÈõÜÈÖçÁΩÆ -->
      <div v-if="importMethod === 'existing'" class="form-group">
        <label class="form-label required">
          Ê∫êÊï∞ÊçÆÈõÜ
          <span class="count-badge" :class="{ 'zero-count': filteredDatasets.length === 0 }">([[ filteredDatasets.length
            ]])</span>
        </label>
        <div class="dataset-filter-group">
          <select v-model="datasetTypeFilter" @change="onDatasetTypeFilterChange" class="form-control filter-select">
            <option value="all">ÂÖ®ÈÉ®</option>
            <option value="BOS">BOSÁ±ªÂûã</option>
            <option value="PFS">PFSÁ±ªÂûã</option>
          </select>
        </div>
        <div class="dataset-group">
          <select v-model="formData.sourceDataset" @change="onSourceDatasetChange" class="form-control">
            <option value="">ËØ∑ÈÄâÊã©Ê∫êÊï∞ÊçÆÈõÜ</option>
            <option v-for="dataset in filteredDatasets" :key="dataset.id" :value="dataset.id">
              [[ getDatasetDisplayText(dataset) ]]
            </option>
          </select>
          <button type="button" @click="refreshDatasets" class="btn-refresh" title="Âà∑Êñ∞Êï∞ÊçÆÈõÜÂàóË°®" :disabled="loading">
            <span>üîÑ</span>
          </button>
                </div>
            </div>
            
      <div v-if="importMethod === 'existing'" class="form-group">
        <label class="form-label required">
          Êï∞ÊçÆÁâàÊú¨
          <span class="count-badge" :class="{ 'zero-count': datasetVersions.length === 0 }">([[ datasetVersions.length
            ]])</span>
        </label>
        <div class="version-group">
          <select v-model="formData.datasetVersion" @change="onDatasetVersionChange" class="form-control">
            <option value="">ËØ∑ÈÄâÊã©Êï∞ÊçÆÁâàÊú¨</option>
            <option v-for="version in filteredVersions" :key="version.id" :value="version.id"
              v-text="getVersionDisplayText(version)">
            </option>
          </select>
          <button type="button" @click="refreshDatasetVersions" class="btn-refresh" title="Âà∑Êñ∞Êï∞ÊçÆÁâàÊú¨ÂàóË°®"
            :disabled="!formData.sourceDataset">
            <span>üîÑ</span>
          </button>
        </div>
                </div>
                
      <!-- Ê∏ÖÁ©∫Êï∞ÊçÆÈÄâÈ°π -->
                <div class="form-group">
        <div class="toggle-group">
          <label class="toggle-label">
            <input type="checkbox" v-model="formData.cleanData" @change="onCleanDataChange" class="toggle-input">
            <span class="toggle-slider"></span>
            Ê∏ÖÁ©∫Êï∞ÊçÆ
          </label>
          <p class="toggle-description">ÂºÄÂêØÊ∏ÖÁ©∫Êï∞ÊçÆ‰ºöÂú®ÂØºÂÖ•ÂºÄÂßãÊó∂ÂÖàÂà†Èô§ÂΩìÂâçÊï∞ÊçÆÈõÜÁõÆÂΩï‰∏ãÊâÄÊúâÊñá‰ª∂</p>
                </div>
            </div>
            
      <!-- ÂêåÂêç‰øùÁïôÁ≠ñÁï• -->
      <div class="form-group" :class="{ 'disabled-group': formData.cleanData }">
        <label class="form-label" :class="{ 'required': !formData.cleanData }">ÂêåÂêç‰øùÁïôÁ≠ñÁï•</label>
        <div class="radio-group" :class="{ 'disabled': formData.cleanData }">
          <label class="radio-item">
            <input type="radio" value="target" v-model="formData.nameStrategy" name="nameStrategy"
              :disabled="formData.cleanData">
            <span class="radio-label">‰øùÁïôÁõÆÁöÑÊñá‰ª∂</span>
          </label>
          <label class="radio-item">
            <input type="radio" value="source" v-model="formData.nameStrategy" name="nameStrategy"
              :disabled="formData.cleanData">
            <span class="radio-label">‰øùÁïôÊ∫êÊñá‰ª∂</span>
          </label>
        </div>
        <p v-if="formData.cleanData" class="disabled-hint">Ê∏ÖÁ©∫Êï∞ÊçÆÊó∂Êó†ÈúÄÈÄâÊã©ÂêåÂêç‰øùÁïôÁ≠ñÁï•</p>
            </div>
            
      <!-- ËµÑÊ∫êÊ±†Á±ªÂûã -->
            <div class="form-group">
        <label class="form-label required">ËµÑÊ∫êÊ±†Á±ªÂûã</label>
        <select v-model="formData.resourcePoolType" @change="onResourcePoolTypeChange" class="form-control">
          <option value="">ËØ∑ÈÄâÊã©ËµÑÊ∫êÊ±†Á±ªÂûã</option>
          <option value="common">Ëá™ËøêÁª¥ËµÑÊ∫êÊ±†</option>
          <option value="dedicatedV2">ÂÖ®ÊâòÁÆ°ËµÑÊ∫êÊ±†</option>
        </select>
                    </div>

      <!-- ËµÑÊ∫êÊ±† -->
      <div class="form-group">
        <label class="form-label required">
          ËµÑÊ∫êÊ±†
          <span class="count-badge" :class="{ 'zero-count': filteredResourcePools.length === 0 }">([[ filteredResourcePools.length
            ]])</span>
        </label>
        <div class="resource-pool-group">
          <select v-model="formData.resourcePool" @change="onResourcePoolChange" class="form-control"
            :disabled="!formData.resourcePoolType">
            <option value="">ËØ∑ÈÄâÊã©ËµÑÊ∫êÊ±†</option>
            <option v-for="pool in filteredResourcePools" :key="pool.resourcePoolId || pool.metadata?.id"
              :value="pool.resourcePoolId || pool.metadata?.id" v-text="pool.name || pool.metadata?.name">
            </option>
          </select>
          <button type="button" @click="refreshResourcePools" class="btn-refresh" title="Âà∑Êñ∞ËµÑÊ∫êÊ±†ÂàóË°®"
            :disabled="!formData.resourcePoolType">
            <span>üîÑ</span>
          </button>
                    </div>
        <!-- ËµÑÊ∫êÊ±†ËøáÊª§ÊèêÁ§∫ -->
        <div v-if="getResourcePoolFilterHint" class="filter-hint">
          <div class="filter-hint-content">
            <span class="filter-hint-icon">‚ÑπÔ∏è</span>
            <div class="filter-hint-text">
              <div class="filter-hint-title">ËµÑÊ∫êÊ±†ËøáÊª§ÊèêÁ§∫</div>
              <div class="filter-hint-message" v-text="getResourcePoolFilterHint"></div>
              <div class="filter-hint-actions">
                <button type="button" @click="showResourcePoolDetails" class="btn-details">
                  Êü•ÁúãÂêÑÊï∞ÊçÆÈõÜÂèØÈÄâÊã©ÁöÑËµÑÊ∫êÊ±†
                </button>
                </div>
            </div>
          </div>
        </div>
            </div>
            
      <!-- ÈòüÂàó -->
            <div class="form-group">
        <label class="form-label required">
          ÈòüÂàó
          <span class="count-badge" :class="{ 'zero-count': filteredQueues.length === 0 }">([[ filteredQueues.length ]])</span>
        </label>
        <div class="queue-group">
          <select v-model="formData.queue" class="form-control" :disabled="!formData.resourcePool">
            <option value="">ËØ∑ÈÄâÊã©ÈòüÂàó</option>
            <option v-for="queue in filteredQueues" :key="queue.queueId || queue.name"
              :value="queue.queueName || queue.name" v-text="getQueueDisplayText(queue)">
            </option>
          </select>
          <button type="button" @click="refreshQueues" class="btn-refresh" title="Âà∑Êñ∞ÈòüÂàóÂàóË°®"
            :disabled="!formData.resourcePool">
            <span>üîÑ</span>
          </button>
        </div>
            </div>
        </div>
        
        <div class="form-actions">
      <div class="transfer-summary">
        <span v-if="checkSourceTargetSame()" class="warning-message">
          ‚ö†Ô∏è Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ‰∏çËÉΩÂÆåÂÖ®Áõ∏Âêå
        </span>
        <span v-else-if="getSourcePath()">
          ‰ªé <span class="source-path">[[ getSourcePath() ]]</span> ËΩ¨ÂÇ®Âà∞ <span class="target-path">[[ getTargetPath()
            ]]</span>
        </span>
        <span v-else class="empty-hint">
          ËØ∑ÈÄâÊã©Ê∫êÊï∞ÊçÆÈõÜÂíåÁâàÊú¨
        </span>
        </div>
      <div class="action-buttons">
        <button type="button" class="btn btn-secondary" onclick="closeDrawer()">ÂèñÊ∂à</button>
        <button type="button" class="btn btn-primary" 
                @click="submitImportForm" 
                :disabled="!canSubmitImport"
                :title="getImportButtonDisabledReason || 'Á°ÆÂÆöÂØºÂÖ•Êï∞ÊçÆ'">
          Á°ÆÂÆö
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ÁÆÄÂçïÁöÑÊäΩÂ±âÊéßÂà∂ÂáΩÊï∞

  function closeDrawer() {
    document.getElementById('drawer').style.display = 'none';
    document.getElementById('drawer-overlay').style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  // ‰ªéJinja2Ê®°ÊùøËé∑ÂèñÊï∞ÊçÆÈõÜID
  const DATASET_ID = '{{ dataset_id }}';

const { createApp } = Vue;

createApp({
  delimiters: ['[[', ']]'],
  data() {
    return {
      dataset: null,
      loading: false,
      error: null,
        datasetId: DATASET_ID,
      activeTab: 'basic', // ÈªòËÆ§ÊòæÁ§∫Âü∫Êú¨‰ø°ÊÅØtab
      
      // ÁâàÊú¨ÂàóË°®Áõ∏ÂÖ≥Êï∞ÊçÆ
      versions: [],
      versionsLoading: false,
      versionsError: null,
      currentPage: 1,
      pageSize: 100,
      totalVersions: 0,
      
      // ÂØºÂÖ•ËÆ∞ÂΩïÁõ∏ÂÖ≥Êï∞ÊçÆ
      imports: [],
      importsLoading: false,
      importsError: null,
      
        // ÂØºÂÖ•Êï∞ÊçÆÁõ∏ÂÖ≥Êï∞ÊçÆ
        importMethod: 'existing', // ÈªòËÆ§ÈÄâ‰∏≠Â∑≤ÊúâÊï∞ÊçÆÈõÜ
        availableDatasets: [], // ÂèØÈÄâÊï∞ÊçÆÈõÜÂàóË°®
        datasetVersions: [], // Êï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®
        targetDatasetVersion: null, // ÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÔºàÁÇπÂáªÂØºÂÖ•Êï∞ÊçÆÊåâÈíÆÊó∂‰º†ÂÖ•Ôºâ
        resourcePools: [], // ËµÑÊ∫êÊ±†ÂàóË°®
        queues: [], // ÈòüÂàóÂàóË°®
        datasetTypeFilter: 'all', // Êï∞ÊçÆÈõÜÁ±ªÂûãÁ≠õÈÄâÔºöall, BOS, PFS
        resourcePoolCacheLoaded: false, // ËµÑÊ∫êÊ±†ÁºìÂ≠òÊòØÂê¶Â∑≤Âä†ËΩΩÂÆåÊàê
        resourcePoolLoadingStatus: 'ÂáÜÂ§á‰∏≠...', // ËµÑÊ∫êÊ±†Âä†ËΩΩÁä∂ÊÄÅÊèèËø∞
        // ÁºìÂ≠òÁõ∏ÂÖ≥
        resourcePoolCache: {}, // ËµÑÊ∫êÊ±†ÁºìÂ≠òÔºåÊåâÁ±ªÂûãÂàÜÂà´ÁºìÂ≠ò
        resourcePoolCacheTime: {}, // ÁºìÂ≠òÊó∂Èó¥ÔºåÊåâÁ±ªÂûãÂàÜÂà´ËÆ∞ÂΩï
        cacheExpiry: 5 * 60 * 1000, // ÁºìÂ≠òËøáÊúüÊó∂Èó¥Ôºö5ÂàÜÈíü
        
        // ÂèØÁî®ËµÑÊ∫êÊ±†Áõ∏ÂÖ≥Êï∞ÊçÆ
        resourcePoolError: null, // ËµÑÊ∫êÊ±†ÈîôËØØ‰ø°ÊÅØ
      formData: {
          sourceDataset: '',
          datasetVersion: '',
        cleanData: false,
          nameStrategy: 'target', // ÈªòËÆ§ÈÄâ‰∏≠‰øùÁïôÁõÆÁöÑÊñá‰ª∂
          resourcePoolType: 'common', // ËµÑÊ∫êÊ±†Á±ªÂûãÔºåÈªòËÆ§ÈÄâ‰∏≠Ëá™ËøêÁª¥ËµÑÊ∫êÊ±†
          resourcePool: '',
          queue: ''
        }

    }
  },
  computed: {
    totalPages() {
      return Math.ceil(this.totalVersions / this.pageSize);
      },
      filteredDatasets() {
        if (!this.availableDatasets || this.availableDatasets.length === 0) {
          return [];
        }

        // Ê†πÊçÆÁ±ªÂûãÁ≠õÈÄâÊï∞ÊçÆÈõÜ
        if (this.datasetTypeFilter === 'all') {
          return this.availableDatasets;
        }

        return this.availableDatasets.filter(dataset => {
          const storageType = dataset.storageType || dataset.storage_type;
          return storageType === this.datasetTypeFilter;
        });
      },
      filteredVersions() {
        return this.datasetVersions && this.datasetVersions.length > 0 ? this.datasetVersions : [];
      },
      filteredResourcePools() {
        if (!this.resourcePools || this.resourcePools.length === 0) {
          return [];
        }
        
        // Ëé∑ÂèñÈúÄË¶ÅËøáÊª§ÁöÑÂ≠òÂÇ®ÂÆû‰æãIDÂàóË°®
        const requiredStorageIds = this.getRequiredStorageIds();
        
        // Â¶ÇÊûúÊ≤°ÊúâÈúÄË¶ÅËøáÊª§ÁöÑÂ≠òÂÇ®ÂÆû‰æãÔºåËøîÂõûÊâÄÊúâËµÑÊ∫êÊ±†
        if (requiredStorageIds.length === 0) {
          return this.resourcePools;
        }
        
        // ËøáÊª§ËµÑÊ∫êÊ±†ÔºöÂè™ËøîÂõûÁªëÂÆö‰∫ÜÊâÄÊúâÂøÖÈúÄÂ≠òÂÇ®ÂÆû‰æãÁöÑËµÑÊ∫êÊ±†
        return this.resourcePools.filter(pool => {
          if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
            return false;
          }
          
          // Ê£ÄÊü•ËµÑÊ∫êÊ±†ÊòØÂê¶ÁªëÂÆö‰∫ÜÊâÄÊúâÂøÖÈúÄÁöÑÂ≠òÂÇ®ÂÆû‰æã
          const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
          return requiredStorageIds.every(requiredId => boundStorageIds.includes(requiredId));
        });
      },
      filteredQueues() {
        return this.queues && this.queues.length > 0 ? this.queues : [];
      },
      // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèØÁî®ÁöÑËµÑÊ∫êÊ±†
      hasAvailableResourcePools() {
        return this.filteredResourcePools.length > 0;
      },
      // Ëé∑ÂèñËµÑÊ∫êÊ±†ËøáÊª§ÊèêÁ§∫‰ø°ÊÅØ
      getResourcePoolFilterHint() {
        const requiredStorageIds = this.getRequiredStorageIds();
        
        if (requiredStorageIds.length === 0) {
          return null; // ‰∏çÈúÄË¶ÅËøáÊª§Ôºå‰∏çÊòæÁ§∫ÊèêÁ§∫
        }
        
        if (this.hasAvailableResourcePools) {
          return null; // ÊúâÂèØÁî®ËµÑÊ∫êÊ±†Ôºå‰∏çÊòæÁ§∫ÊèêÁ§∫
        }
        
        // Ê£ÄÊü•ÊòØÂê¶ÊúâPFSÁ±ªÂûãÁöÑÊï∞ÊçÆÈõÜ
        const hasPfsDataset = this.hasPfsDataset();
        if (!hasPfsDataset) {
          return null; // Ê≤°ÊúâPFSÁ±ªÂûãÊï∞ÊçÆÈõÜÔºå‰∏çÊòæÁ§∫ËøáÊª§ÊèêÁ§∫
        }
        
        // Ê≤°ÊúâÂèØÁî®ÁöÑËµÑÊ∫êÊ±†ÔºåÁîüÊàêÊèêÁ§∫‰ø°ÊÅØ
        const targetStorageId = this.dataset?.storageInstance || this.dataset?.storageInstanceId;
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        const sourceStorageId = sourceDataset?.storageInstance || sourceDataset?.storageInstanceId;
        
        let hint = 'ÂΩìÂâçÊ≤°ÊúâÂêåÊó∂ÁªëÂÆö‰ª•‰∏ãPFSÂ≠òÂÇ®ÂÆû‰æãÁöÑËµÑÊ∫êÊ±†Ôºö\n';
        if (targetStorageId) {
          hint += `‚Ä¢ ÁõÆÊ†áÊï∞ÊçÆÈõÜPFSÂ≠òÂÇ®ÂÆû‰æã: ${targetStorageId}\n`;
        }
        if (sourceStorageId) {
          hint += `‚Ä¢ Ê∫êÊï∞ÊçÆÈõÜPFSÂ≠òÂÇ®ÂÆû‰æã: ${sourceStorageId}\n`;
        }
        hint += '\nËØ¥ÊòéÔºö\n';
        hint += '‚Ä¢ BOSÁ±ªÂûãÊï∞ÊçÆÈõÜÂèØ‰ª•‰ΩøÁî®ÊâÄÊúâËµÑÊ∫êÊ±†\n';
        hint += '‚Ä¢ Âè™ÊúâPFSÁ±ªÂûãÊï∞ÊçÆÈõÜÈúÄË¶ÅÁâπÂÆöÁöÑËµÑÊ∫êÊ±†ÁªëÂÆö\n';
        hint += '\nËß£ÂÜ≥ÊñπÊ°àÔºö\n';
        hint += '1. Ê£ÄÊü•ËµÑÊ∫êÊ±†ÁöÑPFSÂ≠òÂÇ®ÂÆû‰æãÁªëÂÆöÈÖçÁΩÆ\n';
        hint += '2. ÈÄâÊã©BOSÁ±ªÂûãÁöÑÊï∞ÊçÆÈõÜÔºàÊó†ÈúÄËµÑÊ∫êÊ±†ÁªëÂÆöÔºâ\n';
        hint += '3. ËÅîÁ≥ªÁÆ°ÁêÜÂëòÈÖçÁΩÆËµÑÊ∫êÊ±†PFSÁªëÂÆö';
        
        return hint;
      },
      // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•Êèê‰∫§ÂØºÂÖ•Ë°®Âçï
      canSubmitImport() {
        // Âü∫Êú¨Ë°®ÂçïÈ™åËØÅ
        if (!this.formData.resourcePool || !this.formData.queue || !this.formData.sourceDataset || !this.formData.datasetVersion) {
          return false;
        }
        
        // Ê£ÄÊü•Ê∫êÊï∞ÊçÆÈõÜÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÊòØÂê¶Áõ∏Âêå
        if (this.checkSourceTargetSame()) {
          return false;
        }
        
        return true;
      },
      // Ëé∑ÂèñÂØºÂÖ•ÊåâÈíÆÁöÑÁ¶ÅÁî®ÂéüÂõ†
      getImportButtonDisabledReason() {
        if (!this.formData.resourcePool || !this.formData.queue) {
          return 'ËØ∑ÈÄâÊã©ËµÑÊ∫êÊ±†ÂíåÈòüÂàó';
        }
        if (!this.formData.sourceDataset) {
          return 'ËØ∑ÈÄâÊã©Ê∫êÊï∞ÊçÆÈõÜ';
        }
        if (!this.formData.datasetVersion) {
          return 'ËØ∑ÈÄâÊã©Êï∞ÊçÆÁâàÊú¨';
        }
        if (this.checkSourceTargetSame()) {
          return 'Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ‰∏çËÉΩÂÆåÂÖ®Áõ∏Âêå';
        }
        return '';
      },
      
      // Ê£ÄÊü•ÊòØÂê¶‰∏∫PFSÊï∞ÊçÆÈõÜ
      isPfsDataset() {
        return this.dataset && this.dataset.storageType && this.dataset.storageType.toLowerCase() === 'pfs';
      },
      
      // Ëá™ËøêÁª¥ËµÑÊ∫êÊ±†ÔºàcommonÁ±ªÂûãÔºâ
      commonResourcePools() {
        if (!this.resourcePools || this.resourcePools.length === 0) {
          return [];
        }
        
        const targetStorageId = this.dataset?.storageInstance || this.dataset?.storageInstanceId;
        if (!targetStorageId) {
          return [];
        }
        
        return this.resourcePools.filter(pool => {
          // Âè™ÊòæÁ§∫commonÁ±ªÂûãÁöÑËµÑÊ∫êÊ±†
          if (pool.resourcePoolType !== 'common') {
            return false;
          }
          
          // Ê£ÄÊü•ÊòØÂê¶ÁªëÂÆö‰∫ÜÂΩìÂâçÊï∞ÊçÆÈõÜÁöÑÂ≠òÂÇ®ÂÆû‰æã
          if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
            return false;
          }
          
          const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
          return boundStorageIds.includes(targetStorageId);
        });
      },
      
      // ÂÖ®ÊâòÁÆ°ËµÑÊ∫êÊ±†ÔºàdedicatedV2Á±ªÂûãÔºâ
      dedicatedV2ResourcePools() {
        if (!this.resourcePools || this.resourcePools.length === 0) {
          return [];
        }
        
        const targetStorageId = this.dataset?.storageInstance || this.dataset?.storageInstanceId;
        if (!targetStorageId) {
          return [];
        }
        
        return this.resourcePools.filter(pool => {
          // Âè™ÊòæÁ§∫dedicatedV2Á±ªÂûãÁöÑËµÑÊ∫êÊ±†
          if (pool.resourcePoolType !== 'dedicatedV2') {
            return false;
          }
          
          // Ê£ÄÊü•ÊòØÂê¶ÁªëÂÆö‰∫ÜÂΩìÂâçÊï∞ÊçÆÈõÜÁöÑÂ≠òÂÇ®ÂÆû‰æã
          if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
            return false;
          }
          
          const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
          return boundStorageIds.includes(targetStorageId);
        });
      },
      
      // ÊâÄÊúâÂèØÁî®ËµÑÊ∫êÊ±†ÔºàÂêàÂπ∂Ëá™ËøêÁª¥ÂíåÂÖ®ÊâòÁÆ°ÔºåËá™ËøêÁª¥ÊéíÂú®ÂâçÈù¢Ôºâ
      availableResourcePools() {
        const allPools = [...this.commonResourcePools, ...this.dedicatedV2ResourcePools];
        // ÊåâÁ±ªÂûãÊéíÂ∫èÔºöËá™ËøêÁª¥(common)Âú®ÂâçÔºåÂÖ®ÊâòÁÆ°(dedicatedV2)Âú®Âêé
        return allPools.sort((a, b) => {
          if (a.resourcePoolType === 'common' && b.resourcePoolType === 'dedicatedV2') {
            return -1;
          }
          if (a.resourcePoolType === 'dedicatedV2' && b.resourcePoolType === 'common') {
            return 1;
          }
          return 0;
        });
    }
  },
  methods: {
      // Ê£ÄÊü•ÊòØÂê¶ÊúâPFSÁ±ªÂûãÁöÑÊï∞ÊçÆÈõÜ
      hasPfsDataset() {
        // Ê£ÄÊü•ÁõÆÊ†áÊï∞ÊçÆÈõÜÊòØÂê¶‰∏∫PFSÁ±ªÂûã
        const targetIsPfs = this.dataset && this.dataset.storageType && this.dataset.storageType.toLowerCase() === 'pfs';
        
        // Ê£ÄÊü•Ê∫êÊï∞ÊçÆÈõÜÊòØÂê¶‰∏∫PFSÁ±ªÂûã
        let sourceIsPfs = false;
        if (this.formData.sourceDataset && this.importMethod === 'existing') {
          const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
          sourceIsPfs = sourceDataset && sourceDataset.storageType && sourceDataset.storageType.toLowerCase() === 'pfs';
        }
        
        return targetIsPfs || sourceIsPfs;
      },
      
      // Ëé∑ÂèñÊØè‰∏™Êï∞ÊçÆÈõÜÂèØÈÄâÊã©ÁöÑËµÑÊ∫êÊ±†‰ø°ÊÅØ
      getDatasetResourcePoolInfo() {
        if (!this.dataset || !this.formData.sourceDataset) {
          return null;
        }
        
        const targetStorageType = this.dataset.storageType?.toLowerCase();
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        const sourceStorageType = sourceDataset?.storageType?.toLowerCase();
        
        let info = 'ÂêÑÊï∞ÊçÆÈõÜÂèØÈÄâÊã©ÁöÑËµÑÊ∫êÊ±†Ôºö\n\n';
        
        // ÁõÆÊ†áÊï∞ÊçÆÈõÜ‰ø°ÊÅØ
        if (targetStorageType === 'pfs') {
          const targetStorageId = this.dataset.storageInstance || this.dataset.storageInstanceId;
          const targetPools = this.resourcePools.filter(pool => {
            if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
              return false;
            }
            const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
            return targetStorageId && boundStorageIds.includes(targetStorageId);
          });
          
          info += `ÁõÆÊ†áÊï∞ÊçÆÈõÜ (PFS - ${targetStorageId})Ôºö\n`;
          if (targetPools.length > 0) {
            targetPools.forEach(pool => {
              info += `‚Ä¢ ${pool.name || pool.metadata?.name || pool.resourcePoolId}\n`;
            });
          } else {
            info += '‚Ä¢ Êó†ÂèØÁî®ËµÑÊ∫êÊ±†\n';
          }
          info += '\n';
        } else if (targetStorageType === 'bos') {
          info += `ÁõÆÊ†áÊï∞ÊçÆÈõÜ (BOS)Ôºö\n`;
          info += `‚Ä¢ ÂèØ‰ª•‰ΩøÁî®ÊâÄÊúâËµÑÊ∫êÊ±† (${this.resourcePools.length}‰∏™)\n`;
          info += '\n';
        }
        
        // Ê∫êÊï∞ÊçÆÈõÜ‰ø°ÊÅØ
        if (sourceStorageType === 'pfs') {
          const sourceStorageId = sourceDataset.storageInstance || sourceDataset.storageInstanceId;
          const sourcePools = this.resourcePools.filter(pool => {
            if (!pool.bindingStorages || !Array.isArray(pool.bindingStorages)) {
              return false;
            }
            const boundStorageIds = pool.bindingStorages.map(storage => storage.id);
            return sourceStorageId && boundStorageIds.includes(sourceStorageId);
          });
          
          info += `Ê∫êÊï∞ÊçÆÈõÜ (PFS - ${sourceStorageId})Ôºö\n`;
          if (sourcePools.length > 0) {
            sourcePools.forEach(pool => {
              info += `‚Ä¢ ${pool.name || pool.metadata?.name || pool.resourcePoolId}\n`;
            });
          } else {
            info += '‚Ä¢ Êó†ÂèØÁî®ËµÑÊ∫êÊ±†\n';
          }
        } else if (sourceStorageType === 'bos') {
          info += `Ê∫êÊï∞ÊçÆÈõÜ (BOS)Ôºö\n`;
          info += `‚Ä¢ ÂèØ‰ª•‰ΩøÁî®ÊâÄÊúâËµÑÊ∫êÊ±† (${this.resourcePools.length}‰∏™)\n`;
        }
        
        // Ê∑ªÂä†ËØ¥Êòé
        info += '\nËØ¥ÊòéÔºö\n';
        info += '‚Ä¢ BOSÁ±ªÂûãÊï∞ÊçÆÈõÜÂèØ‰ª•‰ΩøÁî®ÊâÄÊúâËµÑÊ∫êÊ±†\n';
        info += '‚Ä¢ PFSÁ±ªÂûãÊï∞ÊçÆÈõÜÈúÄË¶ÅÁâπÂÆöÁöÑËµÑÊ∫êÊ±†ÁªëÂÆö\n';
        
        return info;
      },
      
      // ÊòæÁ§∫ËµÑÊ∫êÊ±†ËØ¶ÁªÜ‰ø°ÊÅØ
      showResourcePoolDetails() {
        const details = this.getDatasetResourcePoolInfo();
        if (details) {
          // ÂàõÂª∫Ê®°ÊÄÅÊ°ÜÊòæÁ§∫ËØ¶ÁªÜ‰ø°ÊÅØ
          const modal = document.createElement('div');
          modal.className = 'resource-pool-modal';
          modal.innerHTML = `
            <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
            <div class="modal-content">
              <div class="modal-header">
                <h3>ËµÑÊ∫êÊ±†ÁªëÂÆöËØ¶ÊÉÖ</h3>
                <button class="modal-close" onclick="this.closest('.resource-pool-modal').remove()">√ó</button>
              </div>
              <div class="modal-body">
                <pre class="resource-pool-details">${details}</pre>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" onclick="this.closest('.resource-pool-modal').remove()">ÂÖ≥Èó≠</button>
              </div>
            </div>
          `;
          document.body.appendChild(modal);
        }
      },
      
      // Ëé∑ÂèñÈúÄË¶ÅËøáÊª§ÁöÑÂ≠òÂÇ®ÂÆû‰æãIDÂàóË°®
      getRequiredStorageIds() {
        const storageIds = [];
        
        // Ëé∑ÂèñÁõÆÊ†áÊï∞ÊçÆÈõÜÁöÑÂ≠òÂÇ®ÂÆû‰æãID
        if (this.dataset && this.dataset.storageType && this.dataset.storageType.toLowerCase() === 'pfs') {
          const targetStorageId = this.dataset.storageInstance || this.dataset.storageInstanceId;
          if (targetStorageId) {
            storageIds.push(targetStorageId);
          }
        }
        
        // Ëé∑ÂèñÊ∫êÊï∞ÊçÆÈõÜÁöÑÂ≠òÂÇ®ÂÆû‰æãID
        if (this.formData.sourceDataset && this.importMethod === 'existing') {
          const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
          if (sourceDataset && sourceDataset.storageType && sourceDataset.storageType.toLowerCase() === 'pfs') {
            const sourceStorageId = sourceDataset.storageInstance || sourceDataset.storageInstanceId;
            if (sourceStorageId) {
              storageIds.push(sourceStorageId);
            }
          }
        }
        
        // ÂéªÈáçÂπ∂ËøîÂõû
        return [...new Set(storageIds)];
      },
      
      // Ëé∑ÂèñÊï∞ÊçÆÈõÜÊòæÁ§∫ÊñáÊú¨
      getDatasetDisplayText(dataset) {
        if (!dataset) return '';

        let displayText = `${dataset.name}`;

        // Ê∑ªÂä†Â≠òÂÇ®Á±ªÂûã‰ø°ÊÅØ
        const storageTypeText = dataset.storageType;
        displayText += ` [ ${dataset.id} / ${storageTypeText}:`;

        // Ê∑ªÂä†Â≠òÂÇ®ÂÆû‰æãID‰ø°ÊÅØ
        const storageInstanceId = dataset.storageInstanceId || dataset.storage_instance_id || dataset.storageInstance;
        if (storageInstanceId) {
          displayText += `${storageInstanceId}]`;
        }

        return displayText;
      },

      // Ëé∑ÂèñÁâàÊú¨ÊòæÁ§∫ÊñáÊú¨
      getVersionDisplayText(version) {
        if (!version) return '';

        let displayText = '';

        // Ê∑ªÂä†ÁâàÊú¨Âè∑
        if (version.version) {
          displayText += `v${version.version} [${version.id} | `;
        }

        // Ê∑ªÂä†Â≠òÂÇ®Ë∑ØÂæÑ‰ø°ÊÅØ
        // Â¶ÇÊûúË∑ØÂæÑÂ§™ÈïøÔºåÂè™ÊòæÁ§∫ÊúÄÂêé‰∏ÄÈÉ®ÂàÜ
        const path = version.storagePath;
        const shortPath = path.length > 25 ? '...' + path.slice(-22) : path;
        displayText += `${shortPath} -> `;

        const mountPath = version.mountPath;
        const shortMountPath = mountPath.length > 25 ? '...' + mountPath.slice(-22) : mountPath;
        displayText += ` ${shortMountPath}]`;

        // Ê∑ªÂä†ÊèèËø∞‰ø°ÊÅØ
        if (version.description) {
          displayText += ` - ${version.description}`;
        }

        return displayText;
      },

      // Ëé∑ÂèñÈòüÂàóÊòæÁ§∫ÊñáÊú¨
      getQueueDisplayText(queue) {
        if (!queue) return '';
        let displayText = queue.queueName || queue.name || 'Êú™ÂëΩÂêçÈòüÂàó';

        // Ê∑ªÂä†ÈòüÂàóÁ±ªÂûã‰ø°ÊÅØ
        if (queue.queueType) {
          displayText += ` (${queue.queueType})`;
        }

        // Ê∑ªÂä†ËµÑÊ∫ê‰ø°ÊÅØ
        if (queue.capability) {
          const memoryGi = queue.capability.memoryGi;
          const cpuCores = queue.capability.milliCPUcores;
          if (memoryGi && cpuCores) {
            const memoryGB = Math.round(parseInt(memoryGi) / (1024 * 1024 * 1024));
            const cpuCoresNum = Math.round(parseInt(cpuCores) / 1000);
            displayText += ` - ${cpuCoresNum}Ê†∏/${memoryGB}GB`;
          }
        }

        // Ê∑ªÂä†Âä†ÈÄüÂç°‰ø°ÊÅØ
        if (queue.capability?.acceleratorCardList?.length > 0) {
          const accelerator = queue.capability.acceleratorCardList[0];
          if (accelerator.acceleratorType && accelerator.acceleratorCount) {
            displayText += ` - ${accelerator.acceleratorCount}x${accelerator.acceleratorType}`;
          }
        }

        return displayText;
      },

      async showImportDrawer(version) {
        // ‰øùÂ≠òÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨‰ø°ÊÅØ
        this.targetDatasetVersion = version;

        // Á°Æ‰øùÈªòËÆ§ÈÄâ‰∏≠Â∑≤ÊúâÊï∞ÊçÆÈõÜ
        this.importMethod = 'existing';

        // Á°Æ‰øùÈªòËÆ§ÈÄâ‰∏≠‰øùÁïôÁõÆÁöÑÊñá‰ª∂
        this.formData.nameStrategy = 'target';

        console.log('ËÆæÁΩÆÈªòËÆ§ÂÄº - importMethod:', this.importMethod, 'nameStrategy:', this.formData.nameStrategy);

        // Âä†ËΩΩÂèØÈÄâÊï∞ÊçÆÈõÜÂàóË°®
        await this.loadAvailableDatasets();

        // Âä†ËΩΩËµÑÊ∫êÊ±†ÂíåÈòüÂàóÂàóË°®Ôºà‰ºòÂÖà‰ΩøÁî®È¢ÑÂä†ËΩΩÁöÑÁºìÂ≠òÔºâ
        await this.loadResourcePools();

        console.log('Êï∞ÊçÆÈõÜÂàóË°®Âä†ËΩΩÂÆåÊàêÔºåÊï∞Èáè:', this.availableDatasets.length);
        console.log('Êï∞ÊçÆÈõÜÂàóË°®ÂÜÖÂÆπ:', this.availableDatasets);

        // Âº∫Âà∂Vue.jsÊõ¥Êñ∞
        this.$forceUpdate();

        // ‰ΩøÁî®$nextTickÁ°Æ‰øùVue.jsÂìçÂ∫îÂºèÊõ¥Êñ∞ÂÆåÊàêÂêéÂÜçÊòæÁ§∫ÊäΩÂ±â
        this.$nextTick(() => {
          // Êï∞ÊçÆÈõÜ‰ø°ÊÅØÁé∞Âú®ÈÄöËøáVue.jsÊï∞ÊçÆÁªëÂÆöËá™Âä®Êõ¥Êñ∞ÔºåÊó†ÈúÄÊâãÂä®ËÆæÁΩÆDOM

          // ÊòæÁ§∫ÊäΩÂ±â
          document.getElementById('drawer').style.display = 'flex';
          document.getElementById('drawer-overlay').style.display = 'block';
          document.body.style.overflow = 'hidden';

          // ÂÜçÊ¨°Á°ÆËÆ§ÈªòËÆ§ÂÄºËÆæÁΩÆ
          console.log('ÊäΩÂ±âÊòæÁ§∫Âêé - importMethod:', this.importMethod, 'nameStrategy:', this.formData.nameStrategy);
          console.log('ÊäΩÂ±âÊòæÁ§∫Âêé - availableDatasets:', this.availableDatasets);
          console.log('ÊäΩÂ±âÊòæÁ§∫Âêé - filteredDatasets:', this.filteredDatasets);
          console.log('ÊäΩÂ±âÊòæÁ§∫Âêé - filteredDatasets.length:', this.filteredDatasets.length);
          if (this.filteredDatasets.length > 0) {
            console.log('Á¨¨‰∏Ä‰∏™Êï∞ÊçÆÈõÜÂØπË±°:', this.filteredDatasets[0]);
            console.log('Á¨¨‰∏Ä‰∏™Êï∞ÊçÆÈõÜÂêçÁß∞:', this.filteredDatasets[0].name);
          }

          // Ê£ÄÊü•DOM‰∏≠ÁöÑÂçïÈÄâÊåâÈíÆÁä∂ÊÄÅ
          const existingRadio = document.querySelector('input[value="existing"]');
          const targetRadio = document.querySelector('input[value="target"]');
          console.log('DOMÊ£ÄÊü• - existing radio checked:', existingRadio ? existingRadio.checked : 'not found');
          console.log('DOMÊ£ÄÊü• - target radio checked:', targetRadio ? targetRadio.checked : 'not found');

          // Âº∫Âà∂ËÆæÁΩÆÂçïÈÄâÊåâÈíÆÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
          if (existingRadio) {
            existingRadio.checked = true;
            console.log('Âº∫Âà∂ËÆæÁΩÆÂ∑≤ÊúâÊï∞ÊçÆÈõÜ‰∏∫ÈÄâ‰∏≠Áä∂ÊÄÅ');
          }
          if (targetRadio) {
            targetRadio.checked = true;
            console.log('Âº∫Âà∂ËÆæÁΩÆ‰øùÁïôÁõÆÁöÑÊñá‰ª∂‰∏∫ÈÄâ‰∏≠Áä∂ÊÄÅ');
          }

          // Ê£ÄÊü•Ê∫êÊï∞ÊçÆÈõÜ‰∏ãÊãâÊ°Ü
          const sourceDatasetSelect = document.querySelector('select[v-model="formData.sourceDataset"]');
          console.log('Ê∫êÊï∞ÊçÆÈõÜ‰∏ãÊãâÊ°Ü:', sourceDatasetSelect);
          if (sourceDatasetSelect) {
            console.log('‰∏ãÊãâÊ°ÜÈÄâÈ°πÊï∞Èáè:', sourceDatasetSelect.options.length);
            for (let i = 0; i < sourceDatasetSelect.options.length; i++) {
              console.log(`ÈÄâÈ°π ${i}:`, sourceDatasetSelect.options[i].text, sourceDatasetSelect.options[i].value);
            }
          }

          // Âº∫Âà∂ÈáçÊñ∞Ê∏≤Êüì‰∏ãÊãâÊ°Ü
          this.$forceUpdate();
          console.log('Âº∫Âà∂ÈáçÊñ∞Ê∏≤ÊüìVue.jsÁªÑ‰ª∂');

          // Âª∂ËøüÂÜçÊ¨°Ê£ÄÊü•‰∏ãÊãâÊ°ÜÁä∂ÊÄÅ
          setTimeout(() => {
            const sourceDatasetSelect = document.querySelector('select[v-model="formData.sourceDataset"]');
            if (sourceDatasetSelect) {
              console.log('Âª∂ËøüÊ£ÄÊü• - ‰∏ãÊãâÊ°ÜÈÄâÈ°πÊï∞Èáè:', sourceDatasetSelect.options.length);
              for (let i = 0; i < sourceDatasetSelect.options.length; i++) {
                console.log(`Âª∂ËøüÊ£ÄÊü• - ÈÄâÈ°π ${i}:`, sourceDatasetSelect.options[i].text, sourceDatasetSelect.options[i].value);
              }
            }
          }, 100);
        });
      },
      onDatasetTypeFilterChange() {
        // ÂΩìÁ≠õÈÄâÁ±ªÂûãÊîπÂèòÊó∂ÔºåÊ∏ÖÁ©∫Â∑≤ÈÄâÊã©ÁöÑÊï∞ÊçÆÈõÜÂíåÁâàÊú¨
        this.formData.sourceDataset = '';
        this.formData.datasetVersion = '';
        this.datasetVersions = [];
        console.log('Êï∞ÊçÆÈõÜÁ±ªÂûãÁ≠õÈÄâÂ∑≤Êõ¥Êîπ‰∏∫:', this.datasetTypeFilter);
      },
      onCleanDataChange() {
        // ÂΩìÊ∏ÖÁ©∫Êï∞ÊçÆÁä∂ÊÄÅÊîπÂèòÊó∂ÔºåÊ∏ÖÁ©∫ÂêåÂêç‰øùÁïôÁ≠ñÁï•ÈÄâÊã©
        if (this.formData.cleanData) {
          this.formData.nameStrategy = '';
          console.log('Ê∏ÖÁ©∫Êï∞ÊçÆÂ∑≤ÂºÄÂêØÔºåÊ∏ÖÁ©∫ÂêåÂêç‰øùÁïôÁ≠ñÁï•ÈÄâÊã©');
        }
      },
      onSourceDatasetChange() {
        // ÂΩìÈÄâÊã©Ê∫êÊï∞ÊçÆÈõÜÊó∂ÔºåÂä†ËΩΩÂØπÂ∫îÁöÑÁâàÊú¨ÂàóË°®
        if (this.formData.sourceDataset) {
          this.loadDatasetVersions(this.formData.sourceDataset);
          // Ê∏ÖÁ©∫‰πãÂâçÈÄâÊã©ÁöÑÁâàÊú¨
          this.formData.datasetVersion = '';
        } else {
          this.datasetVersions = [];
          this.formData.datasetVersion = '';
        }
        
        // ÈáçÊñ∞ËøáÊª§ËµÑÊ∫êÊ±†ÔºàÂõ†‰∏∫Ê∫êÊï∞ÊçÆÈõÜÂèòÂåñÂèØËÉΩÂΩ±ÂìçÂèØÁî®ÁöÑËµÑÊ∫êÊ±†Ôºâ
        this.refilterResourcePools();
      },
      
      onDatasetVersionChange() {
        // ÂΩìÈÄâÊã©Êï∞ÊçÆÁâàÊú¨Êó∂ÔºåÊ£ÄÊü•Â≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑÊòØÂê¶Áõ∏Âêå
        if (this.checkSourceTargetSame()) {
          // Â¶ÇÊûúÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑÁõ∏ÂêåÔºåÊ∏ÖÁ©∫ÈÄâÊã©Âπ∂ÊòæÁ§∫ÊèêÁ§∫
          this.formData.datasetVersion = '';
          
          // ÊòæÁ§∫Áî®Êà∑ÂèãÂ•ΩÁöÑÊèêÁ§∫
          this.showConflictMessage('Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ‰∏çËÉΩÂÆåÂÖ®Áõ∏ÂêåÔºåËØ∑ÈÄâÊã©ÂÖ∂‰ªñÁâàÊú¨');
          
          console.log('Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ‰∏çËÉΩÂÆåÂÖ®Áõ∏ÂêåÔºåÂ∑≤Ê∏ÖÁ©∫ÁâàÊú¨ÈÄâÊã©');
        }
      },
      
      
      // ÊòæÁ§∫ÂÜ≤Á™ÅÊèêÁ§∫Ê∂àÊÅØ
      showConflictMessage(message = 'Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ‰∏çËÉΩÂÆåÂÖ®Áõ∏ÂêåÔºåËØ∑ÈÄâÊã©ÂÖ∂‰ªñÁâàÊú¨') {
        // ÁßªÈô§Â∑≤Â≠òÂú®ÁöÑÂÜ≤Á™ÅÊ∂àÊÅØ
        const existingMessage = document.querySelector('.conflict-message');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        // ÂàõÂª∫ÊèêÁ§∫Ê∂àÊÅØÂÖÉÁ¥†
        const messageDiv = document.createElement('div');
        messageDiv.className = 'conflict-message';
        messageDiv.innerHTML = `
          <div class="conflict-content">
            <span class="conflict-icon">‚ö†Ô∏è</span>
            <span class="conflict-text">${message}</span>
            <button class="conflict-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
          </div>
        `;
        
        // Ê∑ªÂä†Âà∞È°µÈù¢È°∂ÈÉ®
        const container = document.querySelector('.drawer-content') || document.body;
        container.insertBefore(messageDiv, container.firstChild);
        
        // 3ÁßíÂêéËá™Âä®ÁßªÈô§
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        }, 3000);
      },
      
      // ÈáçÊñ∞ËøáÊª§ËµÑÊ∫êÊ±†
      refilterResourcePools() {
        const requiredStorageIds = this.getRequiredStorageIds();
        console.log('ÈúÄË¶ÅËøáÊª§ÁöÑÂ≠òÂÇ®ÂÆû‰æãID:', requiredStorageIds);
        
        // Ê£ÄÊü•ÂΩìÂâçÈÄâÊã©ÁöÑËµÑÊ∫êÊ±†ÊòØÂê¶‰ªçÁÑ∂ÂèØÁî®
        const filteredPools = this.filteredResourcePools;
        const currentPoolId = this.formData.resourcePool;
        
        console.log(`ËµÑÊ∫êÊ±†ËøáÊª§ÁªìÊûú: ÂéüÂßã${this.resourcePools.length}‰∏™ÔºåËøáÊª§Âêé${filteredPools.length}‰∏™`);
        
        if (currentPoolId && !filteredPools.find(pool => (pool.resourcePoolId || pool.metadata?.id) === currentPoolId)) {
          // ÂΩìÂâçÈÄâÊã©ÁöÑËµÑÊ∫êÊ±†‰∏çÂèØÁî®ÔºåÊ∏ÖÁ©∫ÈÄâÊã©
          this.formData.resourcePool = '';
          this.formData.queue = '';
          this.queues = [];
          console.log('ÂΩìÂâçÈÄâÊã©ÁöÑËµÑÊ∫êÊ±†‰∏çÂèØÁî®ÔºåÂ∑≤Ê∏ÖÁ©∫ÈÄâÊã©');
        }
      },
      
      // Ê£ÄÊü•Ê∫êÊï∞ÊçÆÈõÜÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÊòØÂê¶Áõ∏Âêå
      checkSourceTargetSame() {
        if (!this.formData.sourceDataset || !this.formData.datasetVersion) {
          return false;
        }
        
        // Ëé∑ÂèñÊ∫êÊï∞ÊçÆÈõÜ‰ø°ÊÅØ
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        const sourceVersion = this.datasetVersions.find(v => v.id === this.formData.datasetVersion);
        
        if (!sourceDataset || !sourceVersion) {
          return false;
        }
        
        // Ëé∑ÂèñÁõÆÊ†áÊï∞ÊçÆÈõÜ‰ø°ÊÅØ
        const targetVersion = this.targetDatasetVersion;
        
        if (!targetVersion) {
          return false;
        }
        
        // ÊØîËæÉÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ
        const sourceStorageInstance = sourceDataset.storageInstance || sourceDataset.storageInstanceId;
        const targetStorageInstance = this.dataset.storageInstance || this.dataset.storageInstanceId;
        const sourceStoragePath = sourceVersion.storagePath;
        const targetStoragePath = targetVersion.storagePath;
        
        const isSame = sourceStorageInstance === targetStorageInstance && 
                      sourceStoragePath === targetStoragePath;
        
        if (isSame) {
          console.log('Ê∫êÊï∞ÊçÆÈõÜÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁõ∏Âêå:', {
            source: `${sourceStorageInstance}:${sourceStoragePath}`,
            target: `${targetStorageInstance}:${targetStoragePath}`
          });
        }
        
        return isSame;
      },
      async loadAvailableDatasets() {
        try {
          console.log('Ëé∑ÂèñÊï∞ÊçÆÈõÜÂàóË°®...');
          const response = await axios.get('/api?action=DescribeDatasets');
          console.log('Êï∞ÊçÆÈõÜÂàóË°®APIÂìçÂ∫î:', response.data);

          if (response.data && response.data.Datasets) {
            this.availableDatasets = response.data.Datasets;
            console.log('Êï∞ÊçÆÈõÜÂàóË°®Âä†ËΩΩÊàêÂäü:', this.availableDatasets);
          } else if (response.data && response.data.datasets) {
            this.availableDatasets = response.data.datasets;
            console.log('Êï∞ÊçÆÈõÜÂàóË°®Âä†ËΩΩÊàêÂäü:', this.availableDatasets);
          } else {
            console.log('Êï∞ÊçÆÈõÜÂàóË°®‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ');
            this.availableDatasets = [];
          }
        } catch (error) {
          console.error('Ëé∑ÂèñÊï∞ÊçÆÈõÜÂàóË°®Â§±Ë¥•:', error);
          this.availableDatasets = [];
        }
      },
      async loadDatasetVersions(datasetId) {
        if (!datasetId) {
          this.datasetVersions = [];
          return;
        }

        try {
          console.log('Ëé∑ÂèñÊï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®:', datasetId);
          const response = await axios.get('/api?action=DescribeDatasetVersions&datasetId=' + encodeURIComponent(datasetId) + '&pageNumber=1&pageSize=100');
          console.log('Êï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®APIÂìçÂ∫î:', response.data);

          if (response.data && response.data.Versions) {
            this.datasetVersions = response.data.Versions;
            console.log('Êï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®Âä†ËΩΩÊàêÂäü:', this.datasetVersions);
          } else if (response.data && response.data.versions) {
            this.datasetVersions = response.data.versions;
            console.log('Êï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®Âä†ËΩΩÊàêÂäü:', this.datasetVersions);
          } else {
            console.log('Êï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ');
            this.datasetVersions = [];
          }
        } catch (error) {
          console.error('Ëé∑ÂèñÊï∞ÊçÆÈõÜÁâàÊú¨ÂàóË°®Â§±Ë¥•:', error);
          this.datasetVersions = [];
        }
      },
    async loadDataset() {
      console.log('loadDataset called for ID:', this.datasetId);
      this.loading = true;
      this.error = null;
      
      try {
        console.log('Making API request...');
        const response = await axios.get('/api?action=DescribeDataset&datasetId=' + encodeURIComponent(this.datasetId));
        console.log('API response received:', response.data);
        const data = response.data;
        
        if (data.error) {
          this.error = data.error;
          return;
        }
        
        // Êï∞ÊçÆÈõÜËØ¶ÊÉÖÁõ¥Êé•Âú®data‰∏≠ÔºåËÄå‰∏çÊòØÂú®data.datasetÊàñdata.Dataset‰∏≠
        this.dataset = data;
        console.log('Dataset loaded:', this.dataset);
          console.log('Dataset name:', this.dataset ? this.dataset.name : 'undefined');
          console.log('Dataset ID:', this.dataset ? this.dataset.id : 'undefined');

          // È¢ÑÂä†ËΩΩËµÑÊ∫êÊ±†Êï∞ÊçÆÔºàÂ¶ÇÊûúÁºìÂ≠ò‰∏≠Ê≤°ÊúâÊï∞ÊçÆÔºâ
          this.preloadResourcePools();

      } catch (err) {
        console.error('Error loading dataset:', err);
        this.error = 'Âä†ËΩΩÊï∞ÊçÆÈõÜËØ¶ÊÉÖÂ§±Ë¥•: ' + err.message;
      } finally {
        this.loading = false;
      }
    },
    async loadVersions() {
      console.log('loadVersions called for ID:', this.datasetId);
      this.versionsLoading = true;
      this.versionsError = null;
      
      try {
        console.log('Making versions API request...');
        const response = await axios.get('/api?action=DescribeDatasetVersions&datasetId=' + encodeURIComponent(this.datasetId) + '&pageNumber=' + this.currentPage + '&pageSize=' + this.pageSize);
        console.log('Versions API response received:', response.data);
        const data = response.data;
        
        if (data.error) {
          this.versionsError = data.error;
          return;
        }
        
        // ÁâàÊú¨ÂàóË°®Âú®data.versions‰∏≠ÔºåÊÄªÊï∞Âú®data.totalCount‰∏≠
        this.versions = data.versions || data.Versions || [];
        this.totalVersions = data.totalCount || data.TotalCount || 0;
        console.log('Versions loaded:', this.versions);
      } catch (err) {
        console.error('Error loading versions:', err);
        this.versionsError = 'Âä†ËΩΩÁâàÊú¨ÂàóË°®Â§±Ë¥•: ' + err.message;
      } finally {
        this.versionsLoading = false;
      }
    },
    async loadImports() {
      console.log('loadImports called for dataset:', this.datasetId);
      this.importsLoading = true;
      this.importsError = null;
      
      try {
        // ÁîüÊàêÊï∞ÊçÆÈõÜIDÁöÑÂâçÁºÄÁî®‰∫éÊêúÁ¥¢‰ªªÂä°ÂêçÁß∞
        const sanitizedDatasetId = this.datasetId.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
        const searchPrefix = `${sanitizedDatasetId}-`;
        
        // Á≠âÂæÖÈ°µÈù¢ËµÑÊ∫êÊ±†ÂàóË°®Âä†ËΩΩÂÆåÊàê
        console.log('Á≠âÂæÖÈ°µÈù¢ËµÑÊ∫êÊ±†ÂàóË°®Âä†ËΩΩÂÆåÊàê...');
        const allResourcePools = await this.waitForResourcePools();
        
        if (allResourcePools.length === 0) {
          throw new Error('Êó†Ê≥ïËé∑ÂèñËµÑÊ∫êÊ±†ÂàóË°®ÔºåËØ∑Á®çÂêéÈáçËØï');
        }
        
        console.log('‰ΩøÁî®È°µÈù¢Â∑≤Âä†ËΩΩÁöÑËµÑÊ∫êÊ±†ÂàóË°®:', allResourcePools.length, '‰∏™ËµÑÊ∫êÊ±†');
        console.log('ÊêúÁ¥¢ÂÖ≥ÈîÆÂ≠ó:', searchPrefix);
        
        // Âæ™ÁéØÊü•ËØ¢ÊâÄÊúâËµÑÊ∫êÊ±†ÁöÑ‰ªªÂä°
        const allImports = [];
        const promises = allResourcePools.map(async (pool) => {
          try {
            const poolId = pool.resourcePoolId || pool.id;
            const poolType = pool.resourcePoolType || pool.type;
            
            // ÊâòÁÆ°ËµÑÊ∫êÊ±†Á±ªÂûãÁªü‰∏Ä‰ΩøÁî® aihc-serverless
            const actualPoolId = poolType === 'dedicatedV2' ? 'aihc-serverless' : poolId;
            const requestBody = {
              keywordType: 'name',
              keyword: searchPrefix
            };
            console.log(`Querying jobs in resource pool: ${poolId} (type: ${poolType}, actual: ${actualPoolId})`);
            
            const response = await axios.post(`/api?action=DescribeJobs&resourcePoolId=${actualPoolId}`, requestBody);
            
            if (response.data.error) {
              console.warn(`Failed to query jobs in pool ${poolId}:`, response.data.error);
              return [];
            }
            
            const jobs = response.data.jobs || response.data.result?.jobs || [];
            console.log(`Found ${jobs.length} jobs in pool ${poolId} (${poolType})`);
            console.log(`Jobs in pool ${poolId}:`, jobs.map(job => ({ name: job.name, jobId: job.jobId })));
            return jobs;
          } catch (err) {
            console.warn(`Error querying pool ${pool.resourcePoolId || pool.id}:`, err);
            return [];
          }
        });
        
        // Á≠âÂæÖÊâÄÊúâÊü•ËØ¢ÂÆåÊàê
        const results = await Promise.all(promises);
        
        // ÂêàÂπ∂ÊâÄÊúâÁªìÊûú
        results.forEach(jobs => {
          allImports.push(...jobs);
        });
        
        console.log('ÂêàÂπ∂ÂâçÊâÄÊúâ‰ªªÂä°Êï∞Èáè:', allImports.length);
        console.log('ÂêàÂπ∂ÂâçÊâÄÊúâ‰ªªÂä°ÂêçÁß∞:', allImports.map(job => job.name || job.jobName));
        
        // Áõ¥Êé•‰ΩøÁî®APIËøîÂõûÁöÑ‰ªªÂä°ÂàóË°®ÔºåÂõ†‰∏∫ÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢Â∑≤ÁªèÊòØÂåÖÂê´ÂåπÈÖç
        this.imports = allImports;
        
        console.log('ÊúÄÁªàÂØºÂÖ•‰ªªÂä°Êï∞Èáè:', this.imports.length);
        console.log('Loaded imports from all pools:', this.imports);
        
      } catch (err) {
        console.error('Failed to load imports:', err);
        this.importsError = 'Âä†ËΩΩÂØºÂÖ•ËÆ∞ÂΩïÂ§±Ë¥•: ' + err.message;
      } finally {
        this.importsLoading = false;
      }
    },
    async waitForResourcePools() {
      // Â¶ÇÊûúËµÑÊ∫êÊ±†Â∑≤ÁªèÂä†ËΩΩÂÆåÊàêÔºåÁõ¥Êé•ËøîÂõû
      if (this.resourcePoolCacheLoaded && this.resourcePools && this.resourcePools.length > 0) {
        console.log('ËµÑÊ∫êÊ±†Â∑≤Âä†ËΩΩÂÆåÊàêÔºåÁõ¥Êé•‰ΩøÁî®Áé∞ÊúâÊï∞ÊçÆ');
        return this.resourcePools;
      }
      
      // Â¶ÇÊûúÊ≠£Âú®Âä†ËΩΩ‰∏≠ÔºåÁ≠âÂæÖÂä†ËΩΩÂÆåÊàê
      if (this.resourcePoolLoadingStatus && this.resourcePoolLoadingStatus.includes('Ê≠£Âú®')) {
        console.log('ËµÑÊ∫êÊ±†Ê≠£Âú®Âä†ËΩΩ‰∏≠ÔºåÁ≠âÂæÖÂä†ËΩΩÂÆåÊàê...');
        return new Promise((resolve) => {
          const checkInterval = setInterval(() => {
            if (this.resourcePoolCacheLoaded && this.resourcePools && this.resourcePools.length > 0) {
              clearInterval(checkInterval);
              console.log('ËµÑÊ∫êÊ±†Âä†ËΩΩÂÆåÊàêÔºåÁªßÁª≠ÊâßË°åÂØºÂÖ•ËÆ∞ÂΩïÊü•ËØ¢');
              resolve(this.resourcePools);
            }
          }, 500);
          
          // ËÆæÁΩÆË∂ÖÊó∂ÔºåÈÅøÂÖçÊó†ÈôêÁ≠âÂæÖ
          setTimeout(() => {
            clearInterval(checkInterval);
            console.warn('Á≠âÂæÖËµÑÊ∫êÊ±†Âä†ËΩΩË∂ÖÊó∂Ôºå‰ΩøÁî®Á©∫ÂàóË°®');
            resolve([]);
          }, 30000); // 30ÁßíË∂ÖÊó∂
        });
      }
      
      // Â¶ÇÊûúÊó¢Ê≤°ÊúâÂä†ËΩΩÂÆåÊàê‰πüÊ≤°ÊúâÂú®Âä†ËΩΩÔºåËøîÂõûÁ©∫ÂàóË°®
      console.warn('ËµÑÊ∫êÊ±†Êú™Âä†ËΩΩ‰∏îÊú™Âú®Âä†ËΩΩ‰∏≠ÔºåËøîÂõûÁ©∫ÂàóË°®');
      return [];
    },
    switchTab(tabName) {
      this.activeTab = tabName;
      // Â¶ÇÊûúÂàáÊç¢Âà∞ÁâàÊú¨ÂàóË°®tab‰∏îÁâàÊú¨ÂàóË°®‰∏∫Á©∫ÔºåÂàôÂä†ËΩΩÁâàÊú¨ÂàóË°®
      if (tabName === 'versions' && this.versions.length === 0 && !this.versionsError) {
        this.loadVersions();
      }
      // Â¶ÇÊûúÂàáÊç¢Âà∞ÂØºÂÖ•ËÆ∞ÂΩïtab‰∏îÂØºÂÖ•ËÆ∞ÂΩï‰∏∫Á©∫ÔºåÂàôÂä†ËΩΩÂØºÂÖ•ËÆ∞ÂΩï
      if (tabName === 'imports' && this.imports.length === 0 && !this.importsError) {
        this.loadImports();
      }
        // Â¶ÇÊûúÂàáÊç¢Âà∞ËµÑÊ∫êÊ±†tabÔºåÊ£ÄÊü•Âπ∂ÂáÜÂ§áÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆ
        if (tabName === 'resourcePools' && this.isPfsDataset) {
          // Â¶ÇÊûúËµÑÊ∫êÊ±†Êï∞ÊçÆÂ∑≤ÁªèÂä†ËΩΩÔºåÁõ¥Êé•ÊòæÁ§∫ÔºõÂê¶ÂàôÂáÜÂ§áÊï∞ÊçÆ
          if (this.resourcePools.length > 0) {
            console.log('ËµÑÊ∫êÊ±†Êï∞ÊçÆÂ∑≤Â≠òÂú®ÔºåÁõ¥Êé•ÊòæÁ§∫');
          } else {
            this.prepareAvailableResourcePools();
          }
        }
    },
    prevPage() {
      if (this.currentPage > 1) {
        this.currentPage--;
        this.loadVersions();
      }
    },
    nextPage() {
      if (this.currentPage < this.totalPages) {
        this.currentPage++;
        this.loadVersions();
      }
    },
      async loadResourcePools(forceRefresh = false) {
        if (!this.formData.resourcePoolType) {
          this.resourcePools = [];
          return;
        }

        console.log('ÂºÄÂßãÂä†ËΩΩËµÑÊ∫êÊ±†ÂàóË°®ÔºåÁ±ªÂûã:', this.formData.resourcePoolType);
        const cacheKey = this.formData.resourcePoolType;

        try {
          // Ê£ÄÊü•ÁºìÂ≠ò‰∏≠ÊòØÂê¶ÊúâÊï∞ÊçÆ‰∏îÊú™ËøáÊúü
          if (!forceRefresh && this.resourcePoolCache[cacheKey] && this.resourcePoolCacheTime[cacheKey]) {
            const now = Date.now();
            const cacheAge = now - this.resourcePoolCacheTime[cacheKey];
            
            if (cacheAge < this.cacheExpiry) {
              console.log(`‰ΩøÁî®${cacheKey}Á±ªÂûãËµÑÊ∫êÊ±†ÁºìÂ≠òÊï∞ÊçÆÔºåÁºìÂ≠òÂπ¥ÈæÑ:`, Math.round(cacheAge / 1000), 'Áßí');
              this.resourcePools = [...this.resourcePoolCache[cacheKey]];
              // ÈáçÊñ∞ËøáÊª§ËµÑÊ∫êÊ±†
              this.refilterResourcePools();
              return;
            }
          }

          // ÊûÑÂª∫ÂÆåÊï¥ÁöÑURLÂèÇÊï∞
          const urlParams = new URLSearchParams({
            action: 'DescribeResourcePools',
            resourcePoolType: cacheKey
          });
          const fullUrl = `/api?${urlParams.toString()}`;
          
          // ‰ΩøÁî®axiosÂèëÈÄÅËØ∑Ê±ÇÔºåËÆ©HTTPÊã¶Êà™Âô®Â§ÑÁêÜÁºìÂ≠ò
          const response = await axios.get(fullUrl);
          console.log('ËµÑÊ∫êÊ±†APIÂìçÂ∫î:', response.data);

          if (response.data.error) {
            console.error('Âä†ËΩΩËµÑÊ∫êÊ±†Â§±Ë¥•:', response.data.error);
            return;
          }

          // Â§ÑÁêÜÊñ∞ÁöÑAPIÂìçÂ∫îÊ†ºÂºè
          // console.log('ËµÑÊ∫êÊ±†APIÂÆåÊï¥ÂìçÂ∫î:', JSON.stringify(response.data, null, 2));

          let resourcePools = [];
          // Êñ∞Êé•Âè£Áõ¥Êé•Âú®Ê†πÁ∫ßÂà´ËøîÂõûresourcePoolsÊï∞ÁªÑ
          if (response.data.resourcePools && Array.isArray(response.data.resourcePools)) {
            resourcePools = response.data.resourcePools;
          } else if (response.data.result?.resourcePools) {
            resourcePools = response.data.result.resourcePools;
          } else if (response.data.ResourcePools) {
            resourcePools = response.data.ResourcePools;
          } else if (response.data.result?.ResourcePools) {
            resourcePools = response.data.result.ResourcePools;
          } else if (Array.isArray(response.data)) {
            resourcePools = response.data;
          } else {
            console.warn('Êú™ËØÜÂà´ÁöÑËµÑÊ∫êÊ±†APIÂìçÂ∫îÊ†ºÂºè:', response.data);
            resourcePools = [];
          }

          this.resourcePools = resourcePools;
          console.log('ËµÑÊ∫êÊ±†ÂàóË°®Âä†ËΩΩÂÆåÊàê:', this.resourcePools.length, '‰∏™ËµÑÊ∫êÊ±†');

          // Êõ¥Êñ∞ÁºìÂ≠òÔºàÊåâËµÑÊ∫êÊ±†Á±ªÂûãÂàÜÂà´ÁºìÂ≠òÔºâ
          this.resourcePoolCache[cacheKey] = [...this.resourcePools];
          this.resourcePoolCacheTime[cacheKey] = Date.now();
          console.log(`${cacheKey}Á±ªÂûãËµÑÊ∫êÊ±†Êï∞ÊçÆÂ∑≤ÁºìÂ≠ò`);

          // ÈáçÊñ∞ËøáÊª§ËµÑÊ∫êÊ±†
          this.refilterResourcePools();
          
          // ÂêåÊ≠•Êõ¥Êñ∞ÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆÔºàÁî®‰∫éÂèØÁî®ËµÑÊ∫êÊ±†tabÊòæÁ§∫Ôºâ
          this.updateAvailableResourcePools();
          
          // Â¶ÇÊûúÊúâÂèØÁî®ÁöÑËµÑÊ∫êÊ±†ÔºåÈªòËÆ§ÈÄâÊã©Á¨¨‰∏Ä‰∏™
          const filteredPools = this.filteredResourcePools;
          if (filteredPools.length > 0) {
            this.formData.resourcePool = filteredPools[0].resourcePoolId || filteredPools[0].metadata?.id;
            // Âä†ËΩΩËØ•ËµÑÊ∫êÊ±†ÁöÑÈòüÂàó
            await this.loadQueues(this.formData.resourcePool);
          }
        } catch (error) {
          console.error('Âä†ËΩΩËµÑÊ∫êÊ±†APIË∞ÉÁî®Â§±Ë¥•:', error);
        }
      },
      
      // Êõ¥Êñ∞ÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆÔºà‰ªéÁºìÂ≠ò‰∏≠ÂêàÂπ∂ÊâÄÊúâÁ±ªÂûãÁöÑËµÑÊ∫êÊ±†Ôºâ
      updateAvailableResourcePools() {
        if (!this.isPfsDataset) {
          return;
        }
        
        console.log('Êõ¥Êñ∞ÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆ...');
        
        // ÂêàÂπ∂ÊâÄÊúâÁ±ªÂûãÁöÑËµÑÊ∫êÊ±†Êï∞ÊçÆ
        const allResourcePools = [];
        
        // Ê∑ªÂä†Ëá™ËøêÁª¥ËµÑÊ∫êÊ±†
        if (this.resourcePoolCache.common && this.resourcePoolCache.common.length > 0) {
          allResourcePools.push(...this.resourcePoolCache.common.map(pool => ({
            ...pool,
            resourcePoolType: 'common'
          })));
        }
        
        // Ê∑ªÂä†ÂÖ®ÊâòÁÆ°ËµÑÊ∫êÊ±†
        if (this.resourcePoolCache.dedicatedV2 && this.resourcePoolCache.dedicatedV2.length > 0) {
          allResourcePools.push(...this.resourcePoolCache.dedicatedV2.map(pool => ({
            ...pool,
            resourcePoolType: 'dedicatedV2'
          })));
        }
        
        // Êõ¥Êñ∞ËµÑÊ∫êÊ±†ÂàóË°®ÔºàÁî®‰∫éÂèØÁî®ËµÑÊ∫êÊ±†tabÊòæÁ§∫Ôºâ
        this.resourcePools = allResourcePools;
        console.log('ÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆÊõ¥Êñ∞ÂÆåÊàê:', this.resourcePools.length, '‰∏™ËµÑÊ∫êÊ±†');
      },
      
      // ÂáÜÂ§áÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆÔºàÂΩìÂàáÊç¢Âà∞ËµÑÊ∫êÊ±†tabÊó∂Ë∞ÉÁî®Ôºâ
      prepareAvailableResourcePools() {
        if (!this.isPfsDataset) {
          console.log('ÈùûPFSÊï∞ÊçÆÈõÜÔºåË∑≥ËøáÂáÜÂ§áÂèØÁî®ËµÑÊ∫êÊ±†');
          return;
        }
        
        // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèØÁî®ÁöÑËµÑÊ∫êÊ±†Êï∞ÊçÆ
        const hasCommonPools = this.resourcePoolCache.common && this.resourcePoolCache.common.length > 0;
        const hasDedicatedPools = this.resourcePoolCache.dedicatedV2 && this.resourcePoolCache.dedicatedV2.length > 0;
        
        if (!hasCommonPools && !hasDedicatedPools) {
          console.log('Ê≤°ÊúâÂèØÁî®ÁöÑËµÑÊ∫êÊ±†ÁºìÂ≠òÊï∞ÊçÆ');
          this.resourcePoolError = 'ÊöÇÊó†ËµÑÊ∫êÊ±†Êï∞ÊçÆÔºåËØ∑ÂÖàÂú®ÂØºÂÖ•Êï∞ÊçÆÂäüËÉΩ‰∏≠Âä†ËΩΩËµÑÊ∫êÊ±†';
          return;
        }
        
        // Ê∏ÖÈô§ÈîôËØØÁä∂ÊÄÅ
        this.resourcePoolError = null;
        
        // Êõ¥Êñ∞ÂèØÁî®ËµÑÊ∫êÊ±†Êï∞ÊçÆ
        this.updateAvailableResourcePools();
      },
      async loadQueues(resourcePoolId) {
        if (!resourcePoolId) {
          this.queues = [];
          this.formData.queue = '';
          return;
        }

        console.log('ÂºÄÂßãÂä†ËΩΩÈòüÂàóÂàóË°®ÔºåËµÑÊ∫êÊ±†ID:', resourcePoolId);
        try {
          // ÊûÑÂª∫ÂÆåÊï¥ÁöÑURLÂèÇÊï∞
          const urlParams = new URLSearchParams({
            action: 'DescribeQueues',
            resourcePoolId: resourcePoolId
          });
          const fullUrl = `/api?${urlParams.toString()}`;
          
          // ‰ΩøÁî®axiosÂèëÈÄÅËØ∑Ê±ÇÔºåËÆ©HTTPÊã¶Êà™Âô®Â§ÑÁêÜÁºìÂ≠ò
          const response = await axios.get(fullUrl);
          console.log('ÈòüÂàóAPIÂìçÂ∫î:', response.data);

          if (response.data.error) {
            console.error('Âä†ËΩΩÈòüÂàóÂ§±Ë¥•:', response.data.error);
            return;
          }

          // Â§ÑÁêÜÊñ∞ÁöÑAPIÂìçÂ∫îÊ†ºÂºè
          // console.log('ÈòüÂàóAPIÂÆåÊï¥ÂìçÂ∫î:', JSON.stringify(response.data, null, 2));

          this.queues = response.data.queues;
          console.log('ÈòüÂàóÂàóË°®Âä†ËΩΩÂÆåÊàê:', this.queues.length, '‰∏™ÈòüÂàó');

          // Â¶ÇÊûúÊúâÈòüÂàóÔºåÈªòËÆ§ÈÄâÊã©Á¨¨‰∏Ä‰∏™
          if (this.queues.length > 0) {
            this.formData.queue = this.queues[0].queueName || this.queues[0].name;
          } else {
            this.formData.queue = '';
          }
        } catch (error) {
          console.error('Âä†ËΩΩÈòüÂàóAPIË∞ÉÁî®Â§±Ë¥•:', error);
          this.queues = [];
          this.formData.queue = '';
        }
      },
      async onResourcePoolTypeChange() {
        console.log('ËµÑÊ∫êÊ±†Á±ªÂûãÈÄâÊã©ÂèòÂåñ:', this.formData.resourcePoolType);
        // ÈáçÁΩÆËµÑÊ∫êÊ±†ÂíåÈòüÂàóÈÄâÊã©
        this.formData.resourcePool = '';
        this.formData.queue = '';
        this.resourcePools = [];
        this.queues = [];

        // Â¶ÇÊûúÈÄâÊã©‰∫ÜËµÑÊ∫êÊ±†Á±ªÂûãÔºåÂä†ËΩΩÂØπÂ∫îÁ±ªÂûãÁöÑËµÑÊ∫êÊ±†
        if (this.formData.resourcePoolType) {
          await this.loadResourcePools();
          // Âä†ËΩΩÂÆåÊàêÂêéÈáçÊñ∞ËøáÊª§ËµÑÊ∫êÊ±†
          this.refilterResourcePools();
        }
      },

      async onResourcePoolChange() {
        console.log('ËµÑÊ∫êÊ±†ÈÄâÊã©ÂèòÂåñ:', this.formData.resourcePool);
        // ÈáçÁΩÆÈòüÂàóÈÄâÊã©
        this.formData.queue = '';
        // Âä†ËΩΩÊñ∞ÁöÑÈòüÂàóÂàóË°®
        await this.loadQueues(this.formData.resourcePool);
      },

      // Âà∑Êñ∞ËµÑÊ∫êÊ±†ÂàóË°®
      async refreshResourcePools() {
        console.log('Áî®Êà∑ÊâãÂä®Âà∑Êñ∞ËµÑÊ∫êÊ±†ÂàóË°®');
        await this.loadResourcePools(true); // Âº∫Âà∂Âà∑Êñ∞
      },

      // Âà∑Êñ∞Êï∞ÊçÆÁâàÊú¨ÂàóË°®
      async refreshDatasetVersions() {
        console.log('Áî®Êà∑ÊâãÂä®Âà∑Êñ∞Êï∞ÊçÆÁâàÊú¨ÂàóË°®');
        if (this.formData.sourceDataset) {
          await this.loadDatasetVersions(this.formData.sourceDataset);
        }
      },

      // Âà∑Êñ∞ÈòüÂàóÂàóË°®
      async refreshQueues() {
        console.log('Áî®Êà∑ÊâãÂä®Âà∑Êñ∞ÈòüÂàóÂàóË°®');
        if (this.formData.resourcePool) {
          await this.loadQueues(this.formData.resourcePool);
        }
      },

      // Âà∑Êñ∞Êï∞ÊçÆÈõÜÂàóË°®
      async refreshDatasets() {
        console.log('Áî®Êà∑ÊâãÂä®Âà∑Êñ∞Êï∞ÊçÆÈõÜÂàóË°®');
        await this.loadAvailableDatasets();
      },

      // Ëé∑ÂèñÊ∫êË∑ØÂæÑ
      getSourcePath() {
        if (!this.formData.sourceDataset || !this.formData.datasetVersion) return '';

        // Ëé∑ÂèñÊ∫êÊï∞ÊçÆÈõÜ‰ø°ÊÅØ
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);
        if (!sourceDataset) return '';

        // Ëé∑ÂèñÁâàÊú¨‰ø°ÊÅØ
        const version = this.datasetVersions.find(v => v.id === this.formData.datasetVersion);
        if (!version || !version.storagePath) return '';

        // ÊûÑÂª∫Ê∫êË∑ØÂæÑÔºöÂ≠òÂÇ®ÂÆû‰æã:Â≠òÂÇ®Ë∑ØÂæÑ
        const storageInstance = sourceDataset.storageInstanceId || sourceDataset.storage_instance_id || sourceDataset.storageInstance;
        if (storageInstance) {
          return `${storageInstance}:${version.storagePath}`;
        } else {
          return version.storagePath;
        }
      },

      // Ëé∑ÂèñÁõÆÊ†áÂ≠òÂÇ®‰ø°ÊÅØ
      getTargetStorageInfo() {
        if (!this.dataset) return 'Âä†ËΩΩ‰∏≠...';

        const storageType = this.dataset.storageType || this.dataset.storage_type || 'Êú™Áü•';
        const storageInstance = this.dataset.storageInstance || this.dataset.storageInstanceId || 'Êú™Áü•';

        return `${storageType} (${storageInstance})`;
      },

      // Ëé∑ÂèñÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨
      getTargetDatasetVersion() {
        if (!this.dataset) return 'Âä†ËΩΩ‰∏≠...';
        if (!this.targetDatasetVersion) return 'Âä†ËΩΩ‰∏≠...';

        const targetVersion = this.targetDatasetVersion.version;
        return targetVersion;
      },

      // Ëé∑ÂèñÁõÆÊ†áÊï∞ÊçÆÈõÜ‰ø°ÊÅØÔºàÂΩìÂâçÁâàÊú¨Ôºâ
      getTargetDatasetInfo() {
        // ‰ΩøÁî®ÁÇπÂáªÂØºÂÖ•Êï∞ÊçÆÊåâÈíÆÊó∂‰º†ÂÖ•ÁöÑÁâàÊú¨‰ø°ÊÅØ
        const currentVersion = this.targetDatasetVersion;
        
        if (!currentVersion) {
          return {
            name: this.dataset?.name || 'Êú™Áü•',
            storageType: this.dataset?.storageType || 'Êú™Áü•',
            storagePath: 'Âä†ËΩΩ‰∏≠...',
            mountPath: 'Âä†ËΩΩ‰∏≠...',
            storageInstance: this.dataset?.storageInstance || 'Êú™Áü•'
          };
        }

        return {
          name: this.dataset.name,
          storageType: this.dataset.storageType,
          storagePath: currentVersion.storagePath,
          mountPath: currentVersion.mountPath,
          storageInstance: this.dataset.storageInstance
        };
      },

      // Ëé∑ÂèñÊ∫êÊï∞ÊçÆÈõÜ‰ø°ÊÅØÔºàÈÄâ‰∏≠ÁâàÊú¨Ôºâ
      getSourceDatasetInfo() {
        // ‰ªéÂèØÈÄâÊï∞ÊçÆÈõÜ‰∏≠Êü•ÊâæÊ∫êÊï∞ÊçÆÈõÜ
        const sourceDataset = this.availableDatasets.find(d => d.id === this.formData.sourceDataset);

        // Ëé∑ÂèñÁâàÊú¨‰ø°ÊÅØ
        const version = this.datasetVersions.find(v => v.id === this.formData.datasetVersion);

        return {
          name: sourceDataset.name,
          storageType: sourceDataset.storageType,
          storagePath: version.storagePath,
          mountPath: version.mountPath,
          storageInstance: sourceDataset.storageInstance
        };
      },

      // Ëé∑ÂèñÁõÆÊ†áÂ≠òÂÇ®Ë∑ØÂæÑ
      getTargetStoragePath() {
        if (!this.dataset) return 'Âä†ËΩΩ‰∏≠...';
        if (!this.targetDatasetVersion) return 'Âä†ËΩΩ‰∏≠...';

        const storagePath = this.targetDatasetVersion.storagePath;
        return storagePath;
      },

      // Ëé∑ÂèñÁõÆÊ†áË∑ØÂæÑ
      getTargetPath() {
        if (!this.dataset || !this.targetDatasetVersion) return 'Êú™Áü•ÁõÆÊ†áÊï∞ÊçÆÈõÜ';

        // Ëé∑ÂèñÁõÆÊ†áÊï∞ÊçÆÈõÜÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåÂ≠òÂÇ®Ë∑ØÂæÑÔºà‰ΩøÁî®ÁõÆÊ†áÁâàÊú¨‰ø°ÊÅØÔºâ
        const storageInstance = this.dataset.storageInstance;
        const storagePath = this.targetDatasetVersion.storagePath;

        if (storageInstance) {
          return `${storageInstance}:${storagePath}`;
        } else {
          return storagePath;
        }
      },

      // È¢ÑÂä†ËΩΩËµÑÊ∫êÊ±†Êï∞ÊçÆÔºàÂú®È°µÈù¢Âä†ËΩΩÊó∂Ë∞ÉÁî®Ôºâ
      async preloadResourcePools() {
        console.log('È¢ÑÂä†ËΩΩËµÑÊ∫êÊ±†Êï∞ÊçÆ...');
        this.resourcePoolLoadingStatus = 'Ê≠£Âú®Âπ∂Ë°åÂä†ËΩΩËµÑÊ∫êÊ±†Êï∞ÊçÆ...';

        // È¢ÑÂä†ËΩΩ‰∏§ÁßçÁ±ªÂûãÁöÑËµÑÊ∫êÊ±†
        const resourcePoolTypes = ['common', 'dedicatedV2'];

        // ÂàõÂª∫Âπ∂Ë°åÂä†ËΩΩ‰ªªÂä°
        const loadTasks = resourcePoolTypes.map(async (poolType) => {
          // Ê£ÄÊü•ËØ•Á±ªÂûãÊòØÂê¶Â∑≤ÊúâÁºìÂ≠òÊï∞ÊçÆ
          if (this.resourcePoolCache[poolType] && this.resourcePoolCacheTime[poolType]) {
            const now = Date.now();
            const cacheAge = now - this.resourcePoolCacheTime[poolType];

            if (cacheAge < this.cacheExpiry) {
              console.log(`${poolType}Á±ªÂûãËµÑÊ∫êÊ±†Êï∞ÊçÆÂ∑≤ÁºìÂ≠òÔºåÊó†ÈúÄÈ¢ÑÂä†ËΩΩÔºåÁºìÂ≠òÂπ¥ÈæÑ:`, Math.round(cacheAge / 1000), 'Áßí');
              return { poolType, success: true, fromCache: true };
            }
          }

          // Â¶ÇÊûúÊ≤°ÊúâÁºìÂ≠òÊàñÁºìÂ≠òÂ∑≤ËøáÊúüÔºåÂàôÈ¢ÑÂä†ËΩΩ
          console.log(`ÂºÄÂßãÈ¢ÑÂä†ËΩΩ${poolType}Á±ªÂûãËµÑÊ∫êÊ±†Êï∞ÊçÆ...`);
          try {
            // ‰ΩøÁî®axiosÂèëÈÄÅËØ∑Ê±ÇÔºåËÆ©HTTPÊã¶Êà™Âô®Â§ÑÁêÜÁºìÂ≠ò
            const response = await axios.get(`/api?action=DescribeResourcePools&resourcePoolType=${poolType}&keywordType=resourcePoolName&keyword=&orderBy=createdAt&order=DESC&pageNumber=1&pageSize=100`);
            console.log(`È¢ÑÂä†ËΩΩ${poolType}Á±ªÂûãËµÑÊ∫êÊ±†APIÂìçÂ∫î:`, response.data);

            if (response.data.error) {
              console.error(`È¢ÑÂä†ËΩΩ${poolType}Á±ªÂûãËµÑÊ∫êÊ±†Â§±Ë¥•:`, response.data.error);
              return { poolType, success: false, error: response.data.error };
            }

            // Â§ÑÁêÜÊñ∞ÁöÑAPIÂìçÂ∫îÊ†ºÂºèÂπ∂Êõ¥Êñ∞ÁºìÂ≠ò
            // console.log(`È¢ÑÂä†ËΩΩ${poolType}Á±ªÂûãËµÑÊ∫êÊ±†APIÂÆåÊï¥ÂìçÂ∫î:`, JSON.stringify(response.data, null, 2));

            let resourcePools = [];
            // Êñ∞Êé•Âè£Áõ¥Êé•Âú®Ê†πÁ∫ßÂà´ËøîÂõûresourcePoolsÊï∞ÁªÑ
            if (response.data.resourcePools && Array.isArray(response.data.resourcePools)) {
              resourcePools = response.data.resourcePools;
            } else if (response.data.result?.resourcePools) {
              resourcePools = response.data.result.resourcePools;
            } else if (response.data.ResourcePools) {
              resourcePools = response.data.ResourcePools;
            } else if (response.data.result?.ResourcePools) {
              resourcePools = response.data.result.ResourcePools;
            } else if (Array.isArray(response.data)) {
              resourcePools = response.data;
            } else {
              console.warn(`È¢ÑÂä†ËΩΩÊú™ËØÜÂà´ÁöÑ${poolType}Á±ªÂûãËµÑÊ∫êÊ±†APIÂìçÂ∫îÊ†ºÂºè:`, response.data);
              resourcePools = [];
            }

            // Êõ¥Êñ∞ÁºìÂ≠òÔºàÊåâÁ±ªÂûãÂàÜÂà´ÁºìÂ≠òÔºâ
            this.resourcePoolCache[poolType] = [...resourcePools];
            this.resourcePoolCacheTime[poolType] = Date.now();
            console.log(`${poolType}Á±ªÂûãËµÑÊ∫êÊ±†Êï∞ÊçÆÈ¢ÑÂä†ËΩΩÂÆåÊàêÔºåÁºìÂ≠ò‰∫Ü`, resourcePools.length, '‰∏™ËµÑÊ∫êÊ±†');

            return { poolType, success: true, count: resourcePools.length };

          } catch (error) {
            console.error(`È¢ÑÂä†ËΩΩ${poolType}Á±ªÂûãËµÑÊ∫êÊ±†APIË∞ÉÁî®Â§±Ë¥•:`, error);
            return { poolType, success: false, error: error.message };
          }
        });

        // Á≠âÂæÖÊâÄÊúâ‰ªªÂä°ÂÆåÊàê
        const results = await Promise.all(loadTasks);

        // ÁªüËÆ°ÁªìÊûú
        const successCount = results.filter(r => r.success).length;
        const totalCount = results.length;
        const fromCacheCount = results.filter(r => r.fromCache).length;
        const newLoadCount = successCount - fromCacheCount;

        console.log(`ËµÑÊ∫êÊ±†È¢ÑÂä†ËΩΩÂÆåÊàê: ÊÄªËÆ°${totalCount}‰∏™Á±ªÂûãÔºåÊàêÂäü${successCount}‰∏™ÔºåÂÖ∂‰∏≠${fromCacheCount}‰∏™Êù•Ëá™ÁºìÂ≠òÔºå${newLoadCount}‰∏™Êñ∞Âä†ËΩΩ`);

        // Ê†áËÆ∞ËµÑÊ∫êÊ±†ÁºìÂ≠òÂä†ËΩΩÂÆåÊàê
        this.resourcePoolCacheLoaded = true;
        this.resourcePoolLoadingStatus = `ËµÑÊ∫êÊ±†Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê (${successCount}/${totalCount})ÔºåÂØºÂÖ•Êï∞ÊçÆÂäüËÉΩÂ∑≤ÂèØÁî®`;
        
        // ÂêàÂπ∂ÊâÄÊúâÁ±ªÂûãÁöÑËµÑÊ∫êÊ±†Âà∞ this.resourcePools
        this.resourcePools = [];
        resourcePoolTypes.forEach(poolType => {
          if (this.resourcePoolCache[poolType]) {
            this.resourcePools.push(...this.resourcePoolCache[poolType]);
          }
        });
        console.log('ËµÑÊ∫êÊ±†ÂàóË°®ÂêàÂπ∂ÂÆåÊàêÔºåÊÄªËÆ°:', this.resourcePools.length, '‰∏™ËµÑÊ∫êÊ±†');
        console.log('ËµÑÊ∫êÊ±†ÁºìÂ≠òÈ¢ÑÂä†ËΩΩÂÆåÊàêÔºåÂØºÂÖ•Êï∞ÊçÆÊåâÈíÆÂ∑≤ÂêØÁî®');
        
        // Ëß¶ÂèëËµÑÊ∫êÊ±†Âä†ËΩΩÂÆåÊàê‰∫ã‰ª∂
        this.$emit('resourcePoolsLoaded');

        // Âª∂ËøüÈöêËóèÊèêÁ§∫‰ø°ÊÅØ
        setTimeout(() => {
          this.resourcePoolLoadingStatus = '';
        }, 2000);
      },
      buildImportCommand() {
        // ÊûÑÂª∫Êï∞ÊçÆÂØºÂÖ•ÁöÑÂëΩ‰ª§ËÑöÊú¨
        let command = `#!/bin/bash
set -e  # ÈÅáÂà∞ÈîôËØØÁ´ãÂç≥ÈÄÄÂá∫

echo "ÂºÄÂßãÊï∞ÊçÆÂØºÂÖ•‰ªªÂä°..."
echo "Ê∫êË∑ØÂæÑ: $SOURCE_PATH"
echo "ÁõÆÊ†áË∑ØÂæÑ: $TARGET_PATH"
echo "Ê∏ÖÁ©∫Êï∞ÊçÆ: $CLEAN_DATA"
echo "ÂêåÂêç‰øùÁïôÁ≠ñÁï•: $NAME_STRATEGY"

# Ê£ÄÊü•Ê∫êË∑ØÂæÑÊòØÂê¶Â≠òÂú®
if [ ! -d "$SOURCE_PATH" ]; then
    echo "ÈîôËØØ: Ê∫êË∑ØÂæÑ‰∏çÂ≠òÂú®: $SOURCE_PATH"
    exit 1
fi

# ÂàõÂª∫ÁõÆÊ†áË∑ØÂæÑÔºàÂ¶ÇÊûú‰∏çÂ≠òÂú®Ôºâ
mkdir -p "$TARGET_PATH"

# Â¶ÇÊûúÂêØÁî®Ê∏ÖÁ©∫Êï∞ÊçÆÔºåÂÖàÊ∏ÖÁ©∫ÁõÆÊ†áË∑ØÂæÑ
if [ "$CLEAN_DATA" = "true" ]; then
    echo "Ê∏ÖÁ©∫ÁõÆÊ†áË∑ØÂæÑ: $TARGET_PATH"
    rm -rf "$TARGET_PATH"/*
    rm -rf "$TARGET_PATH"/.[^.]* 2>/dev/null || true  # Âà†Èô§ÈöêËóèÊñá‰ª∂ÔºåÂøΩÁï•ÈîôËØØ
fi

# Ê†πÊçÆÂêåÂêç‰øùÁïôÁ≠ñÁï•Â§ÑÁêÜÊñá‰ª∂Â§çÂà∂
if [ "$NAME_STRATEGY" = "target" ]; then
    echo "‰ΩøÁî®‰øùÁïôÁõÆÁöÑÊñá‰ª∂Á≠ñÁï•..."
    # ‰ΩøÁî® rsync Â§çÂà∂Ôºå‰øùÁïôÁõÆÁöÑÊñá‰ª∂
    rsync -av --ignore-existing "$SOURCE_PATH"/ "$TARGET_PATH"/
elif [ "$NAME_STRATEGY" = "source" ]; then
    echo "‰ΩøÁî®‰øùÁïôÊ∫êÊñá‰ª∂Á≠ñÁï•..."
    # ‰ΩøÁî® rsync Â§çÂà∂ÔºåË¶ÜÁõñÁõÆÁöÑÊñá‰ª∂
    rsync -av "$SOURCE_PATH"/ "$TARGET_PATH"/
else
    echo "‰ΩøÁî®ÈªòËÆ§Á≠ñÁï•Ôºà‰øùÁïôÊ∫êÊñá‰ª∂Ôºâ..."
    # ÈªòËÆ§‰ΩøÁî®‰øùÁïôÊ∫êÊñá‰ª∂Á≠ñÁï•
    rsync -av "$SOURCE_PATH"/ "$TARGET_PATH"/
fi

# È™åËØÅÂ§çÂà∂ÁªìÊûú
echo "È™åËØÅÂ§çÂà∂ÁªìÊûú..."
source_count=$(find "$SOURCE_PATH" -type f | wc -l)
target_count=$(find "$TARGET_PATH" -type f | wc -l)
echo "Ê∫êË∑ØÂæÑÊñá‰ª∂Êï∞Èáè: $source_count"
echo "ÁõÆÊ†áË∑ØÂæÑÊñá‰ª∂Êï∞Èáè: $target_count"

if [ "$source_count" -eq "$target_count" ]; then
    echo "Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÂÆåÊàêÔºÅ"
else
    echo "Ë≠¶Âëä: Êñá‰ª∂Êï∞Èáè‰∏çÂåπÈÖçÔºåËØ∑Ê£ÄÊü•Â§çÂà∂ÁªìÊûú"
    exit 1
fi

echo "Êï∞ÊçÆÂØºÂÖ•‰ªªÂä°ÂÆåÊàê"`;

        return command;
    },
    // Êèê‰∫§ÂØºÂÖ•Ë°®Âçï
      async submitImportForm() {
        console.log('submitImportForm called');
        
        // Ê£ÄÊü•Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑÊòØÂê¶Áõ∏Âêå
        if (this.checkSourceTargetSame()) {
          alert('Ê∫êÊï∞ÊçÆÈõÜÁâàÊú¨ÂíåÁõÆÊ†áÊï∞ÊçÆÈõÜÁâàÊú¨ÁöÑÂ≠òÂÇ®ÂÆû‰æãÂíåË∑ØÂæÑ‰∏çËÉΩÂÆåÂÖ®Áõ∏ÂêåÔºåËØ∑ÈáçÊñ∞ÈÄâÊã©');
          return;
        }
        
      // Ë°®ÂçïÈ™åËØÅ
        if (this.importMethod === 'existing' && (!this.formData.sourceDataset || !this.formData.datasetVersion)) {
        alert('ËØ∑ÈÄâÊã©Ê∫êÊï∞ÊçÆÈõÜÂíåÊï∞ÊçÆÁâàÊú¨');
        return;
      }
      
        if (!this.formData.cleanData && !this.formData.nameStrategy) {
        alert('ËØ∑ÈÄâÊã©ÂêåÂêç‰øùÁïôÁ≠ñÁï•');
        return;
      }

        if (!this.formData.resourcePoolType) {
          alert('ËØ∑ÈÄâÊã©ËµÑÊ∫êÊ±†Á±ªÂûã');
          return;
        }
      
      if (!this.formData.resourcePool || !this.formData.queue) {
        alert('ËØ∑ÈÄâÊã©ËµÑÊ∫êÊ±†ÂíåÈòüÂàó');
        return;
      }
      
        // ÊûÑÂª∫ËÆ≠ÁªÉ‰ªªÂä°ËØ∑Ê±ÇÂèÇÊï∞ÔºàÂèÇËÄÉAIHCÊñáÊ°£Ê†ºÂºèÔºâ
        // Á°Æ‰øù‰ªªÂä°ÂêçÁß∞Á¨¶Âêà DNS-1123 Â≠êÂüüÂêçËßÑËåÉÔºöÂè™ËÉΩÂåÖÂê´Â∞èÂÜôÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅËøûÂ≠óÁ¨¶ÂíåÁÇπÂè∑
        const sanitizedDatasetId = this.datasetId.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
        const sanitizedVersion = this.formData.datasetVersion.toLowerCase().replace(/[^a-z0-9.-]/g, '-');
        const jobName = `${sanitizedDatasetId}-${sanitizedVersion}-${Date.now()}`;
        const datasource = this.getDatasource();
      const requestParams = {
          name: jobName,
          queue: this.formData.resourcePoolType == 'common' ? this.formData.queue : (this.queues.find(q => q.queueName == this.formData.queue)?.queueId),
          jobType: "PyTorchJob",
          command: this.buildImportCommand(),
          jobSpec: {
            replicas: 1,
            image: "registry.baidubce.com/public/pytorch:1.12.0-cuda11.3-cudnn8-devel",
            resources: [],
            envs: [
              {
                name: "SOURCE_PATH",
                value: datasource[1].mountPath
              },
              {
                name: "TARGET_PATH",
                value: datasource[0].mountPath
              },
              {
                name: "CLEAN_DATA",
                value: this.formData.cleanData ? "true" : "false"
              },
              {
                name: "NAME_STRATEGY",
                value: this.formData.nameStrategy
              },
              {
                name: "IMPORT_METHOD",
                value: this.importMethod
              }
            ],
            enableRDMA: false
          },
          labels: [
            {
              "key": "type",
              "value": "data-import"
            },
            {
              "key": "dataset",
              "value": `dataset-${this.datasetId}`
            }
          ],
          "datasource": datasource
        };

        console.log('ÂàõÂª∫ËÆ≠ÁªÉ‰ªªÂä°ËØ∑Ê±ÇÂèÇÊï∞:', JSON.stringify(requestParams, null, 2));

        try {
          // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
          const submitBtn = document.querySelector('.form-actions .btn-primary');
          if (submitBtn) {
            submitBtn.textContent = 'ÂàõÂª∫‰ªªÂä°‰∏≠...';
            submitBtn.disabled = true;
          }

          // Ë∞ÉÁî®ÂàõÂª∫ËÆ≠ÁªÉ‰ªªÂä°API
          const response = await axios.post(`/api?action=CreateJob&resourcePoolId=${this.formData.resourcePoolType == 'common' ? this.formData.resourcePool : 'aihc-serverless'}`, requestParams);
          console.log('ÂàõÂª∫ËÆ≠ÁªÉ‰ªªÂä°APIÂìçÂ∫î:', response.data);

          if (response.data.error) {
            alert('ÂàõÂª∫ÂØºÂÖ•‰ªªÂä°Â§±Ë¥•: ' + response.data.error);
          } else {
            const jobId = response.data.jobId || response.data.result?.jobId;
            const jobName = response.data.jobName || response.data.result?.jobName;
            alert(`ÂØºÂÖ•‰ªªÂä°ÂàõÂª∫ÊàêÂäüÔºÅ\n‰ªªÂä°ID: ${jobId}\n‰ªªÂä°ÂêçÁß∞: ${jobName}`);
      // ÂÖ≥Èó≠ÊäΩÂ±â
            closeDrawer();
          }
        } catch (error) {
          console.error('ÂàõÂª∫ËÆ≠ÁªÉ‰ªªÂä°APIË∞ÉÁî®Â§±Ë¥•:', error);
          alert('ÂàõÂª∫ÂØºÂÖ•‰ªªÂä°Â§±Ë¥•: ' + (error.response?.data?.error || error.message || 'Êú™Áü•ÈîôËØØ'));
        } finally {
          // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
          const submitBtn = document.querySelector('.form-actions .btn-primary');
          if (submitBtn) {
            submitBtn.textContent = 'Á°ÆÂÆö';
            submitBtn.disabled = false;
          }
        }
      },
      getDatasource() {
        const targetDatasetInfo = this.getTargetDatasetInfo();
        const sourceDatasetInfo = this.getSourceDatasetInfo();
        console.log('targetDatasetInfo', targetDatasetInfo);
        console.log('sourceDatasetInfo', sourceDatasetInfo);

        const targetDatasetType = targetDatasetInfo.storageType.toLowerCase();
        const sourceDatasetType = sourceDatasetInfo.storageType.toLowerCase();
        const targetDatasetName = targetDatasetType === 'pfs' ? targetDatasetInfo.storageInstance : '';
        const sourceDatasetName = sourceDatasetType === 'pfs' ? sourceDatasetInfo.storageInstance : '';
        const targetDatasetPath = targetDatasetType === 'pfs' ? targetDatasetInfo.storagePath : `${targetDatasetInfo.storageInstance}${targetDatasetInfo.storagePath}`;
        const sourceDatasetPath = sourceDatasetType === 'pfs' ? sourceDatasetInfo.storagePath : `${sourceDatasetInfo.storageInstance}${sourceDatasetInfo.storagePath}`;
        return [
          // ÁõÆÊ†áÊï∞ÊçÆÈõÜ DataSource
          {
            type: targetDatasetType,
            name: targetDatasetName,
            sourcePath: targetDatasetPath,
            mountPath: '/mnt/target'
          },
          // Ê∫êÊï∞ÊçÆÈõÜ DataSource
          {
            type: sourceDatasetType,
            name: sourceDatasetName,
            sourcePath: sourceDatasetPath,
            mountPath: '/mnt/source'
          }
        ]
    },
    formatDate(dateStr) {
      if (!dateStr) return 'N/A';
      try {
        const date = new Date(dateStr);
        return date.toLocaleString('zh-CN');
      } catch (e) {
        return dateStr;
      }
    },
    statusText(status) {
      const statusMap = {
        'Pending': 'Á≠âÂæÖ‰∏≠',
        'Running': 'ËøêË°å‰∏≠',
        'Succeeded': 'ÊàêÂäü',
        'Failed': 'Â§±Ë¥•',
        'Cancelled': 'Â∑≤ÂèñÊ∂à',
        'Unknown': 'Êú™Áü•'
      };
      return statusMap[status] || status || 'Êú™Áü•';
    },
    statusClass(status) {
      const classMap = {
        'Pending': 'status-pending',
        'Running': 'status-running',
        'Succeeded': 'status-success',
        'Failed': 'status-error',
        'Cancelled': 'status-cancelled',
        'Unknown': 'status-unknown'
      };
      return classMap[status] || 'status-unknown';
    },
    viewImportJob(importJob) {
      // ‰ªé‰ªªÂä°Êï∞ÊçÆ‰∏≠Ëé∑ÂèñËµÑÊ∫êÊ±†ID
      const resourcePoolId = importJob.resourcePoolId || 'aihc-serverless';
      
      // Ë∑≥ËΩ¨Âà∞‰ªªÂä°ËØ¶ÊÉÖÈ°µÈù¢Ôºå‰º†ÈÄíËµÑÊ∫êÊ±†IDÂíåÊù•Ê∫êÈ°µÈù¢ÂèÇÊï∞
      window.location.href = `/jobs/${importJob.jobId}?resourcePoolId=${resourcePoolId}&from=imports&datasetId=${this.datasetId}`;
    },
    formatVisibility(visibilityScope) {
      if (!visibilityScope) return 'N/A';
      const visibilityMap = {
        'ALL_PEOPLE': 'ÊâÄÊúâ‰∫∫ÂèØËßÅ',
        'USER_GROUP': 'Áî®Êà∑ÁªÑÂèØËßÅ',
        'ONLY_OWNER': '‰ªÖÊâÄÊúâËÄÖÂèØËßÅ'
      };
      return visibilityMap[visibilityScope] || visibilityScope;
    },
    copyDatasetId(id) {
      if (!id) return;
      
      // ‰ΩøÁî®Áé∞‰ª£ÊµèËßàÂô®ÁöÑClipboard API
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(id).then(() => {
          this.showCopySuccess();
        }).catch(err => {
          console.error('Â§çÂà∂Â§±Ë¥•:', err);
          this.fallbackCopy(id);
        });
      } else {
        // ÈôçÁ∫ßÊñπÊ°à
        this.fallbackCopy(id);
      }
    },
    fallbackCopy(text) {
      // ÂàõÂª∫‰∏¥Êó∂ÊñáÊú¨Âå∫Âüü
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      
      try {
        document.execCommand('copy');
        this.showCopySuccess();
      } catch (err) {
        console.error('Â§çÂà∂Â§±Ë¥•:', err);
      }
      
      document.body.removeChild(textArea);
    },
    showCopySuccess() {
      // ÊòæÁ§∫Â§çÂà∂ÊàêÂäüÊèêÁ§∫
      const toast = document.createElement('div');
      toast.textContent = 'Êï∞ÊçÆÈõÜIDÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #52c41a;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        z-index: 10000;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideIn 0.3s ease;
      `;
      
      // Ê∑ªÂä†Âä®ÁîªÊ†∑Âºè
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(toast);
      
      // 3ÁßíÂêéËá™Âä®ÁßªÈô§
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 3000);
    }
  },
  mounted() {
      // Á°Æ‰øùÊäΩÂ±âÂàùÂßãÁä∂ÊÄÅÊòØÈöêËóèÁöÑ
      this.drawerVisible = false;
    this.loadDataset();
  }
}).mount('#app');
</script>
{% endblock %}